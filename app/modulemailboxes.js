/*!
 * 
 *                     aacService
 *
 *                     release: 2022.01.001
 *
 *                     date: 2022-04-13 22:38:49
 *
 *                     build: 2022.01.001.1649882329485
 *
 */
"use strict";(self.webpackChunkcore=self.webpackChunkcore||[]).push([["src_modules_mailboxes_modulemailboxes_ts"],{9674:(e,s,i)=>{i.r(s),i.d(s,{ModuleMailboxes:()=>ls});var t=i(9808),l=i(2382),a=i(9769),o=i(1706),n=i(4518),d=i(1549),r=i(6472),c=i(4893),m=i(727),u=i(1135),g=i(7579),h=i(4505),b=i(3369);let p=(()=>{class mailboxesEmails{constructor(e,s){this.backend=e,this.broadcast=s,this.activeSplitType={name:"noSplit",icon:"picklist_type",label:"LBL_NO_SPLIT"},this.limit=50,this.mailboxes=[],this.emails=[],this.totalcount=0,this.source="fts",this.activeMessage$=new c.vpe,this._unreadonly=!0,this.isLoading=!1,this.emailopenness="",this.serviceSubscriptions=new m.w0,this.mailboxesLoaded$=new u.X(!1),this.getMailboxes(),this.serviceSubscriptions.add(this.broadcast.message$.subscribe((e=>{this.handleMessage(e)})))}ngOnDestroy(){this.serviceSubscriptions.unsubscribe()}get activeMessage(){return this._activeMessage}set activeMessage(e){this._activeMessage=e,this.activeMessage$.emit(e)}get activeMailBox(){return this._activeMailBox}set activeMailBox(e){this._activeMailBox=e,this.emails=[],this.totalcount=0}get unreadonly(){return this._unreadonly}set unreadonly(e){this._unreadonly=e,this.loadMessages()}getMailboxes(){this.backend.getRequest("module/Mailboxes/scope",{scope:"inbound"}).subscribe((e=>{for(let s of e)this.mailboxes.push({actionset:s.actionset,id:s.value,name:s.display,type:s.type});this.mailboxesLoaded$.next(!0)}))}handleMessage(e){if("Emails"===e.messagedata.module)switch(e.messagetype){case"model.delete":let s=this.emails.findIndex((s=>s.id==e.messagedata.id));s>=0&&(this.activeMessage.id==e.messagedata.id&&(this.activeMessage=void 0),this.emails.splice(s,1),this.totalcount--);break;case"model.save":let i=this.emails.findIndex((s=>s.id==e.messagedata.id));i>=0&&(this.emails[i]=e.messagedata.data)}}fetchEmails(){let e=new g.x;return this.backend.getRequest("module/Mailboxes/"+this.activeMailBox.id+"/fetchemails").subscribe((s=>{s.new_mail_count>0&&this.loadMessages(),e.next({status:"success",newmailcount:s.new_mail_count}),e.complete()}),(s=>{e.error({status:"error",error:s}),e.complete()})),e.asObservable()}generateFilters(){let e={logicaloperator:"and",groupscope:"all",conditions:[{field:"mailbox_id",filtervalue:this.activeMailBox.id,operator:"equals"}]};return"sms"==this.activeMailBox.type?e.conditions.push({field:"direction",filtervalue:"i",operator:"equals"}):(e.conditions.push({field:"type",filtervalue:"inbound",operator:"equals"}),this.emailopenness&&e.conditions.push({field:"openness",filtervalue:this.emailopenness,operator:"equals"}),this.unreadonly&&e.conditions.push({field:"status",filtervalue:"unread",operator:"equals"})),e}get endpoint(){return"sms"==this.activeMailBox.type?"module/TextMessages":"module/Emails"}get requestFields(){return"sms"==this.activeMailBox.type?["name","id","msisdn_e164","date_sent","description"]:["name","id","from_addr_name","date_sent","status","openness","sentiment","magnitude"]}loadMessages(){if(!this.activeMailBox||this.activeMailBox&&!this.activeMailBox.id)return!1;this.activeMessage=void 0,this.emails=[];this.activeMailBox.id;let e={filter:this.generateFilters(),sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}],fields:JSON.stringify(this.requestFields),limit:this.limit,searchterm:this.searchTerm};this.isLoading=!0,this.backend.getRequest(this.endpoint,e).subscribe((e=>{this.emails=e.list,this.source=e.source,this.totalcount=e.totalcount,this.isLoading=!1}))}loadMore(){if(this.isLoading||this.emails.length>=this.totalcount)return!1;this.isLoading=!0;let e={fields:JSON.stringify(this.requestFields),filter:this.generateFilters(),limit:this.limit,offset:this.emails.length,sortfields:[{sortdirection:"DESC",sortfield:"date_sent"}]};this.backend.getRequest(this.endpoint,e).subscribe((e=>{e.list.length>0&&(this.emails=this.emails.concat(e.list),this.source=e.source,this.totalcount=e.totalcount),this.isLoading=!1}))}}return mailboxesEmails.ɵfac=function(e){return new(e||mailboxesEmails)(c.LFG(h.y),c.LFG(b.f))},mailboxesEmails.ɵprov=c.Yz7({token:mailboxesEmails,factory:mailboxesEmails.ɵfac}),mailboxesEmails})();var x=i(2032),f=i(7017),M=i(3194),v=i(5329),y=i(4154),E=i(6625),Z=i(7514),T=i(3463),L=i(8859),w=i(5982),C=i(2656),k=i(6271);function J(e,s){if(1&e&&(c.TgZ(0,"option",33),c._uU(1),c.qZA()),2&e){const e=s.$implicit;c.s9C("value",e.id),c.xp6(1),c.hij(" ",e.name," ")}}const A=function(e){return{"slds-has-error":e}};function S(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"div",34)(1,"div",35),c._UZ(2,"system-utility-icon",36),c.TgZ(3,"input",37),c.NdJ("ngModelChange",(function(s){c.CHM(e);return c.oxw().searchTerm=s}))("keyup.enter",(function(){c.CHM(e);return c.oxw().reloadList()})),c.qZA(),c.TgZ(4,"button",38),c.NdJ("click",(function(){c.CHM(e);return c.oxw().clearSearchTerm()})),c._UZ(5,"system-button-icon",39),c.qZA()()()}if(2&e){const e=c.oxw();c.Q6J("ngClass",c.VKq(4,A,e.searchTermError)),c.xp6(3),c.Q6J("placeholder",e.language.getModuleCombinedLabel("LBL_SEARCH","Mailboxes"))("ngModel",e.searchTerm),c.xp6(1),c.Q6J("disabled",!e.mailboxesEmails.searchTerm)}}let B=(()=>{class MailboxManagerHeader{constructor(e,s,i,t,l){this.language=e,this.mailboxesEmails=s,this.metadata=i,this.navigationtab=t,this.configuration=l,this.splitTypeOptions=[{value:"noSplit",icon:"picklist_type",title:"LBL_NO_SPLIT"},{value:"verticalSplit",icon:"side_list",title:"LBL_VERTICAL_SPLIT"},{value:"horizontalSplit",icon:"inspector_panel",title:"LBL_HORIZONTAL_SPLIT"}],this.searchTermError=!1,this.isFetching=!1;let a=this.metadata.getComponentConfig("MailboxManagerHeader");this.emailopenness=a.selectionstatus?a.selectionstatus:"",this.mailboxesEmails.unreadonly=!!a.unreadonly&&a.unreadonly}get mailbox(){return this._mailbox}set mailbox(e){this._mailbox=e,e?(this.mailboxesEmails.activeMailBox=this.mailboxesEmails.mailboxes.find((s=>s.id==e)),this.mailboxesEmails.loadMessages(),this.navigationtab.setTabInfo({displayname:this.mailboxesEmails.activeMailBox.name,displaymodule:"Mailboxes"})):this.mailboxesEmails.activeMailBox={}}get emailopenness(){return""==this.mailboxesEmails.emailopenness?"all":this.mailboxesEmails.emailopenness}set emailopenness(e){this.mailboxesEmails.emailopenness="all"==e?"":e,this.mailboxesEmails.loadMessages()}get buttonenabled(){return this.mailboxesEmails.activeMailBox&&!this.mailboxesEmails.isLoading&&!this.isFetching}get searchTerm(){return this.mailboxesEmails.searchTerm}set searchTerm(e){e!=this.mailboxesEmails.searchTerm&&(this.mailboxesEmails.searchTerm=e,""==e||this.searchTermsValid(e)?(this.searchTermError=!1,this.reloadList()):(this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTermError=!0))}ngOnInit(){this.navigationtab.activeRoute.params.id&&this.mailboxesEmails.mailboxesLoaded$.subscribe((e=>{!0===e&&(this.mailbox=this.navigationtab.activeRoute.params.id)}))}clearSearchTerm(){this.mailboxesEmails.searchTerm=void 0,this.reloadList()}searchTermsValid(e){let s=this.configuration.getCapabilityConfig("search"),i=s.min_ngram?parseInt(s.min_ngram,10):3,t=s.max_ngram?parseInt(s.max_ngram,10):20;return 0==e.split(" ").filter((e=>e.length<i||e.length>t)).length}reloadList(){this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout((()=>this.mailboxesEmails.loadMessages()),1e3)}fetchEmails(){this.isFetching=!0,this.mailboxesEmails.fetchEmails().subscribe((e=>{this.isFetching=!1}),(e=>{this.isFetching=!1}))}setActiveSplitType(e){const s={name:e};switch(e){case"noSplit":this.mailboxesEmails.activeMessage=null,s.icon="picklist_type",s.label="LBL_NO_SPLIT";break;case"verticalSplit":s.icon="side_list",s.label="LBL_VERTICAL_SPLIT";break;case"horizontalSplit":s.icon="inspector_panel",s.label="LBL_HORIZONTAL_SPLIT"}this.mailboxesEmails.activeSplitType=s}}return MailboxManagerHeader.ɵfac=function(e){return new(e||MailboxManagerHeader)(c.Y36(v.d),c.Y36(p),c.Y36(y.Pu),c.Y36(f.d),c.Y36(E.C))},MailboxManagerHeader.ɵcmp=c.Xpm({type:MailboxManagerHeader,selectors:[["mailbox-manager-header"]],decls:41,vars:13,consts:[[1,"slds-grid","slds-form--inline","slds-p-around--small","slds-border--bottom"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-form-element__control","slds-p-right--xx-small"],[1,"slds-select",2,"min-width","250px",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"slds-form-element__control","slds-p-horizontal--xx-small"],[3,"ngModel","ngModelChange"],["label","LBL_UNREAD_ONLY"],[1,"slds-select",3,"ngModel","ngModelChange"],["value","all"],["label","LBL_EMAILS_ALL"],["value","open"],["label","LBL_EMAILS_OPEN"],["value","user_closed"],["label","LBL_EMAILS_USER_CLOSED"],["value","system_closed"],["label","LBL_EMAILS_SYSTEM_CLOSED"],[1,"slds-p-horizontal--xx-small"],[1,"slds-list_horizontal","slds-has-dividers_left","slds-has-block-links_space"],[1,"slds-item"],["label","LBL_OF"],["label","LBL_ITEMS"],["size","xx-small",3,"icon"],["class","slds-form-element slds-p-right--small slds-m-left--small","style","width: 400px",3,"ngClass",4,"ngIf"],[1,"slds-col--bump-left","slds-grid"],[1,"slds-m-horizontal--xx-small"],[3,"ngModel","inputOptions","ngModelChange"],[1,"slds-button-group"],[1,"slds-button","slds-button--neutral",3,"disabled","click"],["icon","refresh",1,"slds-button__icon--left"],["label","LBL_REFRESH"],["icon","email",1,"slds-button__icon--left"],["label","LBL_FETCH_EMAILS"],[3,"value"],[1,"slds-form-element","slds-p-right--small","slds-m-left--small",2,"width","400px",3,"ngClass"],[1,"slds-form-element__control","slds-input-has-icon","slds-input-has-icon--left-right","slds-size--1-of-1"],["icon","search","size","x-small","addclasses","slds-icon slds-input__icon slds-input__icon_left"],["system-autofocus","","type","search",1,"slds-input","slds-lookup__search-input",2,"max-width","400px",3,"placeholder","ngModel","ngModelChange","keyup.enter"],[1,"slds-button","slds-button_icon","slds-input__icon","slds-input__icon_right",3,"disabled","click"],["icon","clear"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"select",3),c.NdJ("ngModelChange",(function(e){return s.mailbox=e})),c.YNc(4,J,2,2,"option",4),c.qZA()(),c.TgZ(5,"div",5)(6,"system-checkbox",6),c.NdJ("ngModelChange",(function(e){return s.mailboxesEmails.unreadonly=e})),c._UZ(7,"system-label",7),c.qZA()(),c.TgZ(8,"div",5)(9,"select",8),c.NdJ("ngModelChange",(function(e){return s.emailopenness=e})),c.TgZ(10,"option",9),c._UZ(11,"system-label",10),c.qZA(),c.TgZ(12,"option",11),c._UZ(13,"system-label",12),c.qZA(),c.TgZ(14,"option",13),c._UZ(15,"system-label",14),c.qZA(),c.TgZ(16,"option",15),c._UZ(17,"system-label",16),c.qZA()()(),c.TgZ(18,"div",17)(19,"ul",18)(20,"li",19)(21,"span"),c._uU(22),c._UZ(23,"system-label",20),c._uU(24),c._UZ(25,"system-label",21),c.qZA()(),c.TgZ(26,"li",19),c._UZ(27,"system-utility-icon",22),c.qZA()()(),c.YNc(28,S,6,6,"div",23),c.qZA(),c.TgZ(29,"div",24)(30,"div",25)(31,"system-input-radio-button-group",26),c.NdJ("ngModelChange",(function(e){return s.setActiveSplitType(e)})),c.qZA()(),c.TgZ(32,"div",27)(33,"button",28),c.NdJ("click",(function(){return s.reloadList()})),c._UZ(34,"system-button-icon",29),c.TgZ(35,"span"),c._UZ(36,"system-label",30),c.qZA()(),c.TgZ(37,"button",28),c.NdJ("click",(function(){return s.fetchEmails()})),c._UZ(38,"system-button-icon",31),c.TgZ(39,"span"),c._UZ(40,"system-label",32),c.qZA()()()()()),2&e&&(c.xp6(3),c.Q6J("ngModel",s.mailbox)("disabled",0==s.mailboxesEmails.mailboxes.length||s.isFetching),c.xp6(1),c.Q6J("ngForOf",s.mailboxesEmails.mailboxes),c.xp6(2),c.Q6J("ngModel",s.mailboxesEmails.unreadonly),c.xp6(3),c.Q6J("ngModel",s.emailopenness),c.xp6(13),c.hij("",s.mailboxesEmails.emails.length," "),c.xp6(2),c.hij(" ",s.mailboxesEmails.totalcount," "),c.xp6(3),c.Q6J("icon","db"==s.mailboxesEmails.source?"database":"feed"),c.xp6(1),c.Q6J("ngIf",!!s.mailbox),c.xp6(3),c.Q6J("ngModel",s.mailboxesEmails.activeSplitType.name)("inputOptions",s.splitTypeOptions),c.xp6(2),c.Q6J("disabled",!s.buttonenabled),c.xp6(4),c.Q6J("disabled",!s.buttonenabled))},directives:[l.EJ,l.JJ,l.On,t.sg,l.YN,l.Kr,Z.U,T._,L.r,t.O5,t.mk,l.Fj,w.m,C.J,k.p],encapsulation:2}),MailboxManagerHeader})();var Y=i(5710),q=i(2294),F=i(6163),I=i(3634);function Q(e,s){1&e&&c._UZ(0,"system-utility-icon",9)}const N=function(e){return{"slds-theme_default":e}},O=function(){return{fieldtype:"emailsubject"}},U=function(){return{fieldtype:"activitydate"}};let R=(()=>{class MailboxManagerEmail{constructor(e,s,i,t,l,a){this.metadata=e,this.language=s,this.mailboxesEmails=i,this.view=t,this.model=l,this.modelutilities=a,this.email={},this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerEmail").fieldset}ngOnInit(){this.model.module="Emails",this.model.id=this.email.id,this.model.setData(this.email)}selectMail(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.email.status&&(e["font-weight"]="bold"),this.email.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}}return MailboxManagerEmail.ɵfac=function(e){return new(e||MailboxManagerEmail)(c.Y36(y.Pu),c.Y36(v.d),c.Y36(p),c.Y36(q.e),c.Y36(Y.o),c.Y36(F.A))},MailboxManagerEmail.ɵcmp=c.Xpm({type:MailboxManagerEmail,selectors:[["mailbox-manager-email"]],inputs:{email:"email"},features:[c._Bn([Y.o,q.e])],decls:9,vars:10,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--xx-small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid"],[1,"slds-grow","slds-truncate"],["field","name","fielddisplayclass","",1,"slds-grow","slds-truncate","slds-p-right--xx-small","spice-display-block",3,"fieldconfig"],["field","from_addr","fielddisplayclass","",1,"slds-truncate","spice-display-block",2,"min-width","220px","width","220px"],[1,"slds-p-left--xx-small","slds-truncate","slds-grid","slds-grid--align-spread",2,"min-width","100px","width","100px"],[2,"width","22px"],["icon","attach","size","xx-small","class","slds-p-right--x-small",4,"ngIf"],["field","date_sent","fielddisplayclass","",1,"slds-truncate",3,"fieldconfig"],["icon","attach","size","xx-small",1,"slds-p-right--x-small"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0),c.NdJ("click",(function(){return s.selectMail(s.email)})),c.TgZ(1,"div",1)(2,"div",2),c._UZ(3,"field-container",3)(4,"field-container",4),c.qZA(),c.TgZ(5,"div",5)(6,"div",6),c.YNc(7,Q,1,0,"system-utility-icon",7),c.qZA(),c._UZ(8,"field-container",8),c.qZA()()()),2&e&&(c.Q6J("ngClass",c.VKq(6,N,s.isSelected)),c.xp6(2),c.ekj("slds-grid","verticalSplit"!=(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),c.xp6(1),c.Q6J("fieldconfig",c.DdM(8,O)),c.xp6(4),c.Q6J("ngIf",s.email.attachments_count>0),c.xp6(1),c.Q6J("fieldconfig",c.DdM(9,U)))},directives:[t.mk,I.j,t.O5,L.r],encapsulation:2}),MailboxManagerEmail})();var H=i(4664);function z(e,s){if(1&e&&c._UZ(0,"mailbox-manager-email",4),2&e){const e=s.$implicit;c.Q6J("email",e)}}function D(e,s){1&e&&(c.TgZ(0,"div",5),c._UZ(1,"system-spinner"),c.qZA())}let j=(()=>{class MailboxManagerEmails{constructor(e){this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}}return MailboxManagerEmails.ɵfac=function(e){return new(e||MailboxManagerEmails)(c.Y36(p))},MailboxManagerEmails.ɵcmp=c.Xpm({type:MailboxManagerEmails,selectors:[["mailbox-manager-emails"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-height_full","slds-border--right",3,"scroll"],["scrollContainer",""],[3,"email",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium slds-align--absolute-center",4,"ngIf"],[3,"email"],[1,"slds-p-around--medium","slds-align--absolute-center"]],template:function(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"div",0,1),c.NdJ("scroll",(function(){c.CHM(e);const i=c.MAs(1);return s.loadmore(i)})),c.YNc(2,z,1,1,"mailbox-manager-email",2),c.YNc(3,D,2,0,"div",3),c.qZA()}2&e&&(c.xp6(2),c.Q6J("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),c.xp6(1),c.Q6J("ngIf",s.mailboxesEmails.isLoading))},directives:[t.sg,R,t.O5,H.W],encapsulation:2}),MailboxManagerEmails})();var P=i(9062);const $=function(e){return{"slds-theme_default":e}};let X=(()=>{class MailboxManagerTextMessage{constructor(e,s,i,t,l,a){this.metadata=e,this.language=s,this.mailboxesEmails=i,this.view=t,this.model=l,this.modelutilities=a,this.message={},this.view.displayLinks=!1,this.view.displayLabels=!1,this.fieldset=this.metadata.getComponentConfig("MailboxManagerTextMessage").fieldset}ngOnInit(){this.model.module="TextMessages",this.model.id=this.message.id,this.model.setData(this.message)}selectTextmessage(e){this.mailboxesEmails.activeMessage&&e.id==this.mailboxesEmails.activeMessage.id||(this.mailboxesEmails.activeMessage=e)}get isSelected(){return this.mailboxesEmails.activeMessage&&this.mailboxesEmails.activeMessage.id==this.model.id}get nameStyle(){let e={};switch("unread"===this.message.status&&(e["font-weight"]="bold"),this.message.openness){case"user_closed":case"system_closed":e["text-decoration"]="line-through"}return e}}return MailboxManagerTextMessage.ɵfac=function(e){return new(e||MailboxManagerTextMessage)(c.Y36(y.Pu),c.Y36(v.d),c.Y36(p),c.Y36(q.e),c.Y36(Y.o),c.Y36(F.A))},MailboxManagerTextMessage.ɵcmp=c.Xpm({type:MailboxManagerTextMessage,selectors:[["mailbox-manager-textmessage"]],inputs:{message:"message"},features:[c._Bn([Y.o,q.e])],decls:7,vars:6,consts:[[1,"slds-p-horizontal--small","slds-p-vertical--small","slds-border--bottom",2,"cursor","pointer",3,"ngClass","click"],[1,"slds-grid","slds-grid--vertical-align-center"],[1,"slds-text-title_caps","slds-truncate",3,"ngStyle"],[1,"slds-col--bump-left","slds-p-left--xx-small"],["field","date_sent","fielddisplayclass","slds-truncate"],["fielddisplayclass","",3,"fieldset"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0),c.NdJ("click",(function(){return s.selectTextmessage(s.message)})),c.TgZ(1,"div",1)(2,"div",2),c._uU(3),c.qZA(),c.TgZ(4,"div",3),c._UZ(5,"field-container",4),c.qZA()(),c._UZ(6,"object-record-fieldset",5),c.qZA()),2&e&&(c.Q6J("ngClass",c.VKq(4,$,s.isSelected)),c.xp6(2),c.Q6J("ngStyle",s.nameStyle),c.xp6(1),c.Oqu(s.message.description),c.xp6(3),c.Q6J("fieldset",s.fieldset))},directives:[t.mk,t.PC,I.j,P.d],encapsulation:2}),MailboxManagerTextMessage})();function G(e,s){if(1&e&&c._UZ(0,"mailbox-manager-textmessage",4),2&e){const e=s.$implicit;c.Q6J("message",e)}}function V(e,s){1&e&&(c.TgZ(0,"div",5),c._UZ(1,"system-spinner"),c.qZA())}let K=(()=>{class MailboxManagerTextMessages{constructor(e){this.mailboxesEmails=e}trackbyfn(e,s){return s.id}loadmore(e){e.scrollTop+e.clientHeight+50>e.scrollHeight&&this.mailboxesEmails.loadMore()}}return MailboxManagerTextMessages.ɵfac=function(e){return new(e||MailboxManagerTextMessages)(c.Y36(p))},MailboxManagerTextMessages.ɵcmp=c.Xpm({type:MailboxManagerTextMessages,selectors:[["mailbox-manager-textmessages"]],decls:4,vars:3,consts:[[1,"slds-scrollable--y","slds-border--right","slds-height_full",3,"scroll"],["scrollContainer",""],[3,"message",4,"ngFor","ngForOf","ngForTrackBy"],["class","slds-p-around--medium",4,"ngIf"],[3,"message"],[1,"slds-p-around--medium"]],template:function(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"div",0,1),c.NdJ("scroll",(function(){c.CHM(e);const i=c.MAs(1);return s.loadmore(i)})),c.YNc(2,G,1,1,"mailbox-manager-textmessage",2),c.YNc(3,V,2,0,"div",3),c.qZA()}2&e&&(c.xp6(2),c.Q6J("ngForOf",s.mailboxesEmails.emails)("ngForTrackBy",s.trackbyfn),c.xp6(1),c.Q6J("ngIf",s.mailboxesEmails.isLoading))},directives:[t.sg,X,t.O5,H.W],encapsulation:2}),MailboxManagerTextMessages})();var W=i(3278),ee=i(4044),se=i(151),ie=i(4561),te=i(5931),le=i(8861);const ae=["detailscontent"];function oe(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"button",9),c.NdJ("click",(function(){c.CHM(e);return c.oxw().goBack()})),c._UZ(1,"system-button-icon",10),c.qZA()}}function ne(e,s){if(1&e&&(c.ynx(0),c._uU(1),c.BQk()),2&e){const e=c.oxw(2);c.xp6(1),c.Oqu(e.model.data.summary_text)}}function de(e,s){if(1&e&&c._UZ(0,"object-record-fieldset-horizontal-list",31),2&e){const e=c.oxw(2);c.Q6J("fieldset",e.fieldset)}}function re(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"button",26),c.NdJ("click",(function(){c.CHM(e);return c.oxw(2).delete()})),c._UZ(1,"system-button-icon",32),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("title",e.language.getLabel("LBL_DELETE"))}}function ce(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"button",33),c.NdJ("click",(function(){c.CHM(e);return c.oxw(2).markUnread()})),c._UZ(1,"system-button-icon",34),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_UNREAD"))}}function me(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"button",33),c.NdJ("click",(function(){c.CHM(e);return c.oxw(2).completeMail()})),c._UZ(1,"system-button-icon",35),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_MARK_USER_CLOSED"))}}function ue(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"button",33),c.NdJ("click",(function(){c.CHM(e);return c.oxw(2).reopen()})),c._UZ(1,"system-button-icon",36),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",!e.model.checkAccess("edit"))("title",e.language.getLabel("LBL_REOPEN"))}}function ge(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14),c._UZ(4,"system-icon",15),c.TgZ(5,"div",16)(6,"ul",17)(7,"li",18),c._UZ(8,"field-container",19),c.qZA(),c.TgZ(9,"li",18),c._UZ(10,"field-container",20),c.qZA()(),c.TgZ(11,"h1",21),c.YNc(12,ne,2,1,"ng-container",22),c.YNc(13,de,1,1,"object-record-fieldset-horizontal-list",23),c.qZA()()()(),c.TgZ(14,"object-action-container",24),c.NdJ("actionemitter",(function(s){c.CHM(e);return c.oxw().handleAction(s)})),c.qZA(),c.TgZ(15,"div",25)(16,"button",26),c.NdJ("click",(function(){c.CHM(e);return c.oxw().reply()})),c._UZ(17,"system-button-icon",27),c.qZA(),c.TgZ(18,"button",26),c.NdJ("click",(function(){c.CHM(e);return c.oxw().forward()})),c._UZ(19,"system-button-icon",28),c.qZA(),c.YNc(20,re,2,1,"button",29),c.YNc(21,ce,2,2,"button",30),c.YNc(22,me,2,2,"button",30),c.YNc(23,ue,2,2,"button",30),c.qZA()()()}if(2&e){const e=c.oxw();c.xp6(4),c.Q6J("module",e.model.module),c.xp6(8),c.Q6J("ngIf",!e.fieldset),c.xp6(1),c.Q6J("ngIf",e.fieldset),c.xp6(1),c.Q6J("actionset",e.actionSet),c.xp6(2),c.Q6J("title",e.language.getLabel("LBL_REPLY")),c.xp6(2),c.Q6J("title",e.language.getLabel("LBL_FORWARD")),c.xp6(2),c.Q6J("ngIf",e.model.checkAccess("delete")),c.xp6(1),c.Q6J("ngIf",e.isRead),c.xp6(1),c.Q6J("ngIf",!e.isUserClosed),c.xp6(1),c.Q6J("ngIf",e.isUserClosed)}}function he(e,s){1&e&&(c.TgZ(0,"div",37),c._UZ(1,"system-label",38),c.qZA())}const be=function(e){return{"slds-hide":e}};let pe=(()=>{class MailboxmanagerEmailDetails{constructor(e,s,i,t,l,a,o,n,d){this.language=e,this.metadata=s,this.model=i,this.mailboxesEmails=t,this.backend=l,this.toast=a,this.view=o,this.modal=n,this.injector=d,this.containerComponents=[],this.fieldset="",this.mailboxSubscription=this.mailboxesEmails.activeMessage$.subscribe((e=>{this.loadEmail(e)})),this.view.displayLabels=!1}ngOnDestroy(){this.mailboxSubscription.unsubscribe()}loadEmail(e){this.mailboxesEmails.activeMailBox&&("sms"==this.mailboxesEmails.activeMailBox.type?this.model.module="TextMessages":"email"==this.mailboxesEmails.activeMailBox.type&&(this.model.module="Emails")),this.model.initialize(),e?(this.model.id=e.id,this.buildContainer(),this.model.getData(!1,"").subscribe((e=>{"unread"==this.model.getFieldValue("status")&&this.setStatus("read")}))):this.model.id=void 0}destroyContainer(){for(let e of this.containerComponents)e.destroy();this.containerComponents=[]}handleAction(e){if("save"===e)this.buildContainer()}buildContainer(){this.destroyContainer();let e=this.metadata.getComponentConfig("MailboxmanagerEmailDetails",this.model.module),s="horizontalSplit"==this.mailboxesEmails.activeSplitType.name?e.horizontalComponentset:e.componentset;for(let e of this.metadata.getComponentSetObjects(s))this.metadata.addComponent(e.component,this.detailscontent).subscribe((s=>{s.instance.componentconfig=e.componentconfig?e.componentconfig:{},this.containerComponents.push(s)}));this.fieldset=e.fieldset}get isUserClosed(){return"user_closed"==this.model.getField("openness")}get isRead(){return"read"==this.model.getField("status")}get actionSet(){return this.mailboxesEmails.activeMailBox.actionset?this.mailboxesEmails.activeMailBox.actionset:""}completeMail(){this.setOpenness("user_closed")}markUnread(){this.setStatus("unread")}reopen(){this.setOpenness("open")}setStatus(e){this.model.setField("status",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/status",null,{status:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.status=e}),(s=>{this.toast.sendAlert("Cannot change status to "+e)}))}setOpenness(e){this.model.setField("openness",e),this.backend.postRequest("module/"+this.model.module+"/"+this.model.id+"/openness",null,{openness:e}).subscribe((s=>{this.mailboxesEmails.activeMessage.openness=e}),(s=>{this.toast.sendAlert("Cannot change openness to "+e)}))}reply(){this.modal.openModal("EmailReplyModal",!0,this.injector)}forward(){this.modal.openModal("EmailForwardModal",!0,this.injector)}delete(){this.model.delete()}goBack(){this.mailboxesEmails.activeMessage=null}}return MailboxmanagerEmailDetails.ɵfac=function(e){return new(e||MailboxmanagerEmailDetails)(c.Y36(v.d),c.Y36(y.Pu),c.Y36(Y.o),c.Y36(p),c.Y36(h.y),c.Y36(W.A),c.Y36(q.e),c.Y36(ee.o),c.Y36(c.zs3))},MailboxmanagerEmailDetails.ɵcmp=c.Xpm({type:MailboxmanagerEmailDetails,selectors:[["mailbox-manager-email-details"]],viewQuery:function(e,s){if(1&e&&c.Gf(ae,7,c.s_b),2&e){let e;c.iGM(e=c.CRH())&&(s.detailscontent=e.first)}},features:[c._Bn([Y.o,q.e])],decls:10,vars:8,consts:[[1,"slds-theme--shade","slds-height_full"],[1,"slds-grid","slds-grid--vertical","slds-height_full",3,"ngClass"],[1,"slds-grid","slds-border--bottom"],[1,"slds-grid","slds-grid--align-end","slds-p-vertical--medium",2,"width","3rem"],["system-title","LBL_BACK","class","slds-button slds-button--icon slds-button_icon-border-filled",3,"click",4,"ngIf"],["class","slds-p-around--medium slds-border--bottom slds-grow",4,"ngIf"],[1,"slds-m-around--x-small","slds-p-around--x-small","slds-theme--default","slds-scrollable--y","slds-grow",2,"min-height","0"],["detailscontent",""],["class","slds-align--absolute-center slds-height_full",4,"ngIf"],["system-title","LBL_BACK",1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"click"],["icon","back"],[1,"slds-p-around--medium","slds-border--bottom","slds-grow"],[1,"slds-grid"],[1,"slds-col","slds-has-flexi-truncate"],[1,"slds-media","slds-no-space","slds-grow"],[3,"module"],[1,"slds-media__body"],[1,"slds-list_horizontal","slds-has-dividers_left"],[1,"slds-item"],["field","date_sent","fielddisplayclass","slds-truncate"],["field","status","fielddisplayclass","slds-truncate"],[1,"slds-page-header__title","slds-m-right--small","slds-align-middle","slds-truncate"],[4,"ngIf"],[3,"fieldset",4,"ngIf"],[3,"actionset","actionemitter"],[1,"slds-p-left--small","slds-button-group"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"title","click"],["icon","reply"],["icon","forward"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"title","click",4,"ngIf"],["class","slds-button slds-button--icon slds-button_icon-border-filled",3,"disabled","title","click",4,"ngIf"],[3,"fieldset"],["icon","delete"],[1,"slds-button","slds-button--icon","slds-button_icon-border-filled",3,"disabled","title","click"],["icon","email"],["icon","unlock"],["icon","lock"],[1,"slds-align--absolute-center","slds-height_full"],["label","LBL_SELECT_EMAIL"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),c.YNc(4,oe,2,0,"button",4),c.qZA(),c.YNc(5,ge,24,10,"div",5),c.qZA(),c.TgZ(6,"div",6),c._UZ(7,"div",null,7),c.qZA()(),c.YNc(9,he,2,0,"div",8),c.qZA()),2&e&&(c.xp6(1),c.Q6J("ngClass",c.VKq(6,be,!s.model.id)),c.xp6(3),c.Q6J("ngIf","noSplit"==s.mailboxesEmails.activeSplitType.name),c.xp6(1),c.Q6J("ngIf",s.model.id),c.xp6(1),c.Udp("padding-left","noSplit"==s.mailboxesEmails.activeSplitType.name?3:.5,"rem"),c.xp6(3),c.Q6J("ngIf",!s.model.id))},directives:[t.mk,t.O5,se.S,C.J,ie.f,I.j,te.Z,le.S,T._],encapsulation:2}),MailboxmanagerEmailDetails})();function xe(e,s){if(1&e&&c._UZ(0,"mailbox-manager-emails",6),2&e){const e=c.oxw(2);c.ekj("slds-hide",e.mailboxesEmails.activeMessage)}}function fe(e,s){if(1&e&&c._UZ(0,"mailbox-manager-textmessages",6),2&e){const e=c.oxw(2);c.ekj("slds-hide",e.mailboxesEmails.activeMessage)}}function Me(e,s){if(1&e&&(c.TgZ(0,"div",4),c.YNc(1,xe,1,2,"mailbox-manager-emails",5),c.YNc(2,fe,1,2,"mailbox-manager-textmessages",5),c._UZ(3,"mailbox-manager-email-details",6),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngIf",e.isEmailMailbox),c.xp6(1),c.Q6J("ngIf",!e.isEmailMailbox),c.xp6(1),c.ekj("slds-hide",!e.mailboxesEmails.activeMessage)}}function ve(e,s){1&e&&c._UZ(0,"mailbox-manager-emails",9)}function _e(e,s){1&e&&c._UZ(0,"mailbox-manager-textmessages",9)}function ye(e,s){if(1&e&&(c.TgZ(0,"div",4),c.YNc(1,ve,1,0,"mailbox-manager-emails",7),c.YNc(2,_e,1,0,"mailbox-manager-textmessages",7),c._UZ(3,"mailbox-manager-email-details",8),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngIf",e.isEmailMailbox),c.xp6(1),c.Q6J("ngIf",!e.isEmailMailbox)}}function Ee(e,s){1&e&&c._UZ(0,"mailbox-manager-emails",13)}function Ze(e,s){1&e&&c._UZ(0,"mailbox-manager-textmessages",13)}function Te(e,s){if(1&e&&(c.TgZ(0,"div",10),c.YNc(1,Ee,1,0,"mailbox-manager-emails",11),c.YNc(2,Ze,1,0,"mailbox-manager-textmessages",11),c._UZ(3,"mailbox-manager-email-details",12),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngIf",e.isEmailMailbox),c.xp6(1),c.Q6J("ngIf",!e.isEmailMailbox)}}let Le=(()=>{class MailboxManager{constructor(e,s,i){this.navigation=e,this.navigationtab=s,this.mailboxesEmails=i,this.navigationtab.setTabInfo({displayname:"Mailboxes",displaymodule:"Mailboxes"})}get isEmailMailbox(){return!(!this.mailboxesEmails.activeMailBox||"email"!=this.mailboxesEmails.activeMailBox.type)}}return MailboxManager.ɵfac=function(e){return new(e||MailboxManager)(c.Y36(x.G),c.Y36(f.d),c.Y36(p))},MailboxManager.ɵcmp=c.Xpm({type:MailboxManager,selectors:[["mailbox-manager"]],features:[c._Bn([p])],decls:6,vars:6,consts:[["system-to-bottom-noscroll","",1,"slds-grid","slds-grid--vertical"],[3,"ngSwitch"],["class","slds-grid slds-grow","style","min-height: 0;",4,"ngSwitchCase"],["class","slds-grid slds-grid--vertical slds-grow","style","min-height: 0;",4,"ngSwitchCase"],[1,"slds-grid","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1 slds-height_full",3,"slds-hide",4,"ngIf"],[1,"slds-size--1-of-1","slds-height_full"],["class","slds-size--2-of-5",4,"ngIf"],[1,"slds-size--3-of-5"],[1,"slds-size--2-of-5"],[1,"slds-grid","slds-grid--vertical","slds-grow",2,"min-height","0"],["class","slds-size--1-of-1","style","height: 50%",4,"ngIf"],[1,"slds-size--1-of-1","slds-border--top",2,"height","50%"],[1,"slds-size--1-of-1",2,"height","50%"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0),c._UZ(1,"mailbox-manager-header"),c.ynx(2,1),c.YNc(3,Me,4,4,"div",2),c.YNc(4,ye,4,2,"div",2),c.YNc(5,Te,4,2,"div",3),c.BQk(),c.qZA()),2&e&&(c.xp6(1),c.ekj("slds-hide",!!s.mailboxesEmails.activeMessage&&"noSplit"==(null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name)),c.xp6(1),c.Q6J("ngSwitch",null==s.mailboxesEmails.activeSplitType?null:s.mailboxesEmails.activeSplitType.name),c.xp6(1),c.Q6J("ngSwitchCase","noSplit"),c.xp6(1),c.Q6J("ngSwitchCase","verticalSplit"),c.xp6(1),c.Q6J("ngSwitchCase","horizontalSplit"))},directives:[M.t,B,t.RF,t.n9,t.O5,j,K,pe],encapsulation:2}),MailboxManager})(),we=(()=>{class MailboxEmailToLeadButton{constructor(e,s,i,t,l){this.language=e,this.metadata=s,this.model=i,this.modal=t,this.toast=l}execute(){this.modal.openModal("MailboxEmailToLeadModal").subscribe((e=>{e.instance.email=this.model}))}}return MailboxEmailToLeadButton.ɵfac=function(e){return new(e||MailboxEmailToLeadButton)(c.Y36(v.d),c.Y36(y.Pu),c.Y36(Y.o),c.Y36(ee.o),c.Y36(W.A))},MailboxEmailToLeadButton.ɵcmp=c.Xpm({type:MailboxEmailToLeadButton,selectors:[["mailbox-email-to-lead-emailbutton"]],decls:2,vars:0,consts:[["label","LBL_NEW_FORM_TITLE"]],template:function(e,s){1&e&&(c.TgZ(0,"span"),c._UZ(1,"system-label",0),c.qZA())},directives:[T._],encapsulation:2}),MailboxEmailToLeadButton})();var Ce=i(9621),ke=i(1916),Je=i(3499),Ae=i(7674);const Se=["contextMenu"];function Be(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"li",7)(1,"a",8),c.NdJ("click",(function(){const s=c.CHM(e).$implicit;return c.oxw(2).setField(s)})),c.TgZ(2,"span",9),c._UZ(3,"system-label-fieldname",10),c.qZA()()()}if(2&e){const e=s.$implicit,i=c.oxw(2);c.xp6(3),c.Q6J("module",i.emailmodule)("field",e)}}function Ye(e,s){if(1&e&&(c.TgZ(0,"div",3,4)(2,"ul",5),c.YNc(3,Be,4,2,"li",6),c.qZA()()),2&e){const e=c.oxw();c.Q6J("ngStyle",e.contextMenuStyle),c.xp6(3),c.Q6J("ngForOf",e.emailfields)}}let qe=(()=>{class MailboxEmailToLeadEmailText{constructor(e,s,i){this.elementRef=e,this.renderer=s,this.language=i,this.emailtext="",this.emailhtml="",this.emailmodule="",this.emailfields=["first_name","last_name"],this.setfield=new c.vpe,this.clickListener=null,this.displayContextMenu=!1,this.displayContextCoordinates={top:0,left:0}}get content(){return this.emailhtml?this.emailhtml:this.emailtext}ngOnDestroy(){this.clickListener&&this.clickListener()}showContextMenu(e){this.selectedText&&(e.preventDefault(),this.displayContextMenu=!0,this.displayContextCoordinates.top=e.clientY,this.displayContextCoordinates.left=e.clientX,this.clickListener=this.renderer.listen("document","click",(e=>this.onClick(e))))}get selectedText(){let e=window.getSelection().toString();return e?e.trim():""}get contextMenuStyle(){let e=this.elementRef.nativeElement.getBoundingClientRect();return{left:this.displayContextCoordinates.left-e.left+"px",top:this.displayContextCoordinates.top-e.top+"px"}}onClick(e){this.contextMenu.element.nativeElement.contains(e.target)||(this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null))}setField(e){this.displayContextMenu=!1,this.clickListener&&(this.clickListener(),this.clickListener=null),this.setfield.emit({field:e,value:this.selectedText})}}return MailboxEmailToLeadEmailText.ɵfac=function(e){return new(e||MailboxEmailToLeadEmailText)(c.Y36(c.SBq),c.Y36(c.Qsj),c.Y36(v.d))},MailboxEmailToLeadEmailText.ɵcmp=c.Xpm({type:MailboxEmailToLeadEmailText,selectors:[["mailbox-email-to-lead-emailtext"]],viewQuery:function(e,s){if(1&e&&c.Gf(Se,7,c.s_b),2&e){let e;c.iGM(e=c.CRH())&&(s.contextMenu=e.first)}},inputs:{emailtext:"emailtext",emailhtml:"emailhtml",emailmodule:"emailmodule",emailfields:"emailfields"},outputs:{setfield:"setfield"},decls:3,vars:2,consts:[[1,"slds-form-element","slds-is-relative",2,"height","100%"],[1,"slds-box","slds-scrollable",2,"height","100%",3,"innerHTML","contextmenu"],["class","slds-dropdown slds-dropdown_left slds-is-absolute",3,"ngStyle",4,"ngIf"],[1,"slds-dropdown","slds-dropdown_left","slds-is-absolute",3,"ngStyle"],["contextMenu",""],["role","menu",1,"slds-dropdown__list"],["class","slds-dropdown__item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"slds-dropdown__item"],["href","javascript:void(0);","role","menuitem","tabindex","0",3,"click"],[1,"slds-truncate"],[3,"module","field"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0)(1,"div",1),c.NdJ("contextmenu",(function(e){return s.showContextMenu(e)})),c.qZA(),c.YNc(2,Ye,4,2,"div",2),c.qZA()),2&e&&(c.xp6(1),c.Q6J("innerHTML",s.content,c.oJD),c.xp6(1),c.Q6J("ngIf",s.displayContextMenu))},directives:[t.O5,t.PC,t.sg,Ae.h],encapsulation:2}),MailboxEmailToLeadEmailText})();var Fe=i(5767);const Ie=["detailcontainer"];let Qe=(()=>{class MailboxEmailToLeadModal{constructor(e,s,i,t){this.language=e,this.metadata=s,this.view=i,this.model=t,this.email=null,this.self=null,this.componentRefs=[],this.leadFields=["first_name","last_name","department","account_name","phone_mobile","phone_work","email1","primary_address_street","primary_address_city","primary_address_postalcode","primary_address_country","description"],this.model.module="Leads"}ngOnInit(){this.model.initializeModel(this.email),this.view.isEditable=!0,this.view.setEditMode()}ngAfterViewInit(){this.buildContainer()}closeModal(){this.self.destroy()}buildContainer(){for(let e of this.componentRefs)e.destroy();this.componentRefs=[];let e=this.metadata.getComponentConfig("ObjectRecordDetails",this.model.module);for(let s of this.metadata.getComponentSetObjects(e.componentset))this.metadata.addComponent(s.component,this.detailcontainer).subscribe((e=>{e.instance.componentconfig=s.componentconfig,this.componentRefs.push(e)}))}setField(e){this.model.setField(e.field,e.value)}saveLead(){this.model.save().subscribe((e=>{this.closeModal()}))}}return MailboxEmailToLeadModal.ɵfac=function(e){return new(e||MailboxEmailToLeadModal)(c.Y36(v.d),c.Y36(y.Pu),c.Y36(q.e),c.Y36(Y.o))},MailboxEmailToLeadModal.ɵcmp=c.Xpm({type:MailboxEmailToLeadModal,selectors:[["ng-component"]],viewQuery:function(e,s){if(1&e&&c.Gf(Ie,7,c.s_b),2&e){let e;c.iGM(e=c.CRH())&&(s.detailcontainer=e.first)}},features:[c._Bn([Y.o,q.e])],decls:15,vars:4,consts:[["size","large"],[3,"close"],["label","LBL_NEW_FORM_TITLE"],[1,"slds-grid",2,"height","70vh"],[1,"slds-size--1-of-2","slds-p-around--small",2,"height","100%"],[3,"emailmodule","emailtext","emailhtml","emailfields","setfield"],[1,"slds-size--1-of-2","slds-scrollable",2,"height","100%"],["detailcontainer",""],[1,"slds-button","slds-button--neutral",3,"click"],["label","LBL_CANCEL"],[1,"slds-button","slds-button--brand",3,"click"],["label","LBL_SAVE"]],template:function(e,s){1&e&&(c.TgZ(0,"system-modal",0)(1,"system-modal-header",1),c.NdJ("close",(function(){return s.closeModal()})),c._UZ(2,"system-label",2),c.qZA(),c.TgZ(3,"system-modal-content")(4,"div",3)(5,"div",4)(6,"mailbox-email-to-lead-emailtext",5),c.NdJ("setfield",(function(e){return s.setField(e)})),c.qZA()(),c.TgZ(7,"div",6),c._UZ(8,"div",null,7),c.qZA()()(),c.TgZ(10,"system-modal-footer")(11,"button",8),c.NdJ("click",(function(){return s.closeModal()})),c._UZ(12,"system-label",9),c.qZA(),c.TgZ(13,"button",10),c.NdJ("click",(function(){return s.saveLead()})),c._UZ(14,"system-label",11),c.qZA()()()),2&e&&(c.xp6(6),c.Q6J("emailmodule",s.model.module)("emailtext",s.email.data.description)("emailhtml",s.email.data.body)("emailfields",s.leadFields))},directives:[Ce.j,ke.y,T._,Je.x,qe,Fe.p],encapsulation:2}),MailboxEmailToLeadModal})();var Ne=i(2480),Oe=i(2161);const Ue=["tablecontainer"];function Re(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"tr",16),c.NdJ("click",(function(){const s=c.CHM(e).$implicit;return c.oxw(2).goToRecord(s.id)})),c.TgZ(1,"td",17)(2,"div",18),c._uU(3),c.qZA()(),c.TgZ(4,"td",19)(5,"div",20),c._uU(6),c.qZA()(),c.TgZ(7,"td",19)(8,"div",18),c._uU(9),c.qZA()()()}if(2&e){const e=s.$implicit;c.xp6(3),c.hij(" ",e.name," "),c.xp6(2),c.ekj("slds-p-horizontal--xx-small",(null==e?null:e.emailsunread)>9),c.Q6J("ngClass",(null==e?null:e.emailsunread)>0?"slds-badge slds-theme--success":""),c.xp6(1),c.hij(" ",e.emailsunread," "),c.xp6(3),c.hij(" ",e.emailsread," ")}}function He(e,s){if(1&e&&(c.TgZ(0,"tbody"),c.YNc(1,Re,10,6,"tr",15),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.mailboxes)("ngForTrackBy",e.trackByFn)}}function ze(e,s){1&e&&c._UZ(0,"tbody",21),2&e&&c.Q6J("columns",3)}let De=(()=>{class MailboxesDashlet{constructor(e,s,i,t){this.language=e,this.backend=s,this.model=i,this.router=t,this.isLoading=!1,this.mailboxes=[],this.canLoadMore=!0,this.loadLimit=20,this.getMailBoxesInterval=void 0}ngOnInit(){this.model.module="Mailboxes",this.getMailboxes(),this.getMailBoxesInterval=this.getMailboxesInterval()}ngOnDestroy(){this.getMailBoxesInterval&&window.clearInterval(this.getMailBoxesInterval)}trackByFn(e,s){return s.id}getMailboxes(e){this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((s=>{if(!s||0==s.length)return this.isLoading=!1;s.map((e=>e.emailsread=e.emailsread-e.emailsclosed)),e?this.mailboxes.every((e=>(s.some((s=>{if(s.id==e.id)return e.emailsread=s.emailsread,e.emailsunread=s.emailsunread,!0})),!0))):this.mailboxes=s,s.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1}))}getMailboxesInterval(){return window.setInterval((()=>this.getMailboxes(!0)),6e4)}onScroll(){let e=this.tablecontainer.element.nativeElement;e.scrollTop+e.clientHeight>=e.scrollHeight&&this.loadMore()}goToRecord(e){this.router.navigate([`/module/${this.model.module}/${e}`])}loadMore(){this.canLoadMore&&(this.isLoading=!0,this.backend.getRequest("module/Mailboxes/dashlet").subscribe((e=>{this.mailboxes=this.mailboxes.concat(e),e.length<this.loadLimit&&(this.canLoadMore=!1),this.isLoading=!1})))}}return MailboxesDashlet.ɵfac=function(e){return new(e||MailboxesDashlet)(c.Y36(v.d),c.Y36(h.y),c.Y36(Y.o),c.Y36(Ne.F0))},MailboxesDashlet.ɵcmp=c.Xpm({type:MailboxesDashlet,selectors:[["dashboard-mailboxes-dashlet"]],viewQuery:function(e,s){if(1&e&&c.Gf(Ue,7,c.s_b),2&e){let e;c.iGM(e=c.CRH())&&(s.tablecontainer=e.first)}},features:[c._Bn([Y.o,q.e])],decls:21,vars:2,consts:[[1,"slds-grid","slds-grid--vertical",2,"height","100%"],[1,"slds-grid","slds-grid--vertical-align-center","slds-border--bottom","slds-p-around--x-small"],["module","Mailboxes","size","small"],[1,"slds-text-heading--medium","slds-p-bottom--xx-small"],[1,"slds-scrollable--y","slds-grow",2,"width","100%",3,"scroll"],["tablecontainer",""],[1,"slds-table","slds-table_cell-buffer","slds-table_bordered","slds-table--fixed-layout","spice-table_header-fixed",2,"border-top","0"],[1,"slds-text-title_caps"],["scope","col"],[1,"slds-truncate","slds-text-align--center"],["label","LBL_NAME"],["label","LBL_UNREAD"],["label","LBL_READ"],[4,"ngIf"],["system-table-stencils","",3,"columns",4,"ngIf"],["style","cursor: pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[2,"cursor","pointer",3,"click"],[1,"slds-truncate",2,"min-width","120px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"width","fit-content","height","fit-content"],[1,"slds-truncate",2,"min-width","100px"],[1,"slds-truncate","slds-p-vertical--xxx-small","slds-align--absolute-center",2,"border-radius","50%","width","fit-content","height","fit-content",3,"ngClass"],["system-table-stencils","",3,"columns"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0)(1,"div",1),c._UZ(2,"system-icon",2),c.TgZ(3,"h2",3),c._uU(4,"Mailboxes"),c.qZA()(),c.TgZ(5,"div",4,5),c.NdJ("scroll",(function(){return s.onScroll()})),c.TgZ(7,"table",6)(8,"thead")(9,"tr",7)(10,"th",8)(11,"div",9),c._UZ(12,"system-label",10),c.qZA()(),c.TgZ(13,"th",8)(14,"div",9),c._UZ(15,"system-label",11),c.qZA()(),c.TgZ(16,"th",8)(17,"div",9),c._UZ(18,"system-label",12),c.qZA()()()(),c.YNc(19,He,2,2,"tbody",13),c.YNc(20,ze,1,1,"tbody",14),c.qZA()()()),2&e&&(c.xp6(19),c.Q6J("ngIf",!s.isLoading&&s.mailboxes.length>0),c.xp6(1),c.Q6J("ngIf",s.isLoading))},directives:[ie.f,T._,t.O5,t.sg,t.mk,Oe.x],encapsulation:2}),MailboxesDashlet})();var je=i(7040),Pe=i(2422),$e=i(6367),Xe=i(3208),Ge=i(5638);function Ve(e,s){if(1&e&&c._UZ(0,"field-label",3),2&e){const e=c.oxw();c.Q6J("fieldname",e.fieldname)("fieldconfig",e.fieldconfig)}}function Ke(e,s){if(1&e&&(c.ynx(0),c._uU(1),c.BQk()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.hij(" ",e.display," ")}}function We(e,s){if(1&e&&(c.ynx(0),c.YNc(1,Ke,2,1,"ng-container",6),c.BQk()),2&e){const e=s.$implicit,i=c.oxw(2);c.xp6(1),c.Q6J("ngIf",e.value==i.value)}}function es(e,s){if(1&e&&(c.TgZ(0,"field-generic-display",4),c.YNc(1,We,2,1,"ng-container",5),c.qZA()),2&e){const e=c.oxw();c.Q6J("fielddisplayclass",e.fielddisplayclass)("editable",e.isEditable())("fieldconfig",e.fieldconfig),c.xp6(1),c.Q6J("ngForOf",e.options)("ngForTrackBy",e.trackByFn)}}function ss(e,s){if(1&e&&(c.ynx(0),c.TgZ(1,"option",12),c._uU(2),c.qZA(),c.BQk()),2&e){const e=s.$implicit;c.xp6(1),c.Q6J("value",e.value),c.xp6(1),c.Oqu(e.display)}}function is(e,s){if(1&e){const e=c.EpF();c.TgZ(0,"div",7)(1,"div",8)(2,"div",9)(3,"select",10),c.NdJ("ngModelChange",(function(s){c.CHM(e);return c.oxw().value=s}))("ngModelChange",(function(s){c.CHM(e);return c.oxw().setToPreferences(s)})),c.YNc(4,ss,3,2,"ng-container",5),c.qZA()(),c._UZ(5,"field-messages",11),c.qZA()()}if(2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngClass",e.getFieldClass()),c.xp6(2),c.Q6J("disabled",0==e.options.length)("ngModel",e.value),c.xp6(1),c.Q6J("ngForOf",e.options)("ngForTrackBy",e.trackByFn),c.xp6(1),c.Q6J("fieldname",e.fieldname)}}let ts=(()=>{class fieldMailboxes extends je.O{constructor(e,s,i,t,l,a,o,n,d){super(e,s,i,t,l),this.model=e,this.view=s,this.language=i,this.metadata=t,this.router=l,this.backend=a,this.configuration=o,this.userpreferences=n,this.cdRef=d,this.options=[]}get value(){return this.model.getField(this.fieldname)}set value(e){this.model.setField(this.fieldname,e)}get scope(){return this.fieldconfig.scope?this.fieldconfig.scope:"outboundsingle"}ngOnInit(){super.ngOnInit(),this.setValueFromPreferences(),this.getOptions()}getOptions(){const e=this.configuration.getData(`mailboxes${this.scope}`);_.isEmpty(e)?this.backend.getRequest("module/Mailboxes/scope",{scope:this.scope}).subscribe((e=>{this.options=e.sort(((e,s)=>e.display.localeCompare(s.display))),this.options.length>0&&!this.value&&this.model.setField(this.fieldname,this.options[0].value),this.configuration.setData(`mailboxes${this.scope}`,this.options),this.cdRef.detectChanges()})):this.options=e}trackByFn(e,s){return s.value}setValueFromPreferences(){if(this.value||this.fieldconfig.disableCache)return;const e=this.userpreferences.getPreference(`defaultmailbox_${this.scope}`);e&&this.model.setField(this.fieldname,e)}setToPreferences(e){this.fieldconfig.disableCache||this.userpreferences.setPreference(`defaultmailbox_${this.scope}`,e)}}return fieldMailboxes.ɵfac=function(e){return new(e||fieldMailboxes)(c.Y36(Y.o),c.Y36(q.e),c.Y36(v.d),c.Y36(y.Pu),c.Y36(Ne.F0),c.Y36(h.y),c.Y36(E.C),c.Y36(Pe.z),c.Y36(c.sBO))},fieldMailboxes.ɵcmp=c.Xpm({type:fieldMailboxes,selectors:[["ng-component"]],features:[c.qOj],decls:3,vars:3,consts:[[3,"fieldname","fieldconfig",4,"ngIf"],[3,"fielddisplayclass","editable","fieldconfig",4,"ngIf"],["class","slds-form-element",4,"ngIf"],[3,"fieldname","fieldconfig"],[3,"fielddisplayclass","editable","fieldconfig"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"slds-form-element"],[1,"slds-form-element__control",3,"ngClass"],[1,"slds-select_container","slds-m-vertical--xx-small"],[1,"slds-select",3,"disabled","ngModel","ngModelChange"],[3,"fieldname"],[3,"value"]],template:function(e,s){1&e&&(c.YNc(0,Ve,1,2,"field-label",0),c.YNc(1,es,2,5,"field-generic-display",1),c.YNc(2,is,6,6,"div",2)),2&e&&(c.Q6J("ngIf",s.displayLabel),c.xp6(1),c.Q6J("ngIf",!s.isEditMode()),c.xp6(1),c.Q6J("ngIf",s.isEditMode()))},directives:[t.O5,$e.q,Xe.D,t.sg,t.mk,l.EJ,l.JJ,l.On,l.YN,l.Kr,Ge.a],encapsulation:2}),fieldMailboxes})(),ls=(()=>{class ModuleMailboxes{}return ModuleMailboxes.ɵfac=function(e){return new(e||ModuleMailboxes)},ModuleMailboxes.ɵmod=c.oAB({type:ModuleMailboxes}),ModuleMailboxes.ɵinj=c.cJS({imports:[[t.ez,l.u5,d.ObjectFields,o.GlobalComponents,n.ObjectComponents,r.SystemComponents,a.o]]}),ModuleMailboxes})();("undefined"==typeof ngJitMode||ngJitMode)&&c.kYT(ls,{declarations:[Le,B,j,R,pe,X,K,we,Qe,qe,De,ts],imports:[t.ez,l.u5,d.ObjectFields,o.GlobalComponents,n.ObjectComponents,r.SystemComponents,a.o]})}}]);