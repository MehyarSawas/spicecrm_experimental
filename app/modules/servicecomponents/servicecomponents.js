/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/** 
 * Â© 2015 - 2021 aac services k.s. All rights reserved.
 * release: 2021.01.001
 * date: 2021-03-18 21:30:15
 * build: 2021.01.001.1616099416007
 **/
"use strict";var __extends=this&&this.__extends||function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,i,s){var o,l=arguments.length,n=l<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(n=(l<3?o(n):3<l?o(t,i,n):o(t,i))||n);return 3<l&&n&&Object.defineProperty(t,i,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(i,s){return function(e,t){s(e,t,i)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ServicePlannerMapsModelPopover=exports.ServicePlanner=exports.ServiceOrderEffortConfirmationPanel=exports.ServiceOrderEffortConfirmationItem=exports.ServiceOrderItemConfirmationPanel=exports.ServiceOrderItemConfirmItem=exports.ServiceOrderConfirmModal=exports.ServiceOrderConfirmButton=exports.ServiceOrderAddTypeSelector=exports.ServiceOrderItemPipe=exports.ServiceOrderItemPanel=exports.ServiceOrderItemItem=exports.ServiceOrderEquipmentPanel=exports.ServiceOrderEquipmentItem=exports.ServiceOrderEffortPanel=exports.ServiceOrderEffortItemDetails=exports.ServiceOrderEffortItem=exports.ServiceOrderNewButton=exports.fieldServiceQueue=exports.fieldBooleanBullet=exports.fieldWarrantyIndicator=exports.ServiceTicketRelatedTicketsTiles=exports.ServiceTicketRelatedTickets=exports.ServiceActivitiyTimelineAddServiceNote=exports.ServiceTicketAccountDetail=exports.ServiceTicketConsumerDetail=exports.ServiceTicketContactDetail=exports.ServiceTicketDetail=exports.ServiceTicketView=exports.ServiceTicketCloseModal=exports.ServiceTicketCloseButton=exports.ServiceTicketNewModal=exports.ServiceTicketNewButton=exports.ServiceRequestFeedbackButton=exports.ServiceTicketSLAIndicator=exports.ServiceTicketProlongModal=exports.ServiceTicketProlongButton=exports.ServiceMyQueuesTicketsDashletItem=exports.ServiceMyQueuesTicketsDashlet=exports.ServiceMyTicketsDashlet=exports.ServiceSelectQueueModal=exports.ServiceSelectQueueButton=exports.ServiceCategoryManagerComponent=exports.ServiceAddTicketActionButton=exports.ServiceAddTicketButton=exports.ServiceActivitiyTimelineAddServiceCall=exports.ServiceOrderSummaryComponent=exports.SignServiceOrderModalComponent=exports.SignServiceOrderModalButtonComponent=exports.ServicePlannerService=void 0,exports.ServiceComponentsModule=exports.ServiceDocSignatureModal=exports.ServiceDocSignatureContent=exports.ServiceDocSignatureButton=exports.ServicePlannerMapsModelPopoverDirection=void 0;var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),directives_1=require("../../directives/directives"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),services_1=require("../../services/services"),router_1=require("@angular/router"),rxjs_1=require("rxjs"),moduleactivities_1=require("../../modules/activities/moduleactivities"),animations_1=require("@angular/animations"),operators_1=require("rxjs/operators"),spicetimeline_1=require("../../include/spicetimeline/spicetimeline"),platform_browser_1=require("@angular/platform-browser"),ServicePlannerService=function(){function e(){}return __decorate([core_1.Injectable()],e)}();exports.ServicePlannerService=ServicePlannerService;var SignServiceOrderModalButtonComponent=function(){function SignServiceOrderModalButtonComponent(e,t,i,s,o){this.model=e,this.metadata=t,this.language=i,this.footer=s,this.modalservice=o}return SignServiceOrderModalButtonComponent.prototype.execute=function(){var t=this;this.modalservice.openModal("SignServiceOrderModalComponent").subscribe(function(e){e.instance.setModel(t.model)},function(e){console.error(e)})},Object.defineProperty(SignServiceOrderModalButtonComponent.prototype,"display",{get:function(){return!(this.model.data.acl&&!this.model.data.acl.edit)&&!this.model.isEditing},enumerable:!1,configurable:!0}),__decorate([core_1.Component({selector:"sign-serviceorder-modal-button",template:'<system-label label="LBL_SIGNING"></system-label>'}),__metadata("design:paramtypes",[services_1.model,services_1.metadata,services_1.language,services_1.footer,services_1.modal])],SignServiceOrderModalButtonComponent)}();exports.SignServiceOrderModalButtonComponent=SignServiceOrderModalButtonComponent;var SignServiceOrderModalComponent=function(){function SignServiceOrderModalComponent(e,t,i){this.model=e,this.view=t,this.language=i,this.view.isEditable=!0,this.view.setEditMode()}return SignServiceOrderModalComponent.prototype.setModel=function(e){this.model.id=e.id,this.model.module=e.module,this.model.data=e.data},SignServiceOrderModalComponent.prototype.cancel=function(){this.self.destroy()},SignServiceOrderModalComponent.prototype.onModalEscX=function(){this.cancel()},SignServiceOrderModalComponent.prototype.accept=function(){this.model.data.serviceorder_status="signed",this.model.save(),this.self.destroy()},__decorate([core_1.Component({selector:"sign-serviceorder-modal",template:'<div class="slds-modal slds-modal_large slds-fade-in-open"><div class="slds-modal__container slds-p-top--x-large slds-p-bottom--x-large"><header class="slds-modal__header"><button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" (click)="cancel()"><system-button-icon [icon]="\'close\'"></system-button-icon><span class="slds-assistive-text">Close</span></button><h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{{language.getLabel(\'LBL_SERVICEORDER_SIGNING\', model.module)}}</h2></header><div class="slds-modal__content slds-p-around--medium slds-border_left slds-border_right slds-border_top slds-border_bottom"><serviceorder-summary></serviceorder-summary><div class="slds-text-align--right"><field-container [fieldname]="\'signature_contact\'" [fieldconfig]="{display_name_field:\'contact_name\'}"></field-container></div></div><div class="slds-modal__footer"><button class="slds-button slds-button--brand" [disabled]="!model.data.signature_contact" (click)="accept()">OK</button> <button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button></div></div></div><div class="slds-backdrop slds-backdrop--open"></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language])],SignServiceOrderModalComponent)}();exports.SignServiceOrderModalComponent=SignServiceOrderModalComponent;var ServiceOrderSummaryComponent=function(){function e(e,t,i){this.model=e,this.view=t,this.language=i,this.view.isEditable=!1}return __decorate([core_1.Component({selector:"serviceorder-summary",template:'<div class="slds-card"><div class="slds-card__header"><h2>{{model.data.name}} ({{language.getLabel(\'LBL_SERVICEORDER_NUMBER\', model.module)}}: {{model.data.serviceorder_number}})</h2></div><div class="slds-card__body slds-card__body_inner slds-p-top--small"><div class="slds-grid"><div class="slds-form-element slds-size--1-of-2"><field-label [fieldname]="\'account_name\'"></field-label><field-container [fieldname]="\'account_name\'"></field-container></div><div class="slds-form-element slds-size--1-of-2"><field-label [fieldname]="\'assigned_user_name\'"></field-label><field-container [fieldname]="\'assigned_user_name\'"></field-container></div></div><div class="slds-grid"><div class="slds-form-element slds-size--1-of-2"><field-label [fieldname]="\'date_start\'"></field-label><field-container [fieldname]="\'date_start\'"></field-container></div><div class="slds-form-element slds-size--1-of-2"><field-label [fieldname]="\'date_end\'"></field-label><field-container [fieldname]="\'date_end\'"></field-container></div></div><p>{{model.data.description}}</p></div></div>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language])],e)}();exports.ServiceOrderSummaryComponent=ServiceOrderSummaryComponent;var ServiceActivitiyTimelineAddServiceCall=function(){function ServiceActivitiyTimelineAddServiceCall(e,t,i,s,o,l,n){this.metadata=e,this.activitiytimeline=t,this.model=i,this.view=s,this.language=o,this.modal=l,this.ViewContainerRef=n,this.headerFieldSet="",this.bodyFieldSet="",this.isExpanded=!1}return ServiceActivitiyTimelineAddServiceCall.prototype.ngOnInit=function(){var t=this;this.model.module="ServiceCalls",this.activitiytimeline.parent.data$.subscribe(function(e){e.id==t.model.data.parent_id&&(t.model.data.parent_name=e.summary_text)}),this.view.isEditable=!0,this.view.setEditMode();var e=this.metadata.getComponentConfig("ServiceActivitiyTimelineAddServiceCall",this.model.module);this.bodyFieldSet=e.bodyfieldset||e.fieldset,this.headerFieldSet=e.headerfieldset},ServiceActivitiyTimelineAddServiceCall.prototype.initializeCall=function(){this.model.module="ServiceCalls",this.model.initializeModel(this.activitiytimeline.parent)},ServiceActivitiyTimelineAddServiceCall.prototype.onFocus=function(){this.isExpanded||(this.isExpanded=!0,this.initializeCall())},ServiceActivitiyTimelineAddServiceCall.prototype.expand=function(){var t=this;this.modal.openModal("GlobalDockedComposerModal",!0,this.ViewContainerRef.injector).subscribe(function(e){e.instance.setModel(t.model)})},ServiceActivitiyTimelineAddServiceCall.prototype.collapse=function(){this.isExpanded=!1},ServiceActivitiyTimelineAddServiceCall.prototype.cancel=function(){this.isExpanded=!1},ServiceActivitiyTimelineAddServiceCall.prototype.save=function(){var t=this;this.model.save().subscribe(function(e){t.initializeCall(),t.isExpanded=!1})},__decorate([core_1.Component({selector:"service-activitiytimeline-add-servicecall",template:'<div class="slds-p-around--x-small" [system-overlay-loading-spinner]="model.isSaving"><div class="slds-p-horizontal--xx-small" (click)="onFocus()"><object-record-fieldset [fieldset]="headerFieldSet"></object-record-fieldset></div><ng-container *ngIf="isExpanded"><object-record-fieldset [fieldset]="bodyFieldSet" [direction]="\'vertical\'"></object-record-fieldset><div class="slds-grid"><button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button><div class="slds-col--bump-left"><button class="slds-button slds-button--brand slds-m-horizontal--xxx-small" (click)="save()"><system-label label="LBL_SAVE"></system-label></button></div><service-add-ticket-button [servicecall]="this.model" (click)="collapse()"></service-add-ticket-button></div></ng-container></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.metadata,services_1.activitiytimeline,services_1.model,services_1.view,services_1.language,services_1.modal,core_1.ViewContainerRef])],ServiceActivitiyTimelineAddServiceCall)}();exports.ServiceActivitiyTimelineAddServiceCall=ServiceActivitiyTimelineAddServiceCall;var ServiceAddTicketButton=function(){function e(e,t,i){this.metadata=e,this.model=t,this.language=i,this.servicecall={},this.click=new core_1.EventEmitter}return e.prototype.saveandcreate=function(){var t=this;this.servicecall.save().subscribe(function(e){t.click.emit(!0),t.model.module="ServiceTickets",t.model.addModel("",t.servicecall)})},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"servicecall",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"click",void 0),__decorate([core_1.Component({selector:"service-add-ticket-button",template:'<button class="slds-button slds-button--brand slds-m-horizontal--xxx-small" (click)="saveandcreate()">Create Ticket</button>',providers:[services_1.model]}),__metadata("design:paramtypes",[services_1.metadata,services_1.model,services_1.language])],e)}();exports.ServiceAddTicketButton=ServiceAddTicketButton;var ServiceAddTicketActionButton=function(){function ServiceAddTicketActionButton(e,t,i,s){this.metadata=e,this.servicecall=t,this.model=i,this.language=s,this.actionemitter=new core_1.EventEmitter}return ServiceAddTicketActionButton.prototype.execute=function(){var t=this;this.servicecall.save().subscribe(function(e){t.model.module="ServiceTickets",t.model.addModel("",t.servicecall),t.actionemitter.emit(!0)})},__decorate([core_1.Component({selector:"service-add-ticket-action-button",template:'<system-label label="LBL_CREATE_TICKET"></system-label>',providers:[services_1.model]}),__param(1,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.metadata,services_1.model,services_1.model,services_1.language])],ServiceAddTicketActionButton)}();exports.ServiceAddTicketActionButton=ServiceAddTicketActionButton;var ServiceCategoryManagerComponent=function(){function ServiceCategoryManagerComponent(e,t,i,s,o,l){var n=this;this.backend=e,this.metadata=t,this.language=i,this.config=s,this.utils=o,this.toast=l,this.category_tree=[],this.levels=[],this.max_levels=4,this.loading=!0,this.selected_categorys=[],this.edit_category=null,this.service_queues=[],this.config.getData("service_category_tree")?this.initializeTree(this.config.getData("service_category_tree")):this.backend.getRequest("spiceui/core/servicecategories/tree").subscribe(function(e){n.config.setData("service_category_tree",e),n.initializeTree(e)}),this.backend.getRequest("module/ServiceQueues",{limit:-99}).subscribe(function(e){for(var t=0,i=e.list;t<i.length;t++){var s=i[t];n.service_queues.push(n.utils.backendModel2spice("ServiceQueues",s))}})}return ServiceCategoryManagerComponent.prototype.initializeTree=function(e){this.category_tree=e;for(var t=0;t<this.max_levels;t++)this.levels[t]=[];this.levels[0]=this.category_tree,this.loading=!1},ServiceCategoryManagerComponent.prototype.resetLevels=function(e){for(var t=e=void 0===e?0:e;t<this.max_levels;t++)this.levels[t]=[];this.selected_categorys.splice(e,this.max_levels-e)},ServiceCategoryManagerComponent.prototype.select=function(e){(this.selected_categorys[e.level]=e).categories?(this.levels[e.level+1]=e.categories,this.resetLevels(e.level+2)):this.resetLevels(e.level+1)},ServiceCategoryManagerComponent.prototype.addCategory=function(e){void 0===e&&(e=null);var t={id:this.utils.generateGuid(),name:"new Category...",keyname:null,parent_id:null,selectable:0,favorite:0,servicequeue_id:null,level:0};e?(e.categories||(e.categories=[]),t.parent_id=e.id,t.level=e.level+1,t.level>this.max_levels&&(this.max_levels=t.level),e.categories.push(t),this.levels[e.level+1]=e.categories):(this.category_tree.push(t),this.levels[0]=this.category_tree),this.select(t),this.edit(t)},ServiceCategoryManagerComponent.prototype.removeCategory=function(e){if(e.categories&&!confirm("Are you sure you want to delete this Category? There are "+e.categories.length+" Subcategories which will be get deleted too!"))return!1;e==this.edit_category&&(this.edit_category=null);for(var t=0,i=0,s=this.category_tree;i<s.length;i++){var o=s[i];if(o==e)return this.category_tree.splice(t,1),!0;!function e(t,i){if(t.categories)for(var s=0;s<t.categories.length;s++){if(t.categories[s]==i)return t.categories.splice(s,1),!0;e(t.categories[s],i)}return!1}(o,e),t++}},ServiceCategoryManagerComponent.prototype.edit=function(e){this.selected_categorys[e.level]=e,this.edit_category=e},ServiceCategoryManagerComponent.prototype.save=function(){var t=this;this.backend.postRequest("spiceui/core/servicecategories/tree",null,this.category_tree).subscribe(function(e){t.toast.sendToast("changes saved")},function(e){t.toast.sendAlert("saving failed!"),console.error(e)})},ServiceCategoryManagerComponent.prototype.isCategorySelected=function(e){for(var t=0,i=this.selected_categorys;t<i.length;t++)if(i[t].id==e.id)return!0;return!1},__decorate([core_1.Component({template:'<div class="slds-grid slds-grid--align-spread slds-p-around--medium"><h2 class="slds-text-heading--medium">Service Categories</h2><button class="slds-button slds-button--brand" (click)="save()">Save</button></div><article class="slds-card slds-m-around--small"><div class="slds-card__header"><header class="slds-has-flexi-truncate"><h2>Service Category Tree</h2></header></div><div class="slds-card__body slds-card__body_inner slds-grid"><div *ngIf="loading" class="slds-p-around--small slds-align--absolute-center"><system-spinner></system-spinner></div><div *ngFor="let lvl of levels; let i = index" class="slds-col slds-size--1-of-2" [ngStyle]="{width: 100/levels.length+\'%\'}" [ngClass]="{\'slds-border--right\': i < max_levels -1}"><div *ngFor="let cat of lvl" [ngClass]="{\'slds-theme--shade\': isCategorySelected(cat) || cat == edit_category, \'slds-theme_alert-texture\': cat == edit_category}"><div class="slds-grid slds-grid--vertical-align-center slds-p-around--xx-small" (mouseenter)="select(cat)"><span class="slds-truncate" style="cursor: pointer;" (click)="edit(cat)">{{language.getAppLanglabel(cat.name)}}</span><system-utility-icon class="slds-m-left--small" *ngIf="cat.favorite == 1" [icon]="\'favorite\'" [size]="\'xx-small\'"></system-utility-icon><div class="slds-col--bump-left"><system-utility-icon *ngIf="cat.level < max_levels-1" [icon]="\'add\'" [size]="\'xx-small\'" style="cursor:pointer;" (click)="addCategory(cat)"></system-utility-icon><system-utility-icon *ngIf="cat.categories" [icon]="\'chevronright\'" [size]="\'xx-small\'"></system-utility-icon></div></div></div><div *ngIf="i == 0" class="slds-p-around--xx-small"><system-utility-icon [icon]="\'add\'" [size]="\'xx-small\'" style="cursor:pointer;" (click)="addCategory()"></system-utility-icon></div></div></div></article><article *ngIf="edit_category" class="slds-card slds-m-around--small slds-theme--shade"><div class="slds-card__header slds-grid"><header class="slds-has-flexi-truncate"><h2>Edit Category</h2></header><system-utility-icon [icon]="\'close\'" [size]="\'xx-small\'" style="cursor: pointer;" (click)="removeCategory(edit_category)"></system-utility-icon></div><div class="slds-card__body slds-card__body_inner"><div class="slds-form-element slds-m-vertical--xxx-small"><label class="slds-form-element__label">Name:</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="edit_category.name"></div></div><div class="slds-form-element slds-m-vertical--xxx-small"><label class="slds-form-element__label">Key:</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="edit_category.keyname"></div></div><div class="slds-form-element slds-m-vertical--xxx-small"><label class="slds-form-element__label">Service Queue (hierarchical):</label><div class="slds-form-element__control"><select class="slds-select" [(ngModel)]="edit_category.servicequeue_id"><option></option><option *ngFor="let opt of service_queues" value="{{opt.id}}">{{opt.name}}</option></select></div></div><div class="slds-form-element slds-m-vertical--xxx-small"><div class="slds-form-element slds-p-top--small"><div class="slds-form-element__control slds-grid"><span class="slds-checkbox"><input type="checkbox" name="options" id="checkbox-42" [(ngModel)]="edit_category.favorite"> <label class="slds-checkbox__label" for="checkbox-42"><span class="slds-checkbox_faux"></span> <span class="slds-form-element__label">Favorite</span></label></span> <span class="slds-checkbox"><input type="checkbox" name="options" id="checkbox-49" [(ngModel)]="edit_category.selectable"> <label class="slds-checkbox__label" for="checkbox-49"><span class="slds-checkbox_faux"></span> <span class="slds-form-element__label">Selectable</span></label></span></div></div></div></div></article>'}),__metadata("design:paramtypes",[services_1.backend,services_1.metadata,services_1.language,services_1.configurationService,services_1.modelutilities,services_1.toast])],ServiceCategoryManagerComponent)}();exports.ServiceCategoryManagerComponent=ServiceCategoryManagerComponent;var ServiceSelectQueueButton=function(){function ServiceSelectQueueButton(e,t,i,s,o){this.model=e,this.metadata=t,this.language=i,this.modal=s,this.injector=o}return Object.defineProperty(ServiceSelectQueueButton.prototype,"canChange",{get:function(){if(this.model.data.acl&&!this.model.data.acl.edit)return!1;var e=this.model.getField("resolve_date");return!(e&&e.isValid&&e.isValid())&&!this.model.isEditing},enumerable:!1,configurable:!0}),ServiceSelectQueueButton.prototype.showModal=function(){this.canChange&&this.modal.openModal("ServiceSelectQueueModal",!0,this.injector)},ServiceSelectQueueButton.prototype.getDisplay=function(){return this.canChange?"inherit":"none"},__decorate([core_1.Component({selector:"service-select-queue-button",template:'<button [disabled]="!canChange" class="slds-button slds-button_icon"><span (click)="showModal()"><system-label label="LBL_FORWARD"></system-label></span></button>'}),__metadata("design:paramtypes",[services_1.model,services_1.metadata,services_1.language,services_1.modal,core_1.Injector])],ServiceSelectQueueButton)}();exports.ServiceSelectQueueButton=ServiceSelectQueueButton;var ServiceSelectQueueModal=function(){function ServiceSelectQueueModal(e,t,i,s,o){var l=this;this.model=e,this.serviceticketnote=t,this.metadata=i,this.language=s,this.backend=o,this.self={},this.parentqueue_id="",this.queues=[],this.loading=!0,this.displaynote=!0,this.selectedqueueid="",this.note="",this.selectedqueue=new core_1.EventEmitter,this.parentqueue_id=this.model.getField("servicequeue_id"),this.backend.getRequest("module/ServiceQueues").subscribe(function(e){for(var t=0,i=e.list;t<i.length;t++){var s=i[t];s.id!=l.parentqueue_id&&l.queues.push(s)}l.loading=!1})}return ServiceSelectQueueModal.prototype.cancel=function(){this.selectedqueue.emit(!1),this.self.destroy()},ServiceSelectQueueModal.prototype.save=function(){this.model.isEditing?(this.model.startEdit(),this.model.setField("servicequeue_id",this.selectedqueueid),this.model.setField("servicequeue_name",this.getQueueName(this.selectedqueueid)),this.model.save()):(this.model.setField("servicequeue_id",this.selectedqueueid),this.model.setField("servicequeue_name",this.getQueueName(this.selectedqueueid))),this.note&&(this.serviceticketnote.module="ServiceTicketNotes",this.serviceticketnote.initialize(this.model),this.serviceticketnote.setField("description",this.note),this.serviceticketnote.save()),this.self.destroy()},ServiceSelectQueueModal.prototype.getQueueName=function(e){for(var t=0,i=this.queues;t<i.length;t++){var s=i[t];if(s.id==this.selectedqueueid)return s.name}},__decorate([core_1.Component({selector:"service-select-queue-modal",template:'<system-modal><system-modal-header (close)="cancel()"><system-label label="LBL_SELECT_QUEUE"></system-label></system-modal-header><system-modal-content><div *ngIf="loading; else queuelist" class="slds-align--absolute-center slds-p-around--medium"><system-spinner></system-spinner></div><ng-template #queuelist><fieldset class="slds-form-element"><legend class="slds-form-element__legend slds-form-element__label"><system-label label="LBL_AVAILABLE_QUEUES"></system-label></legend><div class="slds-form-element__control"><span class="slds-radio" *ngFor="let queue of queues"><input type="radio" [id]="queue.id" [value]="queue.id" name="queue" [(ngModel)]="selectedqueueid"> <label class="slds-radio__label" [attr.for]="queue.id"><span class="slds-radio_faux"></span> <span class="slds-form-element__label">{{queue.name}}</span></label></span></div></fieldset><div *ngIf="displaynote" class="slds-form-element slds-p-top--small"><label class="slds-form-element__label"><system-label label="LBL_NOTE"></system-label></label><div class="slds-form-element__control"><textarea class="slds-textarea" [(ngModel)]="note"></textarea></div></div></ng-template></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" (click)="save()"><system-label label="LBL_SAVE"></system-label></button></system-modal-footer></system-modal>',providers:[services_1.model]}),__param(0,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.model,services_1.model,services_1.metadata,services_1.language,services_1.backend])],ServiceSelectQueueModal)}();exports.ServiceSelectQueueModal=ServiceSelectQueueModal;var ServiceMyTicketsDashlet=function(){function ServiceMyTicketsDashlet(e,t,i,s,o){this.language=e,this.metadata=t,this.backend=i,this.router=s,this.elementref=o,this.tickets=[],this.totalcount=0,this.isLoading=!1}return ServiceMyTicketsDashlet.prototype.ngOnInit=function(){var t=this;this.backend.getRequest("modules/ServiceTickets/myopenitems").subscribe(function(e){t.tickets=e.tickets,t.totalcount=e.totalcount})},Object.defineProperty(ServiceMyTicketsDashlet.prototype,"containerStyle",{get:function(){return{height:"calc("+this.elementref.nativeElement.getBoundingClientRect().height+"px - "+this.ticketcontainer.element.nativeElement.offsetTop+"px)"}},enumerable:!1,configurable:!0}),__decorate([core_1.ViewChild("ticketcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],ServiceMyTicketsDashlet.prototype,"ticketcontainer",void 0),__decorate([core_1.Component({selector:"service-my-tickets-dashlet",template:'<div style="height: 100%; overflow: hidden;"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="ServiceTickets" size="small"></system-icon><h2 class="slds-text-heading--medium slds-p-bottom--xx-small"><system-label label="LBL_MY_OPEN_TICKETS"></system-label> ({{totalcount}})</h2></div><div #ticketcontainer class="slds-scrollable--y" [ngStyle]="containerStyle"><service-myqueues-tickets-dashlet-item *ngFor="let ticket of tickets" [ticket]="ticket"></service-myqueues-tickets-dashlet-item></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.backend,router_1.Router,core_1.ElementRef])],ServiceMyTicketsDashlet)}();exports.ServiceMyTicketsDashlet=ServiceMyTicketsDashlet;var ServiceMyQueuesTicketsDashlet=function(){function ServiceMyQueuesTicketsDashlet(e,t,i,s,o){this.language=e,this.metadata=t,this.backend=i,this.router=s,this.elementref=o,this.tickets=[],this.totalcount=0,this.isLoading=!0}return ServiceMyQueuesTicketsDashlet.prototype.ngOnInit=function(){var t=this;this.backend.getRequest("modules/ServiceTickets/openinmyqueues").subscribe(function(e){t.tickets=e.tickets,t.totalcount=e.totalcount,t.isLoading=!1})},Object.defineProperty(ServiceMyQueuesTicketsDashlet.prototype,"containerStyle",{get:function(){return{height:"calc("+this.elementref.nativeElement.getBoundingClientRect().height+"px - "+this.ticketcontainer.element.nativeElement.offsetTop+"px)"}},enumerable:!1,configurable:!0}),__decorate([core_1.ViewChild("ticketcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],ServiceMyQueuesTicketsDashlet.prototype,"ticketcontainer",void 0),__decorate([core_1.Component({selector:"service-myqueues-tickets-dashlet",template:'<div style="height: 100%; overflow: hidden;"><div class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="ServiceTickets" size="small"></system-icon><h2 class="slds-text-heading--medium slds-p-bottom--xx-small"><system-label label="LBL_UNASSGINED_TICKETS"></system-label> ({{totalcount}})</h2></div><div #ticketcontainer class="slds-scrollable--y" [ngStyle]="containerStyle"><div *ngIf="tickets.length==0 && !isLoading;else itemscontainer" style="height: 100%; width:100%;" class="slds-align--absolute-center"><span class="slds-text-heading_medium"><system-label label="MSG_NO_RECORDS_FOUND"></system-label></span></div><ng-template #itemscontainer><service-myqueues-tickets-dashlet-item *ngFor="let ticket of tickets" [ticket]="ticket"></service-myqueues-tickets-dashlet-item><div *ngIf="isLoading" class="slds-p-around--small slds-align--absolute-center"><system-spinner></system-spinner></div></ng-template></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.backend,router_1.Router,core_1.ElementRef])],ServiceMyQueuesTicketsDashlet)}();exports.ServiceMyQueuesTicketsDashlet=ServiceMyQueuesTicketsDashlet;var ServiceMyQueuesTicketsDashletItem=function(){function ServiceMyQueuesTicketsDashletItem(e,t,i,s){this.language=e,this.metadata=t,this.model=i,this.modelutilities=s,this.headerfieldset="",this.detailfieldset="",this.model.module="ServiceTickets";s=this.metadata.getComponentConfig("ServiceMyQueuesTicketsDashletItem");this.headerfieldset=s.headerfieldset,this.detailfieldset=s.detailfieldset}return ServiceMyQueuesTicketsDashletItem.prototype.ngOnInit=function(){this.model.id=this.ticket.id,this.model.data=this.modelutilities.backendModel2spice("ServiceTickets",this.ticket)},__decorate([core_1.Input(),__metadata("design:type",Object)],ServiceMyQueuesTicketsDashletItem.prototype,"ticket",void 0),__decorate([core_1.Component({selector:"service-myqueues-tickets-dashlet-item",template:'<div class="slds-p-around--x-small slds-grid"><div class="slds-media"><div class="slds-media__figure slds-m-right--none"><system-icon module="ServiceTickets" [size]="\'small\'"></system-icon></div><div class="slds-media__body"><div class="slds-text-title_caps slds-text-link_reset"><object-record-fieldset-horizontal-list [fieldset]="headerfieldset"></object-record-fieldset-horizontal-list></div><div class="slds-text-body_small slds-line-height_reset"><object-record-fieldset-horizontal-list [fieldset]="detailfieldset"></object-record-fieldset-horizontal-list></div></div></div></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.modelutilities])],ServiceMyQueuesTicketsDashletItem)}();exports.ServiceMyQueuesTicketsDashletItem=ServiceMyQueuesTicketsDashletItem;var ServiceTicketProlongButton=function(){function ServiceTicketProlongButton(e,t,i,s,o){this.language=e,this.metadata=t,this.model=i,this.modal=s,this.viewContainerRef=o,this.disabled=!0}return ServiceTicketProlongButton.prototype.ngOnInit=function(){var t=this;this.handleDisabled(this.model.isEditing?"edit":"display"),this.model.mode$.subscribe(function(e){t.handleDisabled(e)}),this.model.data$.subscribe(function(e){t.handleDisabled(t.model.isEditing?"edit":"display")})},ServiceTicketProlongButton.prototype.execute=function(){this.modal.openModal("ServiceTicketProlongModal",!0,this.viewContainerRef.injector)},ServiceTicketProlongButton.prototype.handleDisabled=function(e){var t;this.model.data.acl&&!this.model.checkAccess("edit")||(t=this.model.getField("resolve_date"))&&t.isValid&&t.isValid()?this.disabled=!0:this.disabled="edit"==e},__decorate([core_1.Component({template:'<span><system-label label="LBL_PROLONG"></system-label></span>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.modal,core_1.ViewContainerRef])],ServiceTicketProlongButton)}();exports.ServiceTicketProlongButton=ServiceTicketProlongButton;var ServiceTicketProlongModal=function(){function ServiceTicketProlongModal(e,t,i,s){this.model=e,this.metadata=t,this.language=i,this.backend=s,this.self={},this.prolongDate=new moment,this.prolongReason="",this.saving=!1,this.minDate=new moment,this.maxDate=(new moment).add(5,"days")}return ServiceTicketProlongModal.prototype.cancel=function(){this.self.destroy()},ServiceTicketProlongModal.prototype.save=function(){var t=this;this.saving=!0,this.backend.postRequest("modules/ServiceTickets/"+this.model.id+"/prolong",{},{prolonged_until:this.prolongDate.format("YYYY-MM-DD"),prolongation_reason:this.prolongReason}).subscribe(function(e){t.model.setField("prolonged_until",t.prolongDate),t.self.destroy()},function(e){t.saving=!1})},ServiceTicketProlongModal.prototype.setDate=function(e){this.prolongDate=e},__decorate([core_1.Component({template:'<system-modal><system-modal-header (close)="cancel()"><system-label label="LBL_PROLONG"></system-label></system-modal-header><system-modal-content margin="none"><div class="slds-grid slds-gutters_direct-x-small"><div class="slds-col slds-size--1-of-2"><system-input-date-picker [setDate]="prolongDate" [minDate]="minDate" [maxDate]="maxDate" (datePicked)="setDate($event)"></system-input-date-picker></div><div class="slds-col slds-size--1-of-2"><div class="slds-form-element slds-p-horizontal--x-small"><label class="slds-form-element__label"><system-label label="LBL_REASON"></system-label></label><div class="slds-form-element__control"><textarea rows="15" style="resize: none" class="slds-textarea" [(ngModel)]="prolongReason"></textarea></div></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" [disabled]="saving" (click)="cancel()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" [disabled]="saving" (click)="save()"><system-label label="LBL_SAVE"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.model,services_1.metadata,services_1.language,services_1.backend])],ServiceTicketProlongModal)}();exports.ServiceTicketProlongModal=ServiceTicketProlongModal;var ServiceTicketSLAIndicator=function(n){function ServiceTicketSLAIndicator(e,t,i,s,o){var l=n.call(this,e,t,i,s,o)||this;return l.model=e,l.view=t,l.language=i,l.metadata=s,l.router=o,l.timeLeft="",l.subscriptions.add(l.model.data$.subscribe(function(e){l.timeLeft=l._timeLeft})),l}return __extends(ServiceTicketSLAIndicator,n),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"sladatefield",{get:function(){return this.fieldconfig.sladate||"resolve_until"},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"prolongdatefield",{get:function(){return this.fieldconfig.prolongdate||"prolonged_until"},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"sladate",{get:function(){var e=this.model.getField(this.prolongdatefield);return e&&e.isValid&&e.isValid()?e:this.model.getField(this.sladatefield)},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"resolvedatefield",{get:function(){return this.fieldconfig.resolvedate||"resolve_date"},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"warningtimespan",{get:function(){return this.fieldconfig.warningtimespan||"24"},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"hasSLA",{get:function(){return!!this.model.getField(this.sladatefield)},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"_timeLeft",{get:function(){var e=moment.duration(),t=this.model.getField(this.resolvedatefield);if(t&&t.isValid&&t.isValid())return(e=(i=this.sladate)&&i.isAfter&&i.isAfter(t)?moment.duration(i.diff(t)):moment.duration(t.diff(i))).days()+"d"+e.hours()+"h"+e.minutes()+"m";var i,t=new moment;return(e=(i=this.sladate)&&i.isAfter&&i.isAfter(t)?moment.duration(i.diff(t)):moment.duration(t.diff(i))).days()+"d"+e.hours()+"h"+e.minutes()+"m"},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"status",{get:function(){this.model.getField("date_entered");var e=new moment(this.sladate),t=new moment(this.model.getField(this.resolvedatefield));if(t&&t.isValid&&t.isValid()){if(e.isBefore(t))return"expired"}else{t=new moment;if(e.isBefore(t))return"expired";if(moment.duration(e.diff(t)).as("hours")<24)return"warning"}return""},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketSLAIndicator.prototype,"percentage",{get:function(){var e=this.model.getField(this.resolvedatefield);if(e&&e.isValid&&e.isValid())return 100;var t=new moment,i=new moment(this.model.getField("date_entered")),e=new moment(this.sladate);if(e.isBefore(t))return 0;i=moment.duration(e.diff(i)),t=moment.duration(e.diff(t)),i=Math.round(t.as("minutes")/i.as("minutes")*100);return 99<i?99:i},enumerable:!1,configurable:!0}),__decorate([core_1.Component({template:'<field-label *ngIf="displayLabel" [fieldname]="fieldname" [fieldconfig]="fieldconfig"></field-label><field-generic-display><div *ngIf="hasSLA" class="slds-grid slds-grid--vertical-align-center"><div class="slds-p-vertical--xxx-small"><system-progress-ring [percentage]="percentage" [status]="status"></system-progress-ring></div><div class="slds-p-horizontal--xx-small" [ngClass]="{\'slds-text-color_error\': status == \'expired\'}">{{timeLeft}}</div></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],ServiceTicketSLAIndicator)}(objectfields_1.fieldGeneric);exports.ServiceTicketSLAIndicator=ServiceTicketSLAIndicator;var ServiceRequestFeedbackButton=function(){function ServiceRequestFeedbackButton(e,t,i,s,o,l){this.language=e,this.metadata=t,this.modal=i,this.model=s,this.router=o,this.ViewContainerRef=l,this.parent={},this.module=""}return ServiceRequestFeedbackButton.prototype.execute=function(){var i=this;this.modal.openModal("ObjectActionMailModal",!0,this.ViewContainerRef.injector).subscribe(function(e){e.instance.titellabel="LBL_REQUEST_FEEDBACK",e.instance.parent=i.model,e.instance.mailsent.subscribe(function(e){var t;e&&(t=i.modal.await("LBL_SAVING"),i.model.startEdit(),i.model.setFields({serviceticket_status:"Pending Input"}),i.model.save().subscribe(function(e){t.emit(!0)}))})})},__decorate([core_1.Component({template:'<span><system-label label="LBL_REQUEST_FEEDBACK"></system-label></span>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.modal,services_1.model,router_1.Router,core_1.ViewContainerRef])],ServiceRequestFeedbackButton)}();exports.ServiceRequestFeedbackButton=ServiceRequestFeedbackButton;var ServiceTicketNewButton=function(){function ServiceTicketNewButton(e,t,i,s,o,l,n,a){this.injector=e,this.language=t,this.metadata=i,this.backend=s,this.modal=o,this.model=l,this.relatedmodels=n,this.parentmodel=a,this.disabled=!0,this.displayasicon=!1}return ServiceTicketNewButton.prototype.execute=function(){var i=this;this.model.module="ServiceTickets",this.model.id=void 0,this.model.initialize();var s=this.modal.await("loading");this.backend.getRequest("modules/ServiceTickets/discoverparent/"+this.parentmodel.module+"/"+this.parentmodel.id).subscribe(function(t){var e;t.servicelocations?0==t.servicelocations.length||1==t.servicelocations.length&&t.servicelocations[0].serviceequipments.length<=1?(e={},t.servicelocations&&1==t.servicelocations.length&&(e.servicelocation_id=t.servicelocations[0].id,e.servicelocation_name=t.servicelocations[0].name,1==t.servicelocations[0].serviceequipments.length&&(e.serviceequipment_id=t.servicelocations[0].serviceequipments[0].id,e.serviceequipment_name=t.servicelocations[0].serviceequipments[0].name)),i.model.addModel("",i.parentmodel,e).subscribe(function(e){0!=e&&i.relatedmodels.addItems([e])})):i.modal.openModal("ServiceTicketNewModal",!0,i.injector).subscribe(function(e){e.instance.servicelocations=t.servicelocations,e.instance.parentmodel=i.parentmodel}):i.model.addModel("",i.parentmodel).subscribe(function(e){0!=e&&i.relatedmodels.addItems([e])}),s.emit(!0)},function(e){s.emit(!0)})},ServiceTicketNewButton.prototype.ngOnInit=function(){this.metadata.checkModuleAcl("ServiceTickets","create")&&(this.disabled=!1)},__decorate([core_1.Component({template:'<system-label label="LBL_NEW"></system-label>',providers:[services_1.model]}),__param(7,core_1.SkipSelf()),__metadata("design:paramtypes",[core_1.Injector,services_1.language,services_1.metadata,services_1.backend,services_1.modal,services_1.model,services_1.relatedmodels,services_1.model])],ServiceTicketNewButton)}();exports.ServiceTicketNewButton=ServiceTicketNewButton;var ServiceTicketNewModal=function(){function ServiceTicketNewModal(e,t,i,s,o){this.language=e,this.metadata=t,this.backend=i,this.model=s,this.relatedmodels=o,this.servicelocations=[]}return ServiceTicketNewModal.prototype.ngOnInit=function(){this.servicelocations.sort(function(e,t){return e.name.localeCompare(t.name)<1?-1:1})},Object.defineProperty(ServiceTicketNewModal.prototype,"servicelocation",{get:function(){return this.servicelocation_id},set:function(e){this.servicelocation_id=e,this.serviceequipment_id=null},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketNewModal.prototype,"serviceequipments",{get:function(){var t=this;return this.servicelocation_id?this.servicelocations.find(function(e){return e.id==t.servicelocation_id}).serviceequipments.sort(function(e,t){return e.name.localeCompare(t.name)<1?-1:1}):[]},enumerable:!1,configurable:!0}),ServiceTicketNewModal.prototype.close=function(){this.self.destroy()},ServiceTicketNewModal.prototype.createServiceTicket=function(){var t=this,e={};this.servicelocation_id&&(e.servicelocation_id=this.servicelocation_id,e.servicelocation_name=this.servicelocations.find(function(e){return e.id==t.servicelocation_id}).name,this.serviceequipment_id&&(e.serviceequipment_id=this.serviceequipment_id,e.serviceequipment_name=this.servicelocations.find(function(e){return e.id==t.servicelocation_id}).serviceequipments.find(function(e){return e.id==t.serviceequipment_id}).name)),this.model.addModel("",this.parentmodel,e).subscribe(function(e){0!=e&&t.relatedmodels.addItems([e])}),this.close()},__decorate([core_1.Input(),__metadata("design:type",Array)],ServiceTicketNewModal.prototype,"servicelocations",void 0),__decorate([core_1.Component({template:'<system-modal><system-modal-header (close)="close()"><system-label label="LBL_SELECT"></system-label></system-modal-header><system-modal-content margin="none"><div class="slds-grid"><div class="slds-size--1-of-2 slds-p-around--x-small slds-form-element"><label class="slds-form-element__label"><system-label label="LBL_SERVICELOCATION"></system-label></label><div class="slds-form-element__control"><select class="slds-select" [(ngModel)]="servicelocation" size="5"><option *ngFor="let servicelocation of servicelocations" [value]="servicelocation.id">{{servicelocation.name}}</option></select></div></div><div class="slds-size--1-of-2 slds-p-around--x-small slds-form-element"><label class="slds-form-element__label"><system-label label="LBL_SERVICEEQUIPMENT"></system-label></label><div class="slds-form-element__control"><select class="slds-select" [(ngModel)]="serviceequipment_id" [disabled]="serviceequipments.length == 0" size="5"><option *ngIf="serviceequipments.length == 0"><system-label label="MSG_NO_RECORDS_FOUND"></system-label></option><option *ngFor="let serviceequipment of serviceequipments" [value]="serviceequipment.id">{{serviceequipment.name}}</option></select></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CLOSE"></system-label></button> <button class="slds-button slds-button--brand" (click)="createServiceTicket()"><system-label label="LBL_CREATE"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.backend,services_1.model,services_1.relatedmodels])],ServiceTicketNewModal)}();exports.ServiceTicketNewModal=ServiceTicketNewModal;var ServiceTicketCloseButton=function(){function ServiceTicketCloseButton(e,t,i,s,o){this.language=e,this.metadata=t,this.model=i,this.modal=s,this.injector=o,this.hidden=!1,this.disabled=!1}return ServiceTicketCloseButton.prototype.execute=function(){var e=this.model.getField("resolve_until");e&&e.isBefore(new moment)?this.modal.openModal("ServiceTicketCloseModal",!0,this.injector):(this.model.startEdit(!0,!0),this.model.setField("serviceticket_status",this.item.status_to),this.model.validate()?this.model.save():this.model.edit())},__decorate([core_1.Component({template:'<span><system-label label="LBL_CLOSE"></system-label></span>'}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.modal,core_1.Injector])],ServiceTicketCloseButton)}();exports.ServiceTicketCloseButton=ServiceTicketCloseButton;var ServiceTicketCloseModal=function(){function ServiceTicketCloseModal(e,t,i,s,o){this.language=e,this.metadata=t,this.model=i,this.modal=s,this.view=o,this.view.isEditable=!0,this.view.setEditMode();o=this.metadata.getComponentConfig("ServiceTicketCloseModal",this.model.module);this.fieldset=o.fieldset}return ServiceTicketCloseModal.prototype.close=function(){this.self.destroy()},Object.defineProperty(ServiceTicketCloseModal.prototype,"canSave",{get:function(){return 0<this.model.getField("sladeviation_reason").length},enumerable:!1,configurable:!0}),ServiceTicketCloseModal.prototype.setStatus=function(){this.canSave&&(this.model.startEdit(!0,!0),this.model.setField("serviceticket_status","Closed"),this.model.validate()?this.model.save():this.model.edit(),this.close())},__decorate([core_1.Component({template:'<system-modal><system-modal-header (close)="close()">Close Ticket</system-modal-header><system-modal-content><object-record-fieldset [fieldset]="fieldset" direction="vertical"></object-record-fieldset></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" (click)="setStatus()" [disabled]="!canSave"><system-label label="LBL_CLOSE"></system-label></button></system-modal-footer></system-modal>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.model,services_1.modal,services_1.view])],ServiceTicketCloseModal)}();exports.ServiceTicketCloseModal=ServiceTicketCloseModal;var ServiceTicketView=function(){function ServiceTicketView(e,t,i){this.metadata=e,this.model=t,this.elementRef=i,this.componentconfig={}}return ServiceTicketView.prototype.ngOnInit=function(){},__decorate([core_1.Component({template:'<div class="slds-grid slds-p-top--x-small"><div class="slds-size--1-of-4 slds-p-left--x-small slds-p-right--xx-small"><system-componentset [componentset]="componentconfig.left"></system-componentset></div><div class="slds-size--2-of-4 slds-p-horizontal--xx-small"><system-componentset [componentset]="componentconfig.center"></system-componentset></div><div class="slds-size--1-of-4 slds-p-right--x-small slds-p-left--xx-small"><system-componentset [componentset]="componentconfig.right"></system-componentset></div></div>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.model,core_1.ElementRef])],ServiceTicketView)}();exports.ServiceTicketView=ServiceTicketView;var ServiceTicketDetail=function(){function ServiceTicketDetail(e,t,i){this.model=e,this.metadata=t,this.language=i,this.componentconfig={}}return ServiceTicketDetail.prototype.ngOnInit=function(){(!this.componentconfig||this.componentconfig&&_.isEmpty(this.componentconfig))&&(this.componentconfig=this.metadata.getComponentConfig("ServiceTicketDetail",this.model.module)),this.componentset=this.componentconfig.componentset,this.headerfieldset=this.componentconfig.headerfieldset},__decorate([core_1.Component({template:'<div class="slds-box--border"><div class="slds-theme--shade slds-p-around--x-small slds-grid slds-grid--vertical-align-center"><system-icon [module]="model.module" size="small"></system-icon><div [system-view-provider]="{editable: false, displayLabels: false}" class="slds-text-heading--small"><object-record-fieldset-horizontal-list [fieldset]="headerfieldset"></object-record-fieldset-horizontal-list></div></div><object-record-details [componentSet]="componentset"></object-record-details></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.metadata,services_1.language])],ServiceTicketDetail)}();exports.ServiceTicketDetail=ServiceTicketDetail;var ServiceTicketContactDetail=function(){function ServiceTicketContactDetail(e,t,i,s){var o=this;this.parent=e,this.model=t,this.metadata=i,this.language=s,this.componentconfig={},this.subscriptions=new rxjs_1.Subscription,this.model.module="Contacts",this.subscriptions.add(this.parent.data$.subscribe(function(e){o.loadContact()}))}return ServiceTicketContactDetail.prototype.ngOnInit=function(){this.componentset=this.componentconfig.componentset,this.headerfieldset=this.componentconfig.headerfieldset},ServiceTicketContactDetail.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},Object.defineProperty(ServiceTicketContactDetail.prototype,"contactid",{get:function(){return"Contacts"==this.parent.getField("parent_type")?this.parent.getField("parent_id"):this.parent.getField("contact_id")},enumerable:!1,configurable:!0}),ServiceTicketContactDetail.prototype.loadContact=function(){this.contactid&&this.contactid!=this.model.id&&(this.model.id=this.contactid,this.model.getData())},__decorate([core_1.Component({template:'<div *ngIf="contactid" class="slds-box--border slds-m-vertical--small"><div class="slds-theme--shade slds-p-around--x-small slds-grid slds-grid--vertical-align-center"><system-icon [module]="model.module" size="small"></system-icon><div [system-view-provider]="{editable: false, displayLabels: false}" class="slds-text-heading--small"><object-record-fieldset-horizontal-list [fieldset]="headerfieldset"></object-record-fieldset-horizontal-list></div></div><object-record-details [componentSet]="componentset" [readonly]="true"></object-record-details></div>',providers:[services_1.model]}),__param(0,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.model,services_1.model,services_1.metadata,services_1.language])],ServiceTicketContactDetail)}();exports.ServiceTicketContactDetail=ServiceTicketContactDetail;var ServiceTicketConsumerDetail=function(){function ServiceTicketConsumerDetail(e,t,i,s){var o=this;this.parent=e,this.model=t,this.metadata=i,this.language=s,this.componentconfig={},this.subscriptions=new rxjs_1.Subscription,this.model.module="Consumers",this.subscriptions.add(this.parent.data$.subscribe(function(e){o.loadConsumer()}))}return ServiceTicketConsumerDetail.prototype.ngOnInit=function(){this.componentset=this.componentconfig.componentset,this.headerfieldset=this.componentconfig.headerfieldset},ServiceTicketConsumerDetail.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},Object.defineProperty(ServiceTicketConsumerDetail.prototype,"consumerid",{get:function(){return"Consumers"==this.parent.getField("parent_type")?this.parent.getField("parent_id"):this.parent.getField("consumer_id")},enumerable:!1,configurable:!0}),ServiceTicketConsumerDetail.prototype.loadConsumer=function(){this.consumerid&&this.consumerid!=this.model.id&&(this.model.id=this.consumerid,this.model.getData())},__decorate([core_1.Component({template:'<div *ngIf="consumerid" class="slds-box--border slds-m-vertical--small"><div class="slds-theme--shade slds-p-around--x-small slds-grid slds-grid--vertical-align-center"><system-icon [module]="model.module" size="small"></system-icon><div [system-view-provider]="{editable: false, displayLabels: false}" class="slds-text-heading--small"><object-record-fieldset-horizontal-list [fieldset]="headerfieldset"></object-record-fieldset-horizontal-list></div></div><object-record-details [componentSet]="componentset" [readonly]="true"></object-record-details></div>',providers:[services_1.model]}),__param(0,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.model,services_1.model,services_1.metadata,services_1.language])],ServiceTicketConsumerDetail)}();exports.ServiceTicketConsumerDetail=ServiceTicketConsumerDetail;var ServiceTicketAccountDetail=function(){function e(e,t,i,s){var o=this;this.parent=e,this.model=t,this.metadata=i,this.language=s,this.componentconfig={},this.subscriptions=new rxjs_1.Subscription,this.subscriptions.add(this.parent.data$.subscribe(function(e){o.loadContact()})),this.model.module="Accounts"}return e.prototype.ngOnInit=function(){this.componentset=this.componentconfig.componentset,this.headerfieldset=this.componentconfig.headerfieldset},e.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},Object.defineProperty(e.prototype,"accountid",{get:function(){return this.parent.getField("account_id")},enumerable:!1,configurable:!0}),e.prototype.loadContact=function(){this.accountid&&this.accountid!=this.model.id&&(this.model.id=this.accountid,this.model.getData())},__decorate([core_1.Component({template:'<div *ngIf="accountid" class="slds-box--border slds-m-vertical--small"><div class="slds-theme--shade slds-p-around--x-small slds-grid slds-grid--vertical-align-center"><system-icon [module]="model.module" size="small"></system-icon><div [system-view-provider]="{editable: false, displayLabels: false}" class="slds-text-heading--small"><object-record-fieldset-horizontal-list [fieldset]="headerfieldset"></object-record-fieldset-horizontal-list></div></div><object-record-details [componentSet]="componentset" [readonly]="true"></object-record-details></div>',providers:[services_1.model]}),__param(0,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.model,services_1.model,services_1.metadata,services_1.language])],e)}();exports.ServiceTicketAccountDetail=ServiceTicketAccountDetail;var ServiceActivitiyTimelineAddServiceNote=function(e){function ServiceActivitiyTimelineAddServiceNote(){return null!==e&&e.apply(this,arguments)||this}return __extends(ServiceActivitiyTimelineAddServiceNote,e),__decorate([core_1.Component({template:'<div><div class="slds-p-horizontal--xx-small" *ngIf="!isExpanded" (click)="onHeaderClick()"><object-record-fieldset [fieldset]="headerFieldSet"></object-record-fieldset></div><div class="slds-p-horizontal--xx-small" *ngIf="isExpanded"><object-record-fieldset [fieldset]="bodyFieldSet" [direction]="\'vertical\'"></object-record-fieldset><system-dynamic-component component="SpiceAttachmentsPanel"></system-dynamic-component><div class="slds-p-vertical--x-small slds-grid"><div class="slds-button-group" role="group"><button class="slds-button slds-button--neutral" (click)="cancel()" [title]="language.getLabel(\'LBL_CANCEL\')"><system-button-icon icon="close"></system-button-icon><span class="slds-assistive-text"><system-label label="LBL_CANCEL"></system-label></span></button> <button class="slds-button slds-button--neutral" (click)="expand()" [title]="language.getLabel(\'LBL_EXPAND\')"><system-button-icon icon="expand"></system-button-icon><span class="slds-assistive-text"><system-label label="LBL_EXPAND"></system-label></span></button> <button class="slds-button slds-button--neutral" (click)="dock()" [title]="language.getLabel(\'LBL_DOCK\')"><system-button-icon icon="dock_panel"></system-button-icon><span class="slds-assistive-text"><system-label label="LBL_DOCK"></system-label></span></button></div><div class="slds-col--bump-left slds-grid slds-grid--vertical-align-center"><object-record-messages-badge side="right"></object-record-messages-badge><object-action-container [actionset]="actionset" (actionemitter)="handleaction($event)"></object-action-container></div></div></div></div>',providers:[services_1.model,services_1.view]})],ServiceActivitiyTimelineAddServiceNote)}(moduleactivities_1.ActivityTimelineAddItem);exports.ServiceActivitiyTimelineAddServiceNote=ServiceActivitiyTimelineAddServiceNote;var ServiceTicketRelatedTickets=function(){function ServiceTicketRelatedTickets(e,t,i){this.model=e,this.metadata=t,this.language=i,this.scope="open",this.componentconfig={},this.opencount=0,this.closedcount=0}return Object.defineProperty(ServiceTicketRelatedTickets.prototype,"filteropen",{get:function(){return this.componentconfig.filteropen},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketRelatedTickets.prototype,"filterclosed",{get:function(){return this.componentconfig.filterclosed},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceTicketRelatedTickets.prototype,"fieldset",{get:function(){return this.componentconfig.fieldset},enumerable:!1,configurable:!0}),__decorate([core_1.Component({template:'<div class="slds-tabs_scoped"><ul class="slds-tabs_scoped__nav" role="tablist"><li class="slds-tabs_scoped__item" [ngClass]="{\'slds-is-active\': scope == \'open\'}" [title]="language.getLabel(\'LBL_OPEN_SERVICETICKETS\')" role="presentation"><a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" (click)="scope = \'open\'"><system-label label="LBL_OPEN_SERVICETICKETS"></system-label> ({{opencount}})</a></li><li class="slds-tabs_scoped__item" [ngClass]="{\'slds-is-active\': scope == \'closed\'}" [title]="language.getLabel(\'LBL_CLOSED_SERVICETICKETS\')" role="presentation"><a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" (click)="scope = \'closed\'"><system-label label="LBL_CLOSED_SERVICETICKETS"></system-label> ({{closedcount}})</a></li></ul><div class="slds-tabs_scoped__content slds-p-around_none" [ngClass]="{\'slds-hide\': scope != \'open\'}" role="tabpanel"><service-ticket-related-tickets-tiles [modulefilter]="filteropen" [fieldset]="fieldset" (count)="opencount = $event"></service-ticket-related-tickets-tiles></div><div class="slds-tabs_scoped__content slds-p-around_none" [ngClass]="{\'slds-hide\': scope != \'closed\'}" role="tabpanel"><service-ticket-related-tickets-tiles [modulefilter]="filterclosed" [fieldset]="fieldset" (count)="closedcount = $event"></service-ticket-related-tickets-tiles></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.metadata,services_1.language])],ServiceTicketRelatedTickets)}();exports.ServiceTicketRelatedTickets=ServiceTicketRelatedTickets;var ServiceTicketRelatedTicketsTiles=function(){function e(e,t,i,s){this.model=e,this.relatedmodels=t,this.metadata=i,this.language=s,this.fieldset="df917124-b071-6f6c-22f5-4a2b3257a050",this.count=new core_1.EventEmitter,this.scope="open",this.subscriptions=new rxjs_1.Subscription}return e.prototype.ngOnInit=function(){var t=this;this.relatedmodels.module="Contacts",this.relatedmodels.relatedModule="ServiceTickets",this.relatedmodels.modulefilter=this.modulefilter,this.relatedmodels.loaditems=10,this.subscriptions.add(this.model.data$.subscribe(function(e){t.loadrelated()}))},Object.defineProperty(e.prototype,"contactid",{get:function(){return this.model.getField("contact_id")},enumerable:!1,configurable:!0}),e.prototype.loadrelated=function(){var t=this;this.contactid&&this.contactid!=this.relatedmodels.id?(this.relatedmodels.id=this.contactid,this.relatedmodels.getData().subscribe(function(e){t.count.emit(t.relatedmodels.count)})):this.contactid&&""!=this.contactid||(this.relatedmodels.resetData(),this.count.emit(0))},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldset",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"modulefilter",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"count",void 0),__decorate([core_1.Component({selector:"service-ticket-related-tickets-tiles",template:'<ng-container *ngIf="relatedmodels.items.length > 0; else norecords"><div *ngFor="let relateditem of relatedmodels.items" class="slds-p-around--xx-small slds-small-size--1-of-1"><div class="slds-box slds-box--x-small slds-media slds-card__tile slds-m-around--none" object-related-card-tile [fieldset]="fieldset" [data]="relateditem" module="ServiceTickets"></div></div></ng-container><ng-template #norecords><div class="slds-p-around--medium slds-align--absolute-center"><system-illustration-no-records><system-label label="MSG_NO_RECORDS_FOUND"></system-label></system-illustration-no-records></div></ng-template>',providers:[services_1.relatedmodels]}),__metadata("design:paramtypes",[services_1.model,services_1.relatedmodels,services_1.metadata,services_1.language])],e)}();exports.ServiceTicketRelatedTicketsTiles=ServiceTicketRelatedTicketsTiles;var fieldWarrantyIndicator=function(n){function fieldWarrantyIndicator(e,t,i,s,o){var l=n.call(this,e,t,i,s,o)||this;return l.model=e,l.view=t,l.language=i,l.metadata=s,l.router=o,l}return __extends(fieldWarrantyIndicator,n),Object.defineProperty(fieldWarrantyIndicator.prototype,"hasWarranty",{get:function(){return moment.isMoment(this.value)&&this.value.isSameOrAfter(moment(),"day")},enumerable:!1,configurable:!0}),__decorate([core_1.Component({template:'<field-label *ngIf="displayLabel" [fieldname]="fieldname" [fieldconfig]="fieldconfig"></field-label><field-generic-display><div style="width:0.875rem;height:0.875rem;border-radius:0.4375rem" [ngClass]="{\'slds-color__background_gray-8\':!hasWarranty,\'slds-theme_success\':hasWarranty}"></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldWarrantyIndicator)}(objectfields_1.fieldGeneric);exports.fieldWarrantyIndicator=fieldWarrantyIndicator;var fieldBooleanBullet=function(n){function fieldBooleanBullet(e,t,i,s,o){var l=n.call(this,e,t,i,s,o)||this;return l.model=e,l.view=t,l.language=i,l.metadata=s,l.router=o,l}return __extends(fieldBooleanBullet,n),__decorate([core_1.Component({template:'<field-label *ngIf="displayLabel" [fieldname]="fieldname" [fieldconfig]="fieldconfig"></field-label><field-generic-display><div style="width:0.875rem;height:0.875rem;border-radius:0.4375rem" [ngClass]="{\'slds-color__background_gray-8\':!value,\'slds-theme_success\':value}"></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldBooleanBullet)}(objectfields_1.fieldGeneric);exports.fieldBooleanBullet=fieldBooleanBullet;var fieldServiceQueue=function(r){function fieldServiceQueue(e,t,i,s,o,l,n){var a=r.call(this,e,t,i,s,o)||this;return a.model=e,a.view=t,a.language=i,a.metadata=s,a.router=o,a.modal=l,a.injector=n,a}return __extends(fieldServiceQueue,r),Object.defineProperty(fieldServiceQueue.prototype,"canChange",{get:function(){if(this.model.data.acl&&!this.model.data.acl.edit)return!1;var e=this.model.getField("resolve_date");return!(e&&e.isValid&&e.isValid())&&!this.model.isEditing},enumerable:!1,configurable:!0}),fieldServiceQueue.prototype.selectQueue=function(){this.canChange&&this.modal.openModal("ServiceSelectQueueModal",!0,this.injector)},__decorate([core_1.Component({selector:"field-servicequeue",template:'<field-label *ngIf="displayLabel" [fieldname]="fieldname" [fieldconfig]="fieldconfig"></field-label><div [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread"><div class="slds-truncate" (click)="goRecord()" style="min-height: 20px;" [ngClass]="{\'slds-text-link_faux\': link}">{{value}}</div><button style="float: right" class="slds-button slds-button--icon slds-m-left--xx-small" [disabled]="!canChange" (click)="selectQueue()"><system-button-icon [icon]="\'change_record_type\'"></system-button-icon></button></div></ng-template></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.modal,core_1.Injector])],fieldServiceQueue)}(objectfields_1.fieldGeneric);exports.fieldServiceQueue=fieldServiceQueue;var ServiceOrderNewButton=function(){function ServiceOrderNewButton(e,t,i,s,o,l,n,a){this.injector=e,this.language=t,this.metadata=i,this.backend=s,this.modal=o,this.model=l,this.relatedmodels=n,this.parentmodel=a,this.disabled=!0,this.displayasicon=!1}return ServiceOrderNewButton.prototype.execute=function(){var t=this;this.model.module="ServiceOrders",this.model.id=void 0,this.model.initialize();var i=this.modal.await("loading");this.backend.getRequest("modules/ServiceOrders/discoverparent/"+this.parentmodel.module+"/"+this.parentmodel.id).subscribe(function(e){t.model.addModel("",t.parentmodel,{}).subscribe(function(e){0!=e&&t.relatedmodels.addItems([e])}),i.emit(!0)},function(e){i.emit(!0)})},ServiceOrderNewButton.prototype.ngOnInit=function(){this.metadata.checkModuleAcl("ServiceOrders","create")&&(this.disabled=!1)},__decorate([core_1.Component({template:'<system-label label="LBL_NEW"></system-label>',providers:[services_1.model]}),__param(7,core_1.SkipSelf()),__metadata("design:paramtypes",[core_1.Injector,services_1.language,services_1.metadata,services_1.backend,services_1.modal,services_1.model,services_1.relatedmodels,services_1.model])],ServiceOrderNewButton)}();exports.ServiceOrderNewButton=ServiceOrderNewButton;var ServiceOrderEffortItem=function(){function e(e,t,i,s){this.metadata=e,this.language=t,this.model=i,this.view=s,this.item={},this.serviceorder={},this.fieldsetItems=[]}return e.prototype.ngOnInit=function(){this.viewSubscriptions(),this.setConfig()},e.prototype.setItemModelData=function(){this.model.module="ServiceOrderEfforts",this.model.id=this.item.id,this.model.data=this.model.utils.backendModel2spice(this.model.module,this.item)},e.prototype.viewSubscriptions=function(){var t=this;this.view.displayLabels=!1,this.view.isEditable=this.parentview.isEditable,this.view.mode$.subscribe(function(e){t.parentview.getMode()!=e&&"edit"==e&&(t.parentview.setEditMode(),t.parentview.displayLinks=!1)}),this.parentview.mode$.subscribe(function(e){t.view.getMode()!=e&&("edit"==e?(t.view.setEditMode(),t.view.displayLinks=!1):(t.view.setViewMode(),t.view.displayLinks=!0))})},e.prototype.setConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderEffortPanel",this.serviceorder.module);e.fieldset&&(this.fieldsetItems=this.metadata.getFieldSetItems(e.fieldset))},Object.defineProperty(e.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),e.prototype.deleteItem=function(){this.serviceorder.removeRelatedRecords(this.relationlinkname,[this.item.id]),this.serviceorder.data[this.relationlinkname].beans_relations_to_delete[this.item.id]=this.item},Object.defineProperty(e.prototype,"toggleIcon",{get:function(){return this.item.expanded?"chevronup":"chevrondown"},enumerable:!1,configurable:!0}),e.prototype.toggleDetails=function(){this.item.expanded=!this.item.expanded},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"relationlinkname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"serviceorder",void 0),__decorate([core_1.Input(),__metadata("design:type",services_1.view)],e.prototype,"parentview",void 0),__decorate([core_1.Component({selector:"[serviceorder-effort-item]",template:'<td style="width: 20px"><button class="slds-button slds-button_icon" [disabled]="!editing" (click)="deleteItem()"><system-button-icon [icon]="\'close\'"></system-button-icon></button> <button class="slds-button slds-button--icon slds-col_bump-left" (click)="toggleDetails()"><system-button-icon [icon]="toggleIcon"></system-button-icon></button></td><td><field-container fieldname="itemnr" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td><td *ngFor="let fieldsetItem of fieldsetItems"><field-container [fieldname]="fieldsetItem.field" [fieldconfig]="fieldsetItem.fieldconfig" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.view])],e)}();exports.ServiceOrderEffortItem=ServiceOrderEffortItem;var ServiceOrderEffortItemDetails=function(){function e(e,t,i,s){this.metadata=e,this.language=t,this.model=i,this.view=s,this.item={},this.serviceorder={},this.fieldsetItems=[]}return e.prototype.ngOnInit=function(){this.viewSubscriptions(),this.setConfig()},e.prototype.viewSubscriptions=function(){var t=this;this.view.displayLabels=!1,this.view.isEditable=this.parentview.isEditable,this.view.mode$.subscribe(function(e){t.parentview.getMode()!=e&&"edit"==e&&(t.parentview.setEditMode(),t.parentview.displayLinks=!1)}),this.parentview.mode$.subscribe(function(e){t.view.getMode()!=e&&("edit"==e?(t.view.setEditMode(),t.view.displayLinks=!1):(t.view.setViewMode(),t.view.displayLinks=!0))})},e.prototype.setConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderEffortPanel",this.serviceorder.module);e.fieldset&&(this.fieldsetItems=this.metadata.getFieldSetItems(e.detail_fieldset))},Object.defineProperty(e.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toggleIcon",{get:function(){return this.item.expanded?"chevronup":"chevrondown"},enumerable:!1,configurable:!0}),e.prototype.toggleDetails=function(){this.item.expanded=!this.item.expanded},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"serviceorder",void 0),__decorate([core_1.Input(),__metadata("design:type",services_1.view)],e.prototype,"parentview",void 0),__decorate([core_1.Component({selector:"[serviceorder-effort-item-details]",template:'<td style="width: 20px;"></td><td></td><td colspan="3" class="slds-p-around--none"><div [@slideInOut]="item.expanded? \'open\': \'closed\'" class="slds-p-bottom--medium" *ngFor="let fieldsetItem of fieldsetItems" style="overflow-y: hidden; padding: 0px;"><field-container [fieldname]="fieldsetItem.field" [fieldconfig]="fieldsetItem.fieldconfig" fielddisplayclass="slds-truncate"></field-container></div></td>',providers:[services_1.view],animations:[animations_1.trigger("slideInOut",[animations_1.state("open",animations_1.style({height:"80px"})),animations_1.state("closed",animations_1.style({height:"0px"})),animations_1.transition("open <=> closed",[animations_1.animate("200ms")])])]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.view])],e)}();exports.ServiceOrderEffortItemDetails=ServiceOrderEffortItemDetails;var ServiceOrderEffortPanel=function(){function ServiceOrderEffortPanel(e,t,i,s,o,l,n){this.language=e,this.model=t,this.modal=i,this.metadata=s,this.view=o,this.injector=l,this.utils=n,this.componentconfig={},this.fieldset="",this.relation_link_name="",this.product_filter="",this.productvariant_filter="",this.detail_fieldset="",this.fieldsetFields=[],this.sortField="itemnr",this.fieldsetDetailItems=[],this.currentProductType=""}return ServiceOrderEffortPanel.prototype.ngOnInit=function(){this.setComponentConfig(),this.getFieldsetFields()},ServiceOrderEffortPanel.prototype.setComponentConfig=function(){this.componentconfig=this.metadata.getComponentConfig("ServiceOrderEffortPanel",this.model.module),this.fieldset=this.componentconfig.fieldset,this.sortField=this.componentconfig.sortField,this.relation_link_name=this.componentconfig.relation_link_name,this.product_filter=this.componentconfig.product_filter,this.productvariant_filter=this.componentconfig.productvariant_filter,this.detail_fieldset=this.componentconfig.detail_fieldset},ServiceOrderEffortPanel.prototype.getFieldsetFields=function(){this.componentconfig.fieldset&&(this.fieldsetFields=this.metadata.getFieldSetFields(this.fieldset)),this.fieldsetDetailItems=this.metadata.getFieldSetItems(this.detail_fieldset)},Object.defineProperty(ServiceOrderEffortPanel.prototype,"items",{get:function(){var e=this.model.getRelatedRecords(this.relation_link_name);return this.sortItems(e).filter(function(e){return 0==e.deleted||!e.deleted})},set:function(e){this.model.setRelatedRecords(this.relation_link_name,e)},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceOrderEffortPanel.prototype,"itemcount",{get:function(){var e=this.items.filter(function(e){return 1!=e.deleted});if(e)return e.length},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceOrderEffortPanel.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),ServiceOrderEffortPanel.prototype.sortItems=function(e){var i=this;return e.sort(function(e,t){return e[i.sortField]&&t[i.sortField]?e[i.sortField]>t[i.sortField]?1:-1:0})},ServiceOrderEffortPanel.prototype.addItem=function(){var t=this;this.view.setEditMode(),this.metadata.getModuleDefs("Products").acl.list&&this.metadata.getModuleDefs("Products").visible&&(this.metadata.getModuleDefs("ProductVariants").acl.list&&this.metadata.getModuleDefs("ProductVariants").visible?this.modal.openModal("ServiceOrderAddTypeSelector",!0,this.injector).subscribe(function(e){e.instance.itemTypeSelected.subscribe(function(e){e&&(t.currentProductType=e,t.openAddModal(e))})}):this.openAddModal("Products"))},ServiceOrderEffortPanel.prototype.openAddModal=function(t){var l=this;this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe(function(e){e.instance.module=t,e.instance.multiselect=!0,e.instance.relateFilter="ProductVariants"==t?l.productvariant_filter:l.product_filter,e.instance.selectedItems.subscribe(function(e){for(var t=0,i=e;t<i.length;t++){var s=i[t],o={};o.id=l.utils.generateGuid(),o.deleted=!1,o.description=s.description,o.parent_id=s.id,o.parent_name=s.name,o.uom_id=s.base_uom_id,o.quantity=1,o.parent_type=l.currentProductType,o.itemnr=10*(l.itemcount+1),o.acl={create:!0,edit:!0},l.model.addRelatedRecords(l.relation_link_name,[o],!1)}l.currentProductType=""})})},__decorate([core_1.Component({selector:"serviceorder-effort-panel",template:'<table class="slds-table slds-table_bordered"><thead><tr [system-model-provider]="{module: \'ServiceOrderEfforts\'}"><th style="width: 30px;" class="slds-is-fixed"></th><th style="width: 90px" class="slds-is-fixed"><system-label label="LBL_ITEM_NR"></system-label></th><th *ngFor="let fieldsetField of fieldsetFields? fieldsetFields: []" class="slds-is-fixed"><field-label class="slds-truncate" addclasses="slds-truncate" [fieldname]="fieldsetField.field" [fieldconfig]="fieldsetField.fieldconfig"></field-label></th></tr></thead><tbody *ngIf="itemcount > 0"><ng-container *ngFor="let item of items|serviceorderitempipe" [system-model-provider]="{module: \'ServiceOrderEfforts\', data: item}"><tr serviceorder-effort-item [item]="item" [parentview]="view" [serviceorder]="model" [relationlinkname]="relation_link_name"></tr><tr *ngIf="item.expanded" class="slds-p-left--large slds-p-bottom--small slds-p-vertical_x-small" serviceorder-effort-item-details [item]="item" [parentview]="view" [serviceorder]="model" style="padding: 0px;"></tr></ng-container></tbody></table><div *ngIf="itemcount == 0" class="slds-p-around--medium slds-text-align--center"><system-label label="LBL_NO_ENTRIES"></system-label></div><div class="slds-p-around--x-small" *ngIf="editing"><button type="button" class="slds-button slds-button--neutral" (click)="addItem()"><system-label label="LBL_ADD"></system-label></button></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.metadata,services_1.view,core_1.Injector,services_1.modelutilities])],ServiceOrderEffortPanel)}();exports.ServiceOrderEffortPanel=ServiceOrderEffortPanel;var ServiceOrderEquipmentItem=function(){function e(e,t,i,s){this.metadata=e,this.language=t,this.model=i,this.view=s,this.item={},this.fieldsetItems=[],this.is_selected=!1}return e.prototype.ngOnInit=function(){this.setItemModelData(),this.viewSubscriptions(),this.setConfig()},e.prototype.setItemModelData=function(){this.model.module="ServiceEquipments",this.model.id=this.item.id,this.model.data=this.model.utils.backendModel2spice(this.model.module,this.item)},e.prototype.viewSubscriptions=function(){var t=this;this.view.displayLabels=!1,this.view.isEditable=this.parentview.isEditable,this.view.mode$.subscribe(function(e){t.parentview.getMode()!=e&&"edit"==e&&(t.parentview.setEditMode(),t.parentview.displayLinks=!1)}),this.parentview.mode$.subscribe(function(e){t.view.getMode()!=e&&("edit"==e?(t.view.setEditMode(),t.view.displayLinks=!1):(t.view.setViewMode(),t.view.displayLinks=!0))})},e.prototype.setConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderEquipmentPanel",this.serviceorder.module);e.fieldset&&(this.fieldsetItems=this.metadata.getFieldSetItems(e.fieldset)),this.is_selected=this.item.selected},Object.defineProperty(e.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),e.prototype.changeSelection=function(){this.item.selected=!this.item.selected,this.item.selected?(this.serviceorder.addRelatedRecords(this.relationlinkname,[this.item],!1),this.serviceorder.data[this.relationlinkname]&&this.serviceorder.data[this.relationlinkname].beans_relations_to_delete&&this.serviceorder.data[this.relationlinkname].beans_relations_to_delete[this.item.id]&&delete this.serviceorder.data[this.relationlinkname].beans_relations_to_delete[this.item.id]):(this.serviceorder.removeRelatedRecords(this.relationlinkname,[this.item.id]),this.serviceorder.data[this.relationlinkname].beans_relations_to_delete[this.item.id]=this.item)},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"relationlinkname",void 0),__decorate([core_1.Input(),__metadata("design:type",services_1.model)],e.prototype,"serviceorder",void 0),__decorate([core_1.Input(),__metadata("design:type",services_1.view)],e.prototype,"parentview",void 0),__decorate([core_1.Component({selector:"[serviceorder-equipment-item]",template:'<td role="gridcell" class="slds-cell-shrink slds-show--medium" style="min-width: 1rem"><label class="slds-checkbox"><input type="checkbox" [id]="\'check_\' + item.id" [disabled]="!view.isEditMode()" [ngModel]="item.selected" (click)="changeSelection()"> <span class="slds-checkbox--faux"></span></label></td><td *ngFor="let fieldsetItem of fieldsetItems"><field-container [fieldname]="fieldsetItem.field" [fieldconfig]="fieldsetItem.fieldconfig" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.view])],e)}();exports.ServiceOrderEquipmentItem=ServiceOrderEquipmentItem;var ServiceOrderEquipmentPanel=function(){function ServiceOrderEquipmentPanel(e,t,i,s,o,l,n,a,r,d,c){var m=this;this.language=e,this.parent=t,this.model=i,this.modal=s,this.metadata=o,this.view=l,this.injector=n,this.utils=a,this.relatedmodels=r,this.modellist=d,this.cdRef=c,this.componentconfig={},this.fieldset="",this.relation_link_name="",this.equipmentfilter="",this.fieldsetFields=[],this.selected_items=[],this.all_items={},this.sortField="date_entered",this.servicelocationId="",this.currentProductType="",this.componentconfig=this.metadata.getComponentConfig("ServiceOrderEquipmentPanel",this.model.module),this.servicelocationId=this.model.getField("servicelocation_id"),this.subscription=this.model.data$.subscribe(function(e){""!=e.servicelocation_id&&e.servicelocation_id||m.clearAllSelectedItems(),e.servicelocation_id!=m.servicelocationId&&(m.servicelocationId=e.servicelocation_id,""!=m.servicelocationId&&m.servicelocationId&&m.setAllItems())})}return ServiceOrderEquipmentPanel.prototype.ngOnInit=function(){this.setComponentConfig(),this.getFieldsetFields(),""!=this.servicelocationId&&this.servicelocationId&&this.setAllItems()},ServiceOrderEquipmentPanel.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},ServiceOrderEquipmentPanel.prototype.setComponentConfig=function(){this.fieldset=this.componentconfig.fieldset,this.sortField=this.componentconfig.sortField,this.relation_link_name=this.componentconfig.relation_link_name,this.equipmentfilter=this.componentconfig.equipmentfilter},ServiceOrderEquipmentPanel.prototype.getFieldsetFields=function(){this.componentconfig.fieldset&&(this.fieldsetFields=this.metadata.getFieldSetFields(this.fieldset),this.fieldsetFields.shift())},ServiceOrderEquipmentPanel.prototype.setAllItems=function(){var t=this;this.all_items={},this.modellist.setModule("ServiceEquipments"),this.sortField&&this.modellist.setSortField(this.sortField,"DESC",!1),this.model.isNew?this.modellist.filtercontextbeanid=JSON.stringify({serviceorder_id:"",servicelocation_id:this.servicelocationId}):this.modellist.filtercontextbeanid=JSON.stringify({serviceorder_id:this.model.id,servicelocation_id:this.model.data.servicelocation_id}),this.modellist.modulefilter=this.equipmentfilter;this.modellist.getListData(["name","servicelocation_name"]).subscribe(function(e){e&&(e=t.modellist.listData,t.setSelectedItems(e))})},ServiceOrderEquipmentPanel.prototype.setSelectedItems=function(e){var t;this.selected_items=this.model.getRelatedRecords(this.relation_link_name),"ServiceEquipments"==(null===(t=null===(t=this.model)||void 0===t?void 0:t.parentmodel)||void 0===t?void 0:t.module)&&this.selected_items.push(this.model.parentmodel);for(var i=0,s=e.list;i<s.length;i++){var o=s[i];o.selected=!1;for(var l=0,n=this.selected_items;l<n.length;l++){var a=n[l];o.id==a.id&&(o.selected=!0)}}this.all_items=e},ServiceOrderEquipmentPanel.prototype.clearAllSelectedItems=function(){var e;this.all_items.list=null===(e=null===(e=this.all_items)||void 0===e?void 0:e.list)||void 0===e?void 0:e.filter(function(e){return null==e?void 0:e.selected})},Object.defineProperty(ServiceOrderEquipmentPanel.prototype,"items",{get:function(){return this.setSelectedItems(this.all_items),this.all_items},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceOrderEquipmentPanel.prototype,"itemcount",{get:function(){if(null===(e=this.all_items)||void 0===e||!e.list)return 0;var e=this.all_items.list.filter(function(e){return 1!=e.deleted});return e?e.length:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceOrderEquipmentPanel.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),ServiceOrderEquipmentPanel.prototype.sortItems=function(e){var i=this;return e.sort(function(e,t){return e[i.sortField]&&t[i.sortField]?e[i.sortField]>t[i.sortField]?1:-1:0})},__decorate([core_1.Component({selector:"serviceorder-equipment-panel",template:'<table class="slds-table slds-table_bordered"><thead><th style="width: 30px" class="slds-is-fixed"></th><th style="width: 90px" class="slds-is-fixed"><system-label label="LBL_ITEM_NR"></system-label></th><th *ngFor="let fieldsetField of fieldsetFields? fieldsetFields: []" class="slds-is-fixed"><field-label class="slds-truncate" addclasses="slds-truncate" [fieldname]="fieldsetField.field" [fieldconfig]="fieldsetField.fieldconfig"></field-label></th></thead><tbody *ngIf="itemcount > 0"><ng-container *ngFor="let item of items.list|serviceorderitempipe"><tr serviceorder-equipment-item [(item)]="item" [parentview]="view" [serviceorder]="model" [relationlinkname]="relation_link_name"></tr></ng-container></tbody></table><div *ngIf="!loading && !servicelocationId" class="slds-p-around--medium slds-text-align--center"><system-label label="LBL_PLEASE_SELECT_SERVICELOCATION"></system-label></div><div *ngIf="!loading && servicelocationId && itemcount == 0" class="slds-p-around--medium slds-text-align--center"><system-label label="LBL_NO_EQUIPMENTS_UNDER_SERVICELOCATION"></system-label></div>',providers:[services_1.relatedmodels,services_1.modellist]}),__param(1,core_1.SkipSelf()),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.model,services_1.modal,services_1.metadata,services_1.view,core_1.Injector,services_1.modelutilities,services_1.relatedmodels,services_1.modellist,core_1.ChangeDetectorRef])],ServiceOrderEquipmentPanel)}();exports.ServiceOrderEquipmentPanel=ServiceOrderEquipmentPanel;var ServiceOrderItemItem=function(){function e(e,t,i,s){this.metadata=e,this.language=t,this.model=i,this.view=s,this.item={},this.serviceorder={},this.childview=new core_1.EventEmitter,this.fieldsetItems=[]}return e.prototype.ngOnInit=function(){this.setItemModelData(),this.viewSubscriptions(),this.setConfig()},e.prototype.setItemModelData=function(){this.model.module="ServiceOrderItems",this.model.id=this.item.id,this.model.data=this.model.utils.backendModel2spice(this.model.module,this.item)},e.prototype.viewSubscriptions=function(){var t=this;this.view.displayLabels=!1,this.view.isEditable=this.parentview.isEditable,this.view.mode$.subscribe(function(e){t.parentview.getMode()!=e&&"edit"==e&&(t.parentview.setEditMode(),t.parentview.displayLinks=!1)}),this.parentview.mode$.subscribe(function(e){t.view.getMode()!=e&&("edit"==e?(t.view.setEditMode(),t.view.displayLinks=!1):(t.view.setViewMode(),t.view.displayLinks=!0))})},e.prototype.setConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderItemPanel",this.serviceorder.module);e.fieldset&&(this.fieldsetItems=this.metadata.getFieldSetItems(e.fieldset))},Object.defineProperty(e.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),e.prototype.deleteItem=function(){this.item.deleted=!0},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"item",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"serviceorder",void 0),__decorate([core_1.Input(),__metadata("design:type",services_1.view)],e.prototype,"parentview",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"childview",void 0),__decorate([core_1.Component({selector:"[serviceorder-item-item]",template:'<td><button class="slds-button slds-button_icon" [disabled]="!view.isEditMode() || !view.isEditable" (click)="deleteItem()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></td><td><field-container fieldname="itemnr" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td><td *ngFor="let fieldsetItem of fieldsetItems"><field-container [fieldname]="fieldsetItem.field" [fieldconfig]="fieldsetItem.fieldconfig" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.view])],e)}();exports.ServiceOrderItemItem=ServiceOrderItemItem;var ServiceOrderItemPanel=function(){function ServiceOrderItemPanel(e,t,i,s,o,l,n){this.language=e,this.model=t,this.modal=i,this.metadata=s,this.view=o,this.injector=l,this.utils=n,this.componentconfig={},this.fieldset="",this.relation_link_name="",this.product_filter="",this.productvariant_filter="",this.fieldsetFields=[],this.sortField="date_entered",this.currentProductType=""}return ServiceOrderItemPanel.prototype.ngOnInit=function(){this.setComponentConfig(),this.getFieldsetFields()},ServiceOrderItemPanel.prototype.setComponentConfig=function(){this.componentconfig=this.metadata.getComponentConfig("ServiceOrderItemPanel",this.model.module),this.fieldset=this.componentconfig.fieldset,this.sortField="itemnr",this.relation_link_name=this.componentconfig.relation_link_name,this.product_filter=this.componentconfig.product_filter,this.productvariant_filter=this.componentconfig.productvariant_filter},ServiceOrderItemPanel.prototype.getFieldsetFields=function(){this.componentconfig.fieldset&&(this.fieldsetFields=this.metadata.getFieldSetFields(this.fieldset))},Object.defineProperty(ServiceOrderItemPanel.prototype,"items",{get:function(){var e=this.model.getRelatedRecords(this.relation_link_name);return this.sortItems(e).filter(function(e){return 0==e.deleted||!e.deleted})},set:function(e){this.model.setRelatedRecords(this.relation_link_name,e)},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceOrderItemPanel.prototype,"itemcount",{get:function(){var e=this.items.filter(function(e){return 1!=e.deleted});if(e)return e.length},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceOrderItemPanel.prototype,"editing",{get:function(){return this.view.isEditMode()},enumerable:!1,configurable:!0}),ServiceOrderItemPanel.prototype.sortItems=function(e){var i=this;return e.sort(function(e,t){return e[i.sortField]&&t[i.sortField]?e[i.sortField]>t[i.sortField]?1:-1:0})},ServiceOrderItemPanel.prototype.addItem=function(){var t=this;this.view.setEditMode(),this.metadata.getModuleDefs("Products").acl.list&&this.metadata.getModuleDefs("Products").visible&&(this.metadata.getModuleDefs("ProductVariants").acl.list&&this.metadata.getModuleDefs("ProductVariants").visible?this.modal.openModal("ServiceOrderAddTypeSelector",!0,this.injector).subscribe(function(e){e.instance.itemTypeSelected.subscribe(function(e){e&&(t.currentProductType=e,t.openAddModal(e))})}):this.openAddModal("Products"))},ServiceOrderItemPanel.prototype.openAddModal=function(t){var l=this;this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe(function(e){e.instance.module=t,e.instance.multiselect=!0,e.instance.relateFilter="ProductVariants"==t?l.productvariant_filter:l.product_filter,e.instance.selectedItems.subscribe(function(e){for(var t=0,i=e;t<i.length;t++){var s=i[t],o={};o.id=l.utils.generateGuid(),o.deleted=!1,o.description=s.description,o.parent_id=s.id,o.parent_name=s.name,o.uom_id=s.base_uom_id,o.quantity=1,o.parent_type=l.currentProductType,o.itemnr=10*(l.itemcount+1),o.acl={create:!0,edit:!0},l.model.addRelatedRecords(l.relation_link_name,[o],!1)}l.currentProductType=""})})},__decorate([core_1.Component({selector:"serviceorder-item-panel",template:'<table class="slds-table slds-table_bordered"><thead [system-model-provider]="{module: \'ServiceOrderItems\'}"><th style="width: 30px" class="slds-is-fixed"></th><th style="width: 90px" class="slds-is-fixed"><system-label label="LBL_ITEM_NR"></system-label></th><th *ngFor="let fieldsetField of fieldsetFields? fieldsetFields: []" class="slds-is-fixed"><field-label class="slds-truncate" addclasses="slds-truncate" [fieldname]="fieldsetField.field" [fieldconfig]="fieldsetField.fieldconfig"></field-label></th></thead><tbody><ng-container *ngFor="let item of items|serviceorderitempipe"><tr serviceorder-item-item [item]="item" [parentview]="view" [serviceorder]="model"></tr></ng-container></tbody></table><div *ngIf="itemcount == 0" class="slds-p-around--medium slds-text-align--center"><system-label label="LBL_NO_ENTRIES"></system-label></div><div class="slds-p-around--x-small" *ngIf="editing"><button type="button" class="slds-button slds-button--neutral" (click)="addItem()"><system-label label="LBL_ADD"></system-label></button></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.metadata,services_1.view,core_1.Injector,services_1.modelutilities])],ServiceOrderItemPanel)}();exports.ServiceOrderItemPanel=ServiceOrderItemPanel;var ServiceOrderItemPipe=function(){function e(){}return e.prototype.transform=function(e){for(var t=[],i=0,s=e;i<s.length;i++){var o=s[i];1!=o.deleted&&t.push(o)}return t.sort(function(e,t){return parseInt(e.itemnr,10)-parseInt(t.itemnr,10)}),t},__decorate([core_1.Pipe({name:"serviceorderitempipe",pure:!1})],e)}();exports.ServiceOrderItemPipe=ServiceOrderItemPipe;var ServiceOrderAddTypeSelector=function(){function ServiceOrderAddTypeSelector(e,t,i,s){this.metadata=e,this.language=t,this.model=i,this.configuration=s,this.self=void 0,this.itemTypeSelected=new core_1.EventEmitter,this.availableItemTypes=[{id:0,name:"Products",vname:"LBL_PRODUCTS"},{id:1,name:"ProductVariants",vname:"LBL_PRODUCTVARIANTS"}],this.itemType=""}return ServiceOrderAddTypeSelector.prototype.close=function(){this.itemTypeSelected.emit(!1),this.self.destroy()},ServiceOrderAddTypeSelector.prototype.add=function(){this.itemTypeSelected.emit(this.itemType),this.self.destroy()},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ServiceOrderAddTypeSelector.prototype,"itemTypeSelected",void 0),__decorate([core_1.Component({template:'<system-modal size="small"><system-modal-header (close)="close()"><system-label label="LBL_SELECT_ITEMTYPE"></system-label></system-modal-header><system-modal-content><fieldset class="slds-form-element"><div *ngFor="let itemtype of availableItemTypes" class="slds-form-element__control"><div class="slds-radio"><input type="radio" [id]="itemtype.id" [value]="itemtype.name" name="itemType" [(ngModel)]="itemType"> <label class="slds-radio__label" [attr.for]="itemtype.id"><span class="slds-radio_faux"></span> <span class="slds-form-element__label"><system-label [label]="itemtype.vname"></system-label></span></label></div></div></fieldset></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CANCEL"></system-label></button> <button class="slds-button slds-button--brand" [disabled]="!itemType" (click)="add()"><system-label label="LBL_ADD"></system-label></button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.configurationService])],ServiceOrderAddTypeSelector)}();exports.ServiceOrderAddTypeSelector=ServiceOrderAddTypeSelector;var ServiceOrderConfirmButton=function(){function ServiceOrderConfirmButton(e,t,i){this.model=e,this.modal=t,this.injector=i}return ServiceOrderConfirmButton.prototype.execute=function(){this.modal.openModal("ServiceOrderConfirmModal",!0,this.injector)},Object.defineProperty(ServiceOrderConfirmButton.prototype,"display",{get:function(){return!(this.model.data.acl&&!this.model.data.acl.edit)&&!this.model.isEditing},enumerable:!1,configurable:!0}),__decorate([core_1.Component({template:'<system-label label="LBL_CONFIRM_SERVICEORDER" length="short"></system-label>'}),__metadata("design:paramtypes",[services_1.model,services_1.modal,core_1.Injector])],ServiceOrderConfirmButton)}();exports.ServiceOrderConfirmButton=ServiceOrderConfirmButton;var ServiceOrderConfirmModal=function(){function ServiceOrderConfirmModal(e,t,i){this.model=e,this.metadata=t,this.view=i,this.intiializeView()}return ServiceOrderConfirmModal.prototype.ngOnInit=function(){this.loadConfig()},ServiceOrderConfirmModal.prototype.intiializeView=function(){this.view.isEditable=!0,this.view.setEditMode(),this.model.startEdit()},ServiceOrderConfirmModal.prototype.loadConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderConfirmModal",this.model.module);this.componentset=e.componentset},ServiceOrderConfirmModal.prototype.close=function(){this.model.cancelEdit(),this.self.destroy()},ServiceOrderConfirmModal.prototype.confirm=function(){var t=this;this.model.setField("serviceorder_status","confirmed"),this.model.save().subscribe(function(e){t.self.destroy()})},__decorate([core_1.Component({template:'<system-modal><system-modal-header (close)="close()"><system-label label="LBL_CONFIRM_SERVICEORDER"></system-label></system-modal-header><system-modal-content [grow]="true" margin="none"><system-componentset [componentset]="componentset"></system-componentset></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CLOSE"></system-label></button> <button class="slds-button slds-button--brand" (click)="confirm()"><system-label label="LBL_SAVE"></system-label></button></system-modal-footer></system-modal>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.model,services_1.metadata,services_1.view])],ServiceOrderConfirmModal)}();exports.ServiceOrderConfirmModal=ServiceOrderConfirmModal;var ServiceOrderItemConfirmItem=function(l){function e(e,t,i,s){var o=l.call(this,e,t,i,s)||this;return o.metadata=e,o.language=t,o.model=i,o.view=s,o}return __extends(e,l),e.prototype.setConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderItemConfirmationPanel",this.serviceorder.module);e.fieldset&&(this.fieldsetItems=this.metadata.getFieldSetItems(e.fieldset))},Object.defineProperty(e.prototype,"candelete",{get:function(){return this.model.data.confirmadded},enumerable:!1,configurable:!0}),__decorate([core_1.Component({selector:"[serviceorder-item-confirm-item]",template:'<td><button class="slds-button slds-button_icon" [disabled]="!candelete" (click)="deleteItem()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></td><td><field-container fieldname="itemnr" [fieldconfig]="{readonly: true}" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td><td *ngFor="let fieldsetItem of fieldsetItems"><field-container [fieldname]="fieldsetItem.field" [fieldconfig]="fieldsetItem.fieldconfig" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.view])],e)}(ServiceOrderItemItem);exports.ServiceOrderItemConfirmItem=ServiceOrderItemConfirmItem;var ServiceOrderItemConfirmationPanel=function(r){function ServiceOrderItemConfirmationPanel(e,t,i,s,o,l,n){var a=r.call(this,e,t,i,s,o,l,n)||this;return a.language=e,a.model=t,a.modal=i,a.metadata=s,a.view=o,a.injector=l,a.utils=n,a}return __extends(ServiceOrderItemConfirmationPanel,r),ServiceOrderItemConfirmationPanel.prototype.setComponentConfig=function(){this.componentconfig=this.metadata.getComponentConfig("ServiceOrderItemConfirmationPanel",this.model.module),this.fieldset=this.componentconfig.fieldset,this.sortField=this.componentconfig.sortField,this.relation_link_name=this.componentconfig.relation_link_name,this.product_filter=this.componentconfig.product_filter,this.productvariant_filter=this.componentconfig.productvariant_filter},ServiceOrderItemConfirmationPanel.prototype.openAddModal=function(t){var l=this;this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe(function(e){e.instance.module=t,e.instance.multiselect=!0,e.instance.relateFilter="ProductVariants"==t?l.productvariant_filter:l.product_filter,e.instance.selectedItems.subscribe(function(e){for(var t=0,i=e;t<i.length;t++){var s=i[t],o={};o.id=l.utils.generateGuid(),o.deleted=!1,o.description=s.description,o.parent_id=s.id,o.parent_name=s.name,o.uom_id=s.base_uom_id,o.confirmed_quantity=1,o.parent_type=l.currentProductType,o.itemnr=10*(l.itemcount+1),o.confirmadded=!0,o.acl={create:!0,edit:!0},l.model.addRelatedRecords(l.relation_link_name,[o],!1)}l.currentProductType=""})})},__decorate([core_1.Component({template:'<table class="slds-table slds-table_bordered"><thead [system-model-provider]="{module: \'ServiceOrderItems\'}"><th style="width: 30px" class="slds-is-fixed"></th><th style="width: 90px" class="slds-is-fixed"><system-label label="LBL_ITEM_NR"></system-label></th><th *ngFor="let fieldsetField of fieldsetFields? fieldsetFields: []" class="slds-is-fixed"><field-label class="slds-truncate" addclasses="slds-truncate" [fieldname]="fieldsetField.field" [fieldconfig]="fieldsetField.fieldconfig"></field-label></th></thead><tbody><ng-container *ngFor="let item of items|serviceorderitempipe"><tr serviceorder-item-confirm-item [item]="item" [parentview]="view" [serviceorder]="model"></tr></ng-container></tbody></table><div *ngIf="itemcount == 0" class="slds-p-around--medium slds-text-align--center"><system-label label="LBL_NO_ENTRIES"></system-label></div><div class="slds-p-around--x-small" *ngIf="editing"><button type="button" class="slds-button slds-button--neutral" (click)="addItem()"><system-label label="LBL_ADD"></system-label></button></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.metadata,services_1.view,core_1.Injector,services_1.modelutilities])],ServiceOrderItemConfirmationPanel)}(ServiceOrderItemPanel);exports.ServiceOrderItemConfirmationPanel=ServiceOrderItemConfirmationPanel;var ServiceOrderEffortConfirmationItem=function(l){function e(e,t,i,s){var o=l.call(this,e,t,i,s)||this;return o.metadata=e,o.language=t,o.model=i,o.view=s,o.fieldsetItems=[],o}return __extends(e,l),e.prototype.setConfig=function(){var e=this.metadata.getComponentConfig("ServiceOrderEffortConfirmationPanel",this.serviceorder.module);e.fieldset&&(this.fieldsetItems=this.metadata.getFieldSetItems(e.fieldset))},Object.defineProperty(e.prototype,"candelete",{get:function(){return this.model.data.confirmadded},enumerable:!1,configurable:!0}),__decorate([core_1.Component({selector:"[serviceorder-effort-confirmation-item]",template:'<td style="width: 20px"><button class="slds-button slds-button_icon" [disabled]="!candelete" (click)="deleteItem()"><system-button-icon [icon]="\'close\'"></system-button-icon></button> <button class="slds-button slds-button--icon slds-col_bump-left" (click)="toggleDetails()"><system-button-icon [icon]="toggleIcon"></system-button-icon></button></td><td><field-container fieldname="itemnr" [fieldconfig]="{readonly: true}" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td><td *ngFor="let fieldsetItem of fieldsetItems"><field-container [fieldname]="fieldsetItem.field" [fieldconfig]="fieldsetItem.fieldconfig" fielddisplayclass="slds-truncate slds-p-horizontal--x-small"></field-container></td>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.model,services_1.view])],e)}(ServiceOrderEffortItem);exports.ServiceOrderEffortConfirmationItem=ServiceOrderEffortConfirmationItem;var ServiceOrderEffortConfirmationPanel=function(r){function ServiceOrderEffortConfirmationPanel(e,t,i,s,o,l,n){var a=r.call(this,e,t,i,s,o,l,n)||this;return a.language=e,a.model=t,a.modal=i,a.metadata=s,a.view=o,a.injector=l,a.utils=n,a}return __extends(ServiceOrderEffortConfirmationPanel,r),ServiceOrderEffortConfirmationPanel.prototype.setComponentConfig=function(){this.componentconfig=this.metadata.getComponentConfig("ServiceOrderEffortConfirmationPanel",this.model.module),this.fieldset=this.componentconfig.fieldset,this.sortField=this.componentconfig.sortField,this.relation_link_name=this.componentconfig.relation_link_name,this.product_filter=this.componentconfig.product_filter,this.productvariant_filter=this.componentconfig.productvariant_filter,this.detail_fieldset=this.componentconfig.detail_fieldset},ServiceOrderEffortConfirmationPanel.prototype.openAddModal=function(t){var l=this;this.modal.openModal("ObjectModalModuleLookup",!0,this.injector).subscribe(function(e){e.instance.module=t,e.instance.multiselect=!0,e.instance.relateFilter="ProductVariants"==t?l.productvariant_filter:l.product_filter,e.instance.selectedItems.subscribe(function(e){for(var t=0,i=e;t<i.length;t++){var s=i[t],o={};o.id=l.utils.generateGuid(),o.deleted=!1,o.description=s.description,o.parent_id=s.id,o.parent_name=s.name,o.uom_id=s.base_uom_id,o.quantity=1,o.parent_type=l.currentProductType,o.itemnr=10*(l.itemcount+1),o.confirmadded=!0,o.acl={create:!0,edit:!0},l.model.addRelatedRecords(l.relation_link_name,[o],!1)}l.currentProductType=""})})},__decorate([core_1.Component({template:'<table class="slds-table slds-table_bordered"><thead><tr [system-model-provider]="{module: \'ServiceOrderEfforts\'}"><th style="width: 30px;" class="slds-is-fixed"></th><th style="width: 90px" class="slds-is-fixed"><system-label label="LBL_ITEM_NR"></system-label></th><th *ngFor="let fieldsetField of fieldsetFields? fieldsetFields: []" class="slds-is-fixed"><field-label class="slds-truncate" addclasses="slds-truncate" [fieldname]="fieldsetField.field" [fieldconfig]="fieldsetField.fieldconfig"></field-label></th></tr></thead><tbody *ngIf="itemcount > 0"><ng-container *ngFor="let item of items|serviceorderitempipe" [system-model-provider]="{module: \'ServiceOrderEfforts\', data: item}"><tr serviceorder-effort-confirmation-item [item]="item" [parentview]="view" [serviceorder]="model" [relationlinkname]="relation_link_name"></tr></ng-container></tbody></table><div *ngIf="itemcount == 0" class="slds-p-around--medium slds-text-align--center"><system-label label="LBL_NO_ENTRIES"></system-label></div><div class="slds-p-around--x-small" *ngIf="editing"><button type="button" class="slds-button slds-button--neutral" (click)="addItem()"><system-label label="LBL_ADD"></system-label></button></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.metadata,services_1.view,core_1.Injector,services_1.modelutilities])],ServiceOrderEffortConfirmationPanel)}(ServiceOrderEffortPanel);exports.ServiceOrderEffortConfirmationPanel=ServiceOrderEffortConfirmationPanel;var ServicePlanner=function(){function ServicePlanner(e,t,i,s,o,l,n,a,r,d,c,m){this.language=e,this.cdRef=t,this.renderer=i,this.broadcast=s,this.metadata=o,this.navigationtab=l,this.backend=n,this.session=a,this.navigation=r,this.view=d,this.servicePlannerService=c,this.modellist=m,this.timelineRecords=[],this.moduleFilters={timelineUsers:null,timelineOrders:null,mapOrders:null},this.subscriptions=new rxjs_1.Subscription,this.endDate=moment(),this.startDate=moment(),this.isLoading=!1,this.subscribeToChanges(),this.setTabInfo(),this.view.displayLabels=!1}return ServicePlanner.prototype.ngOnInit=function(){this.loadModuleFilters(),this.timeZone=this.session.getSessionData("timezone")||moment.tz.guess(),this.initializeModelList()},ServicePlanner.prototype.initializeModelList=function(){this.modellist.usecache=!1,this.modellist.setModule("ServiceOrders",!0),this.modellist.setListType("all",!1,[],!1),this.modellist.listcomponent="SpiceGoogleMapsList",this.modellist.reLoadList(!0)},ServicePlanner.prototype.loadModuleFilters=function(){var e=this.metadata.getComponentConfig("ServicePlanner","ServiceOrders");e&&(this.moduleFilters.timelineUsers=e.timelineUsersFilter||null,this.moduleFilters.timelineOrders=e.timelineOrdersFilter||null,this.moduleFilters.mapOrders=e.mapOrdersFilter||null,this.modellist.modulefilter=this.moduleFilters.mapOrders)},ServicePlanner.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},ServicePlanner.prototype.setTabInfo=function(){this.navigationtab.setTabInfo({displayname:this.language.getLabel("LBL_SERVICE_PLANNER"),displayicon:"date_input"})},ServicePlanner.prototype.setDateRange=function(e){this.startDate=new moment(e.start.format()),this.endDate=new moment(e.end.format()),this.getUsersServiceOrders()},ServicePlanner.prototype.subscribeToChanges=function(){var i=this,e=this.broadcast.message$.subscribe(function(e){var t=e.messagedata.module;e.messagedata.data;switch(e.messagetype){case"timezone.changed":i.timeZone=e.messagedata,i.timelineRecords=i.timelineRecords.map(function(e){return e.events=e.events.map(function(e){return e.start=e.start.tz(i.timeZone),e.end=e.end.tz(i.timeZone),e}),e}),i.cdRef.detectChanges();break;case"model.delete":case"model.save":if("ServiceOrders"!==t)break;i.getUsersServiceOrders(),i.modellist.reLoadList(!0)}});this.subscriptions.add(e)},ServicePlanner.prototype.getUsersServiceOrders=function(){var t=this;this.timelineRecords=[],this.isLoading=!0;var e="YYYY-MM-DD HH:mm:ss",e={start:this.startDate.format(e),end:this.endDate.format(e),timelineUsersFilter:this.moduleFilters.timelineUsers,timelineOrdersFilter:this.moduleFilters.timelineOrders};this.backend.getRequest("modules/ServiceOrders/Planner/records",e).pipe(operators_1.map(function(e){return e.map(function(e){return e.events=e.events.map(function(e){return e.start=new moment(moment.utc(e.start).tz(t.timeZone).format()),e.end=new moment(moment.utc(e.end).tz(t.timeZone).format()),e}),e})})).subscribe(function(e){t.timelineRecords=e,t.isLoading=!1,t.cdRef.detectChanges()},function(){t.isLoading=!1,t.cdRef.detectChanges()})},ServicePlanner.prototype.handleEventClick=function(e){this.broadcast.broadcastMessage("map.defocus",{tabId:this.navigation.activeTabObject.id,record:{}});var t=this.servicePlannerService.timelineSelectedItem;e.event&&(!t||!t.event||t.event&&e.event.id!=t.event.id)&&this.broadcast.broadcastMessage("map.focus",{record:e.event,tabId:this.navigation.activeTabObject.id}),t?(t.event&&(this.servicePlannerService.timelineSelectedItem.event.color=null),t.record.id==e.record.id&&!e.event&&!t.event||e.event&&t.event&&e.event.id==t.event.id?this.servicePlannerService.timelineSelectedItem=void 0:this.servicePlannerService.timelineSelectedItem=e):this.servicePlannerService.timelineSelectedItem=e,this.timelineRecords=this.timelineRecords.slice()},__decorate([core_1.Component({selector:"service-planner",template:'<div class="slds-grid slds-grid--vertical" system-to-bottom-noscroll><div class="slds-border--bottom" style="height: 50%" [system-overlay-loading-spinner]="isLoading"><spice-timeline [records]="timelineRecords" recordModule="Users" (dateChange)="setDateRange($event)" (eventClick)="handleEventClick($event)"></spice-timeline></div><div style="height: 50%"><system-dynamic-component component="SpiceGoogleMapsList"></system-dynamic-component></div></div>',changeDetection:core_1.ChangeDetectionStrategy.OnPush,providers:[ServicePlannerService,services_1.modellist,services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,core_1.ChangeDetectorRef,core_1.Renderer2,services_1.broadcast,services_1.metadata,services_1.navigationtab,services_1.backend,services_1.session,services_1.navigation,services_1.view,ServicePlannerService,services_1.modellist])],ServicePlanner)}();exports.ServicePlanner=ServicePlanner;var ServicePlannerMapsModelPopover=function(o){function ServicePlannerMapsModelPopover(e,t,i){var s=o.call(this,e,t,i)||this;return s.model=e,s.view=t,s.metadata=i,s}return __extends(ServicePlannerMapsModelPopover,o),ServicePlannerMapsModelPopover.prototype.ngOnInit=function(){this.model.module=this.popovermodule,this.model.id=this.popoverid,this.model.getData();var e=this.metadata.getComponentConfig("ServicePlannerMapsModelPopover",this.popovermodule);(e.fieldset||e.componentset)&&(this.fields=this.metadata.getFieldSetFields(e.fieldset),this.fieldset=e.fieldset,this.componentset=e.componentset,this.headercomponentset=e.headercomponentset),this.fieldset||(e=this.metadata.getComponentConfig("ObjectPageHeaderDetails",this.popovermodule)).fieldset&&(this.fields=this.metadata.getFieldSetFields(e.fieldset),this.fieldset=e.fieldset),this.styles=this.popoverStyle},__decorate([core_1.Component({selector:"service-planner-maps-model-popover",template:'<div class="slds-popover slds-popover_large slds-popover--panel slds-is-fixed" style="transition: .5s; z-index: 11000;" [ngStyle]="popoverStyle" [ngClass]="getNubbinClass()" role="dialog" (mouseenter)="onMouseOver()" (mouseleave)="onMouseOut()"><button class="slds-button slds-button_icon slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" (click)="closePopover(true)"><system-button-icon icon="close"></system-button-icon></button><div #popover><div class="slds-popover__header"><system-componentset *ngIf="headercomponentset" [componentset]="headercomponentset"></system-componentset><object-model-popover-header *ngIf="!headercomponentset"></object-model-popover-header><footer class="slds-grid slds-wrap slds-p-right--large"><div class="slds-p-horizontal--small slds-size--1-of-2 slds-p-bottom--x-small" [ngClass]="{\'slds-size--1-of-2\': fields.length > 1, \'slds-size--1-of-1\': fields.length == 1}" *ngFor="let field of fields"><dl><dd><field-container [field]="field.field" [fieldconfig]="field.fieldconfig" [fielddisplayclass]="\'slds-truncate\'"></field-container></dd></dl></div></footer></div><div #relatedcontainer class="slds-popover__body slds-scrollable--y spice-scrollbar" [ngStyle]="relatedStyle"><system-componentset [componentset]="componentset"></system-componentset></div></div></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.metadata])],ServicePlannerMapsModelPopover)}(objectcomponents_1.ObjectModelPopover);exports.ServicePlannerMapsModelPopover=ServicePlannerMapsModelPopover;var ServicePlannerMapsModelPopoverDirection=function(){function ServicePlannerMapsModelPopoverDirection(e,t,i,s,o,l,n,a,r){this.model=e,this.language=t,this.renderer=i,this.broadcast=s,this.userpreferences=o,this.metadata=l,this.cdRef=n,this.modal=a,this.servicePlannerService=r,this.isLoading=!1,this.unitSystem="METRIC",this.subscribeToBroadcast(),this.loadFieldset()}return ServicePlannerMapsModelPopoverDirection.prototype.convertDistanceToString=function(e){if("IMPERIAL"!=this.unitSystem)return 1e3<e?Math.pow(+(e/1e3).toFixed(1),1)+" km":e+" m";e*=3.2808;return 5280<e?Math.pow(+(e/5280).toFixed(1),1)+" mile":Math.round(e)+" ft"},ServicePlannerMapsModelPopoverDirection.prototype.subscribeToBroadcast=function(){var t=this;this.broadcast.message$.subscribe(function(e){"userpreferences.save"===e.messagetype&&(t.unitSystem=t.userpreferences.toUse.distance_unit_system||"METRIC",t.directionData&&(t.directionData.distance.text=t.convertDistanceToString(t.directionData.distance.value)))})},ServicePlannerMapsModelPopoverDirection.prototype.loadFieldset=function(){var e=this.metadata.getComponentConfig("SpiceTimeline","ServiceOrders");e&&e.fieldset&&(this.fieldset=e.fieldset)},ServicePlannerMapsModelPopoverDirection.prototype.calculateRoute=function(){var e,t,i,s=this;window.google&&(this.isLoading=!0,e=new google.maps.DirectionsService,t={lat:this.servicePlannerService.timelineSelectedItem.event.data.address_latitude,lng:this.servicePlannerService.timelineSelectedItem.event.data.address_longitude},i={lat:this.model.data.address_latitude,lng:this.model.data.address_longitude},e.route({origin:t,destination:i,travelMode:"DRIVING",unitSystem:google.maps.UnitSystem[this.unitSystem||"METRIC"]},function(e,t){"OK"===t?s.calculateDirectionData(e.routes):(window.console.error(s.language.getLabel("MSG_DIRECTION_REQUEST_FAILED")),s.isLoading=!1,s.cdRef.detectChanges())}))},ServicePlannerMapsModelPopoverDirection.prototype.calculateDirectionData=function(e){var t={value:0,text:""},i=0;e.forEach(function(e){e.legs.forEach(function(e){t.value+=e.distance.value,i+=e.duration.value})}),t.text=this.convertDistanceToString(t.value),this.directionData={distance:t,duration:{minutes:Math.round(60*(i/3600-Math.floor(i/3600))),hours:Math.floor(i/3600)}},this.calculatedDateStart=new moment(this.servicePlannerService.timelineSelectedItem.event.data.date_end).add(moment.duration(this.directionData.duration.minutes+60*this.directionData.duration.hours,"minutes")).format(),this.isLoading=!1,this.cdRef.detectChanges()},ServicePlannerMapsModelPopoverDirection.prototype.plan=function(){this.model.startEdit();var e,t=this.componentconfig&&this.componentconfig.planningUserFieldNamePrefix?this.componentconfig.planningUserFieldNamePrefix:void 0;t=t||(this.metadata.getComponentConfig("ServicePlannerMapsModelPopoverDirection","ServiceOrders").planningUserFieldNamePrefix||"assigned_user"),this.model.setFields({date_start:new moment(this.calculatedDateStart),date_end:new moment(this.calculatedDateStart).add(1,"hours"),serviceorder_status:"planned"}),this.servicePlannerService.timelineSelectedItem&&(e={},t+"_type"in this.model.data&&(e[t+"_type"]="Users"),t+"_id"in this.model.data&&(e[t+"_id"]=this.servicePlannerService.timelineSelectedItem.record.id),t+"_name"in this.model.data&&(e[t+"_name"]=this.servicePlannerService.timelineSelectedItem.record.name),this.model.setFields(e)),this.modal.closeAllModals(),this.model.edit()},__decorate([core_1.Component({selector:"service-planner-maps-model-popover-direction",template:'<div class="slds-size--1-of-1 slds-height_full slds-p-around--large"><div *ngIf="servicePlannerService.timelineSelectedItem" class="slds-scrollable--y slds-size--1-of-1 slds-height_full" [system-overlay-loading-spinner]="isLoading"><object-record-fieldset-horizontal-list *ngIf="!!fieldset && !!servicePlannerService.timelineSelectedItem.event; else summaryContainer" [fieldset]="fieldset"></object-record-fieldset-horizontal-list><ng-template #summaryContainer><span *ngIf="servicePlannerService.timelineSelectedItem.event" system-model-popover [enablelink]="false" class="slds-text-link--reset">{{servicePlannerService.timelineSelectedItem.event.data?.summary_text}}</span> <span *ngIf="!servicePlannerService.timelineSelectedItem.event" class="slds-text-link--reset">{{servicePlannerService.timelineSelectedItem.record?.name}}</span></ng-template><dl *ngIf="directionData" class="slds-list_horizontal slds-wrap slds-text-body_small"><dt class="slds-item_label slds-text-color_weak slds-truncate slds-m-bottom--x-small"><system-label label="LBL_DURATION"></system-label></dt><dd class="slds-item_detail slds-m-bottom--x-small">{{directionData.duration?.hours}} h {{directionData.duration?.minutes}} min</dd><dt class="slds-item_label slds-text-color_weak slds-truncate slds-m-bottom--x-small"><system-label label="LBL_DISTANCE"></system-label></dt><dd class="slds-item_detail slds-m-bottom--x-small">{{directionData.distance?.text}}</dd><dt class="slds-item_label slds-text-color_weak slds-truncate slds-m-bottom--x-small"><system-label label="LBL_DATE_START"></system-label></dt><dd class="slds-item_detail slds-m-bottom--x-small">{{calculatedDateStart}}</dd><dt class="slds-item_label slds-text-color_weak slds-truncate slds-m-bottom--x-small"><system-label label="LBL_ADDRESS"></system-label></dt><dd class="slds-item_detail slds-m-bottom--x-small">{{servicePlannerService.timelineSelectedItem?.event?.data?.address_street}} {{servicePlannerService.timelineSelectedItem?.event?.data?.address_postalcode}} {{servicePlannerService.timelineSelectedItem?.event?.data?.address_city}}</dd></dl></div><div class="slds-grid slds-grid--align-end"><button class="slds-button slds-button--neutral" (click)="calculateRoute()" [disabled]="model.isLoading || isLoading || directionData || !servicePlannerService.timelineSelectedItem?.event"><system-label label="LBL_CALCULATE_ROUTE"></system-label></button> <button class="slds-button slds-button--brand" (click)="plan()" [disabled]="model.isLoading || isLoading"><system-label label="LBL_PLAN"></system-label></button></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.language,core_1.Renderer2,services_1.broadcast,services_1.userpreferences,services_1.metadata,core_1.ChangeDetectorRef,services_1.modal,ServicePlannerService])],ServicePlannerMapsModelPopoverDirection)}();exports.ServicePlannerMapsModelPopoverDirection=ServicePlannerMapsModelPopoverDirection;var ServiceDocSignatureButton=function(){function ServiceDocSignatureButton(e,t,i,s,o,l){this.language=e,this.model=t,this.modal=i,this.backend=s,this.configuration=o,this.viewContainerRef=l,this.templates=[]}return ServiceDocSignatureButton.prototype.execute=function(){var i=this,e=this.configuration.getData("OutputTemplates");e&&e[this.model.module]?(this.templates=e[this.model.module],this.openOutput()):(e={},this.modal.openModal("SystemLoadingModal",!1).subscribe(function(t){t.instance.messagelabel="Loading Templates",i.backend.getRequest("module/OutputTemplates/formodule/"+i.model.module,{}).subscribe(function(e){t.instance.self.destroy(),i.configuration.setData("OutputTemplates",e),i.templates=e,i.openOutput()},function(e){t.instance.self.destroy()})}))},ServiceDocSignatureButton.prototype.openOutput=function(){var t=this;0<this.templates.length?(this.templates.sort(function(e,t){return e.name>t.name?1:-1}),this.modal.openModal("ServiceDocSignatureModal",!0,this.viewContainerRef.injector).subscribe(function(e){e.instance.templates=t.templates,e.instance.modalTitle=t.modalTitle,e.instance.noDownload=t.noDownload,e.instance.handBack=t.handBack,e.instance.buttonText=t.buttonText})):this.modal.info("No Templates Found","there are no Output templates defined for the Module")},__decorate([core_1.Component({selector:"service-docs-signature-button",template:'<span><system-label label="LBL_SIGN_DOC"></system-label></span>'}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.modal,services_1.backend,services_1.configurationService,core_1.ViewContainerRef])],ServiceDocSignatureButton)}();exports.ServiceDocSignatureButton=ServiceDocSignatureButton;var ServiceDocSignatureContent=function(){function e(e,t,i,s,o){this.language=e,this.metadata=t,this.modal=i,this.view=s,this.session=o,this.fieldset=null,this.parent={},this.rendertemplate=new core_1.EventEmitter,this.sending=!1}return e.prototype.ngOnInit=function(){this.setViewData()},e.prototype.setViewData=function(){this.view.setEditMode(),this.view.isEditable=!0},e.prototype.saveSignature=function(){var i=this;this.modal.openModal("SystemLoadingModal",!1).subscribe(function(t){t.instance.messagelabel="LBL_SENDING",i.parent.save().subscribe(function(e){t.instance.self.destroy(),i.rendertemplate.emit()},function(e){t.instance.self.destroy(),i.sending=!1})})},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldset",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"parent",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"rendertemplate",void 0),__decorate([core_1.Component({selector:"service-docs-signature-content",template:'<object-record-fieldset [fieldset]="fieldset" direction="vertical"></object-record-fieldset>',providers:[services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.modal,services_1.view,services_1.session])],e)}();exports.ServiceDocSignatureContent=ServiceDocSignatureContent;var ServiceDocSignatureModal=function(){function ServiceDocSignatureModal(e,t,i,s,o,l,n,a,r,d){this.language=e,this.model=t,this.metadata=i,this.modal=s,this.view=o,this.backend=l,this.sanitizer=n,this.cdRef=a,this.viewContainerRef=r,this.layout=d,this.noDownload=!1,this.self=void 0,this.templates=[],this._selected_template=null,this._selected_format="pdf",this.compiled_selected_template="",this.loading_output=!1,this.fieldset="",this.showsendemail=!0,this.expanded="open",this.mobile=!1;d=this.metadata.getComponentConfig("ServiceDocSignatureModal",this.model.module);this.fieldset=d.fieldset,this.mobile="large"!=this.layout.screenwidth,this.expanded=(this.mobile,"_mobile")}return ServiceDocSignatureModal.prototype.ngOnInit=function(){this.setModalData(),this.setSelectedTemplate(),this.selected_template||1!=this.templates.length||(this.selected_template=this.templates[0],this.rendertemplate())},ServiceDocSignatureModal.prototype.setModalData=function(){this.modalTitle||(this.modalTitle=this.language.getLabel(this.language.getLabel("LBL_SIGN"))),this.buttonText||(this.buttonText=this.language.getLabel(this.noDownload?"LBL_OK":"LBL_DOWNLOAD")),this.forcedFormat&&(this._selected_format=this.forcedFormat)},ServiceDocSignatureModal.prototype.setSelectedTemplate=function(){var e,i=this,s=this.metadata.getModuleFields(this.model.module),o=this;for(e in s)if("break"===function(t){if("relate"==s[t].type&&"OutputTemplates"==s[t].module){var e=o.templates.find(function(e){return e.id==i.model.getFieldValue(s[t].id_name)});return e&&(o.selected_template=e),"break"}}(e))break},Object.defineProperty(ServiceDocSignatureModal.prototype,"selected_template",{get:function(){return this._selected_template},set:function(e){this._selected_template=e,this.rendertemplate()},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceDocSignatureModal.prototype,"selected_format",{get:function(){return this._selected_format},set:function(e){this._selected_format=e,this.expanded=(this.mobile,"_mobile"),this.rendertemplate()},enumerable:!1,configurable:!0}),Object.defineProperty(ServiceDocSignatureModal.prototype,"sanitizedTemplated",{get:function(){return this.sanitizer.bypassSecurityTrustHtml(this.compiled_selected_template)},enumerable:!1,configurable:!0}),ServiceDocSignatureModal.prototype.rendertemplate=function(){var i=this;switch(this.loading_output=!0,this.blobUrl=null,this.compiled_selected_template=null,this.selected_format){case"pdf":this.backend.getRequest("OutputTemplates/"+this.selected_template.id+"/convert/"+this.model.id+"/to/pdf/base64").subscribe(function(e){var t=i.datatoBlob(atob(e.content));i.blobUrl=i.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(t)),i.contentForHandBack=e.content,i.loading_output=!1},function(e){i.loading_output=!1});break;case"html":this.backend.getRequest("OutputTemplates/"+this.selected_template.id+"/compile/"+this.model.id).subscribe(function(e){i.compiled_selected_template=e.content,i.contentForHandBack=e.content,i.loading_output=!1},function(e){i.loading_output=!1})}},ServiceDocSignatureModal.prototype.reload=function(){this.rendertemplate()},ServiceDocSignatureModal.prototype.close=function(){this.self.destroy()},Object.defineProperty(ServiceDocSignatureModal.prototype,"data",{set:function(e){e=this.datatoBlob(e);this.blobUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e))},enumerable:!1,configurable:!0}),ServiceDocSignatureModal.prototype.datatoBlob=function(e,t,i){void 0===t&&(t=""),void 0===i&&(i=512);for(var s=[],o=0;o<e.length;o+=i){for(var l=e.slice(o,o+i),n=new Array(l.length),a=0;a<l.length;a++)n[a]=l.charCodeAt(a);var r=new Uint8Array(n);s.push(r)}return new Blob(s,{type:t})},ServiceDocSignatureModal.prototype.openContentArea=function(){"closed"==this.expanded||"closed_mobile"==this.expanded?this.expanded="open"+(this.mobile?"_mobile":""):this.expanded="closed"+(this.mobile?"_mobile":"")},ServiceDocSignatureModal.prototype.saveSignature=function(){this.signatureContent.saveSignature()},ServiceDocSignatureModal.prototype.onAnimationDone=function(){this.cdRef.detectChanges()},__decorate([core_1.ViewChild(ServiceDocSignatureContent),__metadata("design:type",ServiceDocSignatureContent)],ServiceDocSignatureModal.prototype,"signatureContent",void 0),__decorate([core_1.Component({selector:"service-docs-signature-modal",template:'<system-modal size="large"><system-modal-header (close)="close()">{{modalTitle}}</system-modal-header><system-modal-content margin="none"><div class="slds-modal__content"><div class="slds-form-element__control slds-grid slds-grid--vertical-align-center slds-p-around--small"><label class="slds-col slds-p-right--x-small"><system-label label="LBL_TEMPLATE"></system-label></label><select class="slds-col slds-select slds-grow" [(ngModel)]="selected_template" [disabled]="templates.length == 0"><option *ngFor="let templ of templates" [ngValue]="templ">{{templ.name}} ({{templ.language}})</option></select><ng-container *ngIf="!forcedFormat"><label class="slds-p-left--small slds-col slds-p-right--x-small"><system-label label="LBL_DISPLAY"></system-label></label></ng-container><button *ngIf="this.metadata.checkModuleAcl(model.module, \'create\')" [disabled]="!selected_template || loading_output || selected_format === \'html\'" class="slds-button slds-button--icon slds-button--icon-border slds-m-left--small slds-is-selected" [ngClass]="{\'slds-is-selected\' : expanded == \'open\' || expanded == \'open_mobile\'}" (click)="openContentArea()"><system-button-icon icon="edit_form"></system-button-icon></button></div><div class="slds-grid" style="height: 70vh;"><div class="slds-p-around--small" [ngStyle]="{ \'width\': mobile? \'0%\' : \'50%\' }" style="height: 100%" [@slideInOut]="expanded"><div class="slds-m-top--small slds-border--top slds-border--right slds-border--left slds-border--bottom" style="width: 100%; height: calc(100% - 50px);"><object *ngIf="selected_format === \'pdf\' && !loading_output && blobUrl" [data]="blobUrl" type="application/pdf" width="100%" height="100%"></object><div *ngIf="loading_output" class="slds-align--absolute-center" style="height: 100%;"><system-spinner></system-spinner></div><div *ngIf="!selected_template && !loading_output" class="slds-align--absolute-center" style="height: 100%;"><system-label label="LBL_SELECT_TEMPLATE"></system-label></div></div></div><div class="slds-scrollable" style="height: 100%;" [ngStyle]="{ \'width\': mobile? \'100%\' : \'50%\' }" [@slideInOut2]="expanded" (@slideInOut2.done)="onAnimationDone()"><service-docs-signature-content #emailcontent [fieldset]="fieldset" [parent]="model" (rendertemplate)="rendertemplate()"></service-docs-signature-content></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()"><system-label label="LBL_CLOSE"></system-label></button> <button [disabled]="!selected_template || loading_output" class="slds-button slds-button--brand" (click)="saveSignature()">{{language.getLabel(\'LBL_SAVE_SIGNATURE\')}}</button></system-modal-footer></system-modal>',providers:[services_1.view],animations:[animations_1.trigger("slideInOut",[animations_1.state("open",animations_1.style({width:"50%"})),animations_1.state("closed",animations_1.style({width:"100%"})),animations_1.state("open_mobile",animations_1.style({width:"0%"})),animations_1.state("closed_mobile",animations_1.style({width:"100%"})),animations_1.transition("open <=> closed",[animations_1.animate("200ms")]),animations_1.transition("open_mobile <=> closed_mobile",[animations_1.animate("200ms")])]),animations_1.trigger("slideInOut2",[animations_1.state("open",animations_1.style({width:"50%"})),animations_1.state("closed",animations_1.style({width:"0%"})),animations_1.state("open_mobile",animations_1.style({width:"100%"})),animations_1.state("closed_mobile",animations_1.style({width:"0%"})),animations_1.transition("open <=> closed",[animations_1.animate("200ms")]),animations_1.transition("open_mobile <=> closed_mobile",[animations_1.animate("200ms")])])]}),__metadata("design:paramtypes",[services_1.language,services_1.model,services_1.metadata,services_1.modal,services_1.view,services_1.backend,platform_browser_1.DomSanitizer,core_1.ChangeDetectorRef,core_1.ViewContainerRef,services_1.layout])],ServiceDocSignatureModal)}();exports.ServiceDocSignatureModal=ServiceDocSignatureModal;var ServiceComponentsModule=function(){function ServiceComponentsModule(){}return __decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,directives_1.DirectivesModule,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,spicetimeline_1.ModuleSpiceTimeline],declarations:[fieldWarrantyIndicator,fieldBooleanBullet,fieldServiceQueue,SignServiceOrderModalButtonComponent,SignServiceOrderModalComponent,ServiceOrderSummaryComponent,ServiceActivitiyTimelineAddServiceCall,ServiceAddTicketButton,ServiceAddTicketActionButton,ServiceCategoryManagerComponent,ServiceSelectQueueButton,ServiceSelectQueueModal,ServiceMyTicketsDashlet,ServiceMyQueuesTicketsDashlet,ServiceMyQueuesTicketsDashletItem,ServiceTicketProlongButton,ServiceTicketProlongModal,ServiceTicketSLAIndicator,ServiceRequestFeedbackButton,ServiceTicketNewButton,ServiceTicketNewModal,ServiceTicketCloseButton,ServiceTicketCloseModal,ServiceTicketView,ServiceTicketDetail,ServiceTicketContactDetail,ServiceTicketConsumerDetail,ServiceTicketAccountDetail,ServiceActivitiyTimelineAddServiceNote,ServiceTicketRelatedTickets,ServiceTicketRelatedTicketsTiles,ServiceOrderNewButton,ServiceOrderItemPipe,ServiceOrderEffortItem,ServiceOrderEffortItemDetails,ServiceOrderEffortPanel,ServiceOrderEquipmentItem,ServiceOrderEquipmentPanel,ServiceOrderItemItem,ServiceOrderItemPanel,ServiceOrderAddTypeSelector,ServiceOrderConfirmButton,ServiceOrderConfirmModal,ServiceOrderItemConfirmItem,ServiceOrderItemConfirmationPanel,ServiceOrderEffortConfirmationItem,ServiceOrderEffortConfirmationPanel,ServicePlanner,ServicePlannerMapsModelPopover,ServicePlannerMapsModelPopoverDirection,ServiceDocSignatureButton,ServiceDocSignatureContent,ServiceDocSignatureModal]})],ServiceComponentsModule)}();exports.ServiceComponentsModule=ServiceComponentsModule;