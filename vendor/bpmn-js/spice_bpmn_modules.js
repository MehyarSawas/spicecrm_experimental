var SpiceBpmnModules;(()=>{"use strict";var __webpack_require__={d:(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},o:(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),r:exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})}},__webpack_exports__={};__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{init:()=>init,spiceContextPad:()=>spiceContextPad});class SpiceContextPad{$inject=["config","contextPad","create","elementFactory","injector","translate","eventBus"];create;elementFactory;translate;autoPlace;eventBus;static taskTypes=[];static elementTypes=[];constructor(config,contextPad,create,elementFactory,injector,translate,eventBus){this.create=create,this.elementFactory=elementFactory,this.translate=translate,this.eventBus=eventBus,!1!==config.autoPlace&&(this.autoPlace=injector.get("autoPlace",!1)),contextPad.registerProvider(this)}getContextPadEntries(element){const{autoPlace,create,elementFactory,translate,eventBus}=this;return entries=>{if(!SpiceContextPad.elementTypes.some((t=>t.bpmnType===element.type)))return entries;const customEntries={"edit.task":{group:"model",className:"bpmn-icon-screw-wrench",title:"edit",action:{click:(event,element)=>eventBus.fire("edit.task",element)}},"append.text-annotation":entries["append.text-annotation"],connect:entries.connect};let types=SpiceContextPad.taskTypes;return"bpmn:StartEvent"!==element.type&&(customEntries.delete=entries.delete),"bpmn:EndEvent"===element.type?{"edit.task":customEntries["edit.task"],delete:customEntries.delete,"append.text-annotation":entries["append.text-annotation"],connect:entries.connect}:("gateway_email_event"!==element.businessObject.$attrs.taskType&&(types=types.filter((t=>!t.type.startsWith("email_event")))),types.forEach((type=>{if("start"===type.type)return;const bpmnTypeMap=SpiceContextPad.elementTypes.find((e=>e.taskType===type.type)),createShape=()=>elementFactory.createShape({type:bpmnTypeMap.bpmnType,eventDefinitionType:bpmnTypeMap.eventDefinitionType}),appendTaskTypeStart=event=>{const newShape=createShape();eventBus.fire(type.id,newShape),create.start(event,newShape,{source:element})};customEntries[type.id]={group:"model",className:`bpmn-icon-${type.icon??"intermediate-event-none"}`,title:`add ${type.name} task`,action:{click:event=>{if(autoPlace){const newShape=createShape();eventBus.fire(type.id,newShape),autoPlace.append(element,newShape)}else appendTaskTypeStart(event)},dragstart:appendTaskTypeStart}}})),customEntries)}}}function BaseRenderer(eventBus,renderPriority){var self=this;renderPriority=renderPriority||1e3,eventBus.on(["render.shape","render.connection"],renderPriority,(function(evt,context){var type=evt.type,element=context.element,visuals=context.gfx,attrs=context.attrs;if(self.canRender(element))return"render.shape"===type?self.drawShape(visuals,element,attrs):self.drawConnection(visuals,element,attrs)})),eventBus.on(["render.getShapePath","render.getConnectionPath"],renderPriority,(function(evt,element){if(self.canRender(element))return"render.getShapePath"===evt.type?self.getShapePath(element):self.getConnectionPath(element)}))}function ensureImported(element,target){if(element.ownerDocument!==target.ownerDocument)try{return target.ownerDocument.importNode(element,!0)}catch(e){}return element}function appendTo(element,target){return target.appendChild(ensureImported(element,target))}function append(target,node){return appendTo(node,target),target}BaseRenderer.prototype.canRender=function(){},BaseRenderer.prototype.drawShape=function(){},BaseRenderer.prototype.drawConnection=function(){},BaseRenderer.prototype.getShapePath=function(){},BaseRenderer.prototype.getConnectionPath=function(){};var CSS_PROPERTIES={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function setAttribute(node,name,value){var hyphenated=name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),type=CSS_PROPERTIES[hyphenated];type?(2===type&&"number"==typeof value&&(value=String(value)+"px"),node.style[hyphenated]=value):node.setAttributeNS(null,name,value)}function attr(node,name,value){if("string"==typeof name){if(void 0===value)return function(node,name){return CSS_PROPERTIES[name]?node.style[name]:node.getAttributeNS(null,name)}(node,name);setAttribute(node,name,value)}else!function(node,attrs){var i,name,names=Object.keys(attrs);for(i=0;name=names[i];i++)setAttribute(node,name,attrs[name])}(node,name);return node}function index(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}var re=/\s+/,index_esm_toString=Object.prototype.toString;function defined(o){return void 0!==o}function ClassList(el){if(!el||!el.nodeType)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~index(arr,name)||arr.push(name),defined(this.el.className.baseVal)?this.el.className.baseVal=arr.join(" "):this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"===index_esm_toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className.baseVal=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(defined(force)?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(defined(force)?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var arr=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)};var ns_svg="http://www.w3.org/2000/svg",SVG_START='<svg xmlns="'+ns_svg+'"';function parse(svg){var unwrap=!1;"<svg"===svg.substring(0,4)?-1===svg.indexOf(ns_svg)&&(svg=SVG_START+svg.substring(4)):(svg=SVG_START+">"+svg+"</svg>",unwrap=!0);var parsed=function(svg){var parser;return(parser=new DOMParser).async=!1,parser.parseFromString(svg,"text/xml")}(svg);if(!unwrap)return parsed;for(var fragment=document.createDocumentFragment(),parent=parsed.firstChild;parent.firstChild;)fragment.appendChild(parent.firstChild);return fragment}function create(name,attrs){var element;return"<"===name.charAt(0)?(element=parse(name).firstChild,element=document.importNode(element,!0)):element=document.createElementNS(ns_svg,name),attrs&&attr(element,attrs),element}create("svg");function is(element,type){var bo=getBusinessObject(element);return bo&&"function"==typeof bo.$instanceOf&&bo.$instanceOf(type)}function getBusinessObject(element){return element&&element.businessObject||element}function BpmnRenderUtil_getDi(element){return element.businessObject.di}function getFillColor(element,defaultColor){var di=BpmnRenderUtil_getDi(element);return di.get("color:background-color")||di.get("bioc:fill")||defaultColor||"white"}function getStrokeColor(element,defaultColor){var di=BpmnRenderUtil_getDi(element);return di.get("color:border-color")||di.get("bioc:stroke")||defaultColor||"black"}var nativeToString=Object.prototype.toString;Object.prototype.hasOwnProperty;function isObject(obj){return"[object Object]"===nativeToString.call(obj)}class SpiceRenderer extends BaseRenderer{constructor(eventBus,bpmnRenderer,config,styles,pathMap){super(eventBus,1500),this.bpmnRenderer=bpmnRenderer,config&&config.defaultStrokeColor&&(this.defaultStrokeColor=config.defaultStrokeColor,this.defaultFillColor=config.defaultFillColor),this.computeStyle=styles.computeStyle,this.pathMap=pathMap}canRender(element){return is(element,"bpmn:BaseElement")}drawShape(parentNode,element){if("label"==element.type)return this.bpmnRenderer.drawShape(parentNode,element);const icon=element.businessObject.$attrs.icon;element.type;if("end-event-message"==icon)return this.drawStartEvent(parentNode,element,"bpmn:MessageEventDefinition",!0);if("start-event-message"==icon)return this.drawStartEvent(parentNode,element,"bpmn:MessageEventDefinition");if("start-event-condition"==icon)return this.drawStartEvent(parentNode,element,"bpmn:ConditionalEventDefinition");if("end-event-error"==icon)return this.drawStartEvent(parentNode,element,"bpmn:ErrorEventDefinition",!0);if("end-event-signal"==icon)return this.drawStartEvent(parentNode,element,"bpmn:SignalEventDefinition",!0);return this.bpmnRenderer.drawShape(parentNode,element)}getShapePath(shape){const icon=shape.businessObject.$attrs.icon,sType=shape.type;"start-event-message"==icon&&(shape.type="bpmn:EventBasedGateway");const path=this.bpmnRenderer.getShapePath(shape);return shape.type=sType,path}drawStartEvent(parentGfx,element,innerType,fill=!1){var attrs={fill:getFillColor(element,this.defaultFillColor),stroke:getStrokeColor(element,this.defaultStrokeColor)},circle=this.bpmnRenderer.handlers["bpmn:Event"](parentGfx,element,attrs);return this.renderEventContent(element,parentGfx,innerType,fill),circle}renderEventContent(element,parentGfx,innerType,fill=!1){return"bpmn:MessageEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:MessageEventDefinition"](parentGfx,element,fill):"bpmn:TimerEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:TimerEventDefinition"](parentGfx,element,fill):"bpmn:ConditionalEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:ConditionalEventDefinition"](parentGfx,element):"bpmn:SignalEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:SignalEventDefinition"](parentGfx,element,fill):"bpmn:EscalationEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:EscalationEventDefinition"](parentGfx,element,fill):"bpmn:LinkEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:LinkEventDefinition"](parentGfx,element,fill):"bpmn:ErrorEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:ErrorEventDefinition"](parentGfx,element,fill):"bpmn:CancelEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:CancelEventDefinition"](parentGfx,element,fill):"bpmn:CompensateEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:CompensateEventDefinition"](parentGfx,element,fill):"bpmn:TerminateEventDefinition"==innerType?this.bpmnRenderer.handlers["bpmn:TerminateEventDefinition"](parentGfx,element,fill):null}drawEvent(element,parentGfx){var pathData=this.pathMap.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:element.width,containerHeight:element.height,position:{mx:.36,my:.44}}),attrs={strokeWidth:2,fill:getFillColor(element,"none"),stroke:getStrokeColor(element,this.defaultStrokeColor)};this.drawPath(parentGfx,pathData,attrs)}drawCircle(parentGfx,width,height,offset,attrs){isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,"none"===(attrs=this.computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"})).fill&&delete attrs.fillOpacity;var cx=width/2,cy=height/2,circle=create("circle");return attr(circle,{cx,cy,r:Math.round((width+height)/4-offset)}),attr(circle,attrs),append(parentGfx,circle),circle}drawPath(parentGfx,d,attrs){attrs=this.computeStyle(attrs,["no-fill"],{strokeWidth:2,stroke:"black"});var path=create("path");return attr(path,{d}),attr(path,attrs),append(parentGfx,path),path}}SpiceRenderer.$inject=["eventBus","bpmnRenderer","config.bpmnRenderer","styles","pathMap"];var init={__init__:["spiceContextPad","spicePalette","spiceRenderer"],spiceContextPad:["type",SpiceContextPad],spicePalette:["type",class{$inject=["create","elementFactory","palette","translate","eventBus","zoomScroll"];create;translate;elementFactory;eventBus;zoomScroll;constructor(create,elementFactory,palette,translate,eventBus,zoomScroll){this.create=create,this.elementFactory=elementFactory,this.translate=translate,this.eventBus=eventBus,this.zoomScroll=zoomScroll,palette.registerProvider(this)}getPaletteEntries(element){const{zoomScroll,eventBus}=this;return entries=>({"hand-tool":entries["hand-tool"],"zoom-reset":{group:"zoom",className:"bpmn-icon-target",title:"reset zoom",action:{click:()=>zoomScroll.reset()}},"zoom-in":{group:"zoom",className:"bpmn-icon-plus",title:"zoom in",action:{click:()=>zoomScroll.stepZoom(1)}},"zoom-out":{group:"zoom",className:"bpmn-icon-minus",title:"zoom out",action:{click:()=>zoomScroll.stepZoom(-1)}},"create.group":entries["create.group"]})}}],spiceRenderer:["type",SpiceRenderer]},spiceContextPad=SpiceContextPad;SpiceBpmnModules=__webpack_exports__})();