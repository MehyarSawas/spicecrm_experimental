"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subscription_1=require("../Subscription"),subscribeToResult_1=require("../util/subscribeToResult"),OuterSubscriber_1=require("../OuterSubscriber");function bufferToggle(e,r){return function(t){return t.lift(new BufferToggleOperator(e,r))}}exports.bufferToggle=bufferToggle;var BufferToggleOperator=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new BufferToggleSubscriber(t,this.openings,this.closingSelector))},t}(),BufferToggleSubscriber=function(o){function t(t,e,r){t=o.call(this,t)||this;return t.closingSelector=r,t.contexts=[],t.add(subscribeToResult_1.subscribeToResult(t,e)),t}return __extends(t,o),t.prototype._next=function(t){for(var e=this.contexts,r=e.length,o=0;o<r;o++)e[o].buffer.push(t)},t.prototype._error=function(t){for(var e=this.contexts;0<e.length;){var r=e.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,o.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;0<t.length;){var e=t.shift();this.destination.next(e.buffer),e.subscription.unsubscribe(),e.buffer=null,e.subscription=null}this.contexts=null,o.prototype._complete.call(this)},t.prototype.notifyNext=function(t,e){t?this.closeBuffer(t):this.openBuffer(e)},t.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},t.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},t.prototype.closeBuffer=function(t){var e,r,o=this.contexts;o&&t&&(e=t.buffer,r=t.subscription,this.destination.next(e),o.splice(o.indexOf(t),1),this.remove(r),r.unsubscribe())},t.prototype.trySubscribe=function(t){var e=this.contexts,r=new Subscription_1.Subscription,o={buffer:[],subscription:r};e.push(o);t=subscribeToResult_1.subscribeToResult(this,t,o);!t||t.closed?this.closeBuffer(o):(t.context=o,this.add(t),r.add(t))},t}(OuterSubscriber_1.OuterSubscriber);