"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ReplaySubject_1=require("../ReplaySubject");function shareReplay(e,r,t){var u=e&&"object"==typeof e?e:{bufferSize:e,windowTime:r,refCount:!1,scheduler:t};return function(e){return e.lift(shareReplayOperator(u))}}function shareReplayOperator(e){var t,u,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,r=e.windowTime,o=void 0===r?Number.POSITIVE_INFINITY:r,n=e.refCount,s=e.scheduler,c=0,a=!1,b=!1;return function(e){var r;c++,!t||a?(a=!1,t=new ReplaySubject_1.ReplaySubject(i,o,s),r=t.subscribe(this),u=e.subscribe({next:function(e){t.next(e)},error:function(e){a=!0,t.error(e)},complete:function(){b=!0,u=void 0,t.complete()}}),b&&(u=void 0)):r=t.subscribe(this),this.add(function(){c--,r.unsubscribe(),r=void 0,u&&!b&&n&&0===c&&(u.unsubscribe(),t=u=void 0)})}}exports.shareReplay=shareReplay;