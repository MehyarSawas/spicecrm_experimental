"use strict";var __extends=this&&this.__extends||function(){var o=function(r,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])})(r,t)};return function(r,t){function e(){this.constructor=r}o(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var isFunction_1=require("./util/isFunction"),Observer_1=require("./Observer"),Subscription_1=require("./Subscription"),rxSubscriber_1=require("../internal/symbol/rxSubscriber"),config_1=require("./config"),hostReportError_1=require("./util/hostReportError"),Subscriber=function(n){function s(r,t,e){var o=n.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Observer_1.empty;break;case 1:if(!r){o.destination=Observer_1.empty;break}if("object"==typeof r){r instanceof s?(o.syncErrorThrowable=r.syncErrorThrowable,(o.destination=r).add(o)):(o.syncErrorThrowable=!0,o.destination=new SafeSubscriber(o,r));break}default:o.syncErrorThrowable=!0,o.destination=new SafeSubscriber(o,r,t,e)}return o}return __extends(s,n),s.prototype[rxSubscriber_1.rxSubscriber]=function(){return this},s.create=function(r,t,e){e=new s(r,t,e);return e.syncErrorThrowable=!1,e},s.prototype.next=function(r){this.isStopped||this._next(r)},s.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},s.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},s.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this))},s.prototype._next=function(r){this.destination.next(r)},s.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},s.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},s.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},s}(Subscription_1.Subscription),SafeSubscriber=function(i){function r(r,t,e,o){var n,s=i.call(this)||this;s._parentSubscriber=r;r=s;return isFunction_1.isFunction(t)?n=t:t&&(n=t.next,e=t.error,o=t.complete,t!==Observer_1.empty&&(r=Object.create(t),isFunction_1.isFunction(r.unsubscribe)&&s.add(r.unsubscribe.bind(r)),r.unsubscribe=s.unsubscribe.bind(s))),s._context=r,s._next=n,s._error=e,s._complete=o,s}return __extends(r,i),r.prototype.next=function(r){var t;!this.isStopped&&this._next&&(t=this._parentSubscriber,config_1.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,r)&&this.unsubscribe():this.__tryOrUnsub(this._next,r))},r.prototype.error=function(r){if(!this.isStopped){var t=this._parentSubscriber,e=config_1.config.useDeprecatedSynchronousErrorHandling;if(this._error)e&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,r):this.__tryOrUnsub(this._error,r),this.unsubscribe();else if(t.syncErrorThrowable)e?(t.syncErrorValue=r,t.syncErrorThrown=!0):hostReportError_1.hostReportError(r),this.unsubscribe();else{if(this.unsubscribe(),e)throw r;hostReportError_1.hostReportError(r)}}},r.prototype.complete=function(){var r,t,e=this;this.isStopped||(r=this._parentSubscriber,this._complete&&(t=function(){return e._complete.call(e._context)},config_1.config.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?this.__tryOrSetError(r,t):this.__tryOrUnsub(t)),this.unsubscribe())},r.prototype.__tryOrUnsub=function(r,t){try{r.call(this._context,t)}catch(r){if(this.unsubscribe(),config_1.config.useDeprecatedSynchronousErrorHandling)throw r;hostReportError_1.hostReportError(r)}},r.prototype.__tryOrSetError=function(t,r,e){if(!config_1.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{r.call(this._context,e)}catch(r){return config_1.config.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0):(hostReportError_1.hostReportError(r),!0)}return!1},r.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},r}(exports.Subscriber=Subscriber);exports.SafeSubscriber=SafeSubscriber;