"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=require("../Observable"),AsyncSubject_1=require("../AsyncSubject"),map_1=require("../operators/map"),canReportError_1=require("../util/canReportError"),isArray_1=require("../util/isArray"),isScheduler_1=require("../util/isScheduler");function bindCallback(n,c,u){if(c){if(!isScheduler_1.isScheduler(c))return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return bindCallback(n,u).apply(void 0,r).pipe(map_1.map(function(r){return isArray_1.isArray(r)?c.apply(void 0,r):c(r)}))};u=c}return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var c,t=this,a={context:t,subject:c,callbackFunc:n,scheduler:u};return new Observable_1.Observable(function(r){if(u)return u.schedule(dispatch,0,{args:e,subscriber:r,params:a});if(!c){c=new AsyncSubject_1.AsyncSubject;try{n.apply(t,e.concat([function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];c.next(r.length<=1?r[0]:r),c.complete()}]))}catch(r){canReportError_1.canReportError(c)?c.error(r):console.warn(r)}}return c.subscribe(r)})}}function dispatch(r){var t=this,e=r.args,c=r.subscriber,a=r.params,n=a.callbackFunc,r=a.context,u=a.scheduler;if(!(s=a.subject)){var s=a.subject=new AsyncSubject_1.AsyncSubject;try{n.apply(r,e.concat([function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var c=r.length<=1?r[0]:r;t.add(u.schedule(dispatchNext,0,{value:c,subject:s}))}]))}catch(r){s.error(r)}}this.add(s.subscribe(c))}function dispatchNext(r){var e=r.value,r=r.subject;r.next(e),r.complete()}function dispatchError(r){var e=r.err;r.subject.error(e)}exports.bindCallback=bindCallback;