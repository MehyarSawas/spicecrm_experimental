/* * *******************************************************************************
* This file is part of KReporter. KReporter is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the KReporter is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@kreporter.org
******************************************************************************* */
Ext.define("SpiceCRM.KReporter.Viewer.model.reportResult",{extend:"Ext.data.Model",fields:["id"]}),Ext.define("SpiceCRM.KReporter.Viewer.store.reportResults",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Viewer.model.reportResult"],model:"SpiceCRM.KReporter.Viewer.model.reportResult",alias:["store.KReportViewer.plugins.reportResults"],reportId:void 0,remoteSort:!0,linkedFields:!1,proxy:{type:"ajax",url:"KREST/KReporter/"+this.reportId+"/presentation",method:"GET",timeout:12e4,reader:{type:"json",rootProperty:"records",totalProperty:"count"}},listeners:{beforeload:function(a,b,c){b._proxy.url="KREST/KReporter/"+this.reportId+"/presentation"},load:function(){this.proxy.reader.metaData.gridColumns&&0===this.panel.getColumns().length&&this.panel.reconfigure(this.proxy.reader.metaData.gridColumns)}},buildLinkedFields:function(){this.linkedFields={};for(var a=this.proxy.reader.metaData.fields,b=0;b<a.length;b++)void 0===a[b].linkInfo?this.linkedFields[a[b].name]=null:this.linkedFields[a[b].name]=Ext.JSON.decode(a[b].linkInfo)}}),Ext.define("SpiceCRM.KReporter.Viewer.controller.plugins.StandardViewerController",{extend:"Ext.app.ViewController",alias:"controller.KReportViewer.plugins.StandardViewerController",whereConfig:{},config:{listen:{global:{whereClauseUpdated:function(a){console.log("where updated "+Ext.encode(a)),this.reloadStore(a)},snapshotSelected:function(a){var b=this.view.getStore();b.getProxy().extraParams.snapshotid=a,b.removeAll(),b.load()}}}},showContexMenu:function(a,b,c,d,e,f){console.log("right clicked controller"),this.view.up("panel").controller.displayContextMenu(b,e)},reloadStore:function(a){var b=this.view.getStore();b.getProxy().extraParams.whereConditions=Ext.encode(a),b.getProxy().extraParams.XDEBUG_SESSION_START="netbeans-xdebug",b.removeAll(),b.load()},renderField:function(a,b,c,d,e,f,g){return b&&b.column&&b.column.fieldrenderer?Ext.util.Format[b.column.fieldrenderer](a,b,c,d,e,f,g):a}}),Ext.define("SpiceCRM.KReporter.Viewer.plugins.StandardViewPanel",{extend:"Ext.grid.Panel",controller:"KReportViewer.plugins.StandardViewerController",itemId:"KReporterViewerPresentation",store:{type:"KReportViewer.plugins.reportResults"},selType:"rowmodel",columns:[],monitorResize:!0,autoHeight:!0,minHeight:400,boxMinHeight:250,context:"Viewer",reportRecord:void 0,remoteSort:!0,initComponent:function(){this.callParent(),"Viewer"===this.context&&this.down("pagingtoolbar").add({text:"Save Layout",handler:function(){var a=[],b=1;Ext.each(this.up("grid").getColumns(),function(c){a.push({dataIndex:c.dataIndex,width:c.width,sequence:b,isHidden:c.hidden}),b++}),Ext.Ajax.request({url:"KREST/KReporter/core/savelayout",method:"POST",jsonData:{record:this.up("grid").reportRecord.get("id"),layout:Ext.encode(a)},success:function(a,b){},failure:function(a,b){console.log("server-side failure with status code "+a.status)},scope:this})}}),this.down("pagingtoolbar").setStore(this.store),this.store.panel=this,this.store.reportId=this.reportRecord.get("id"),this.store.load()},buildColumns:function(a){var b=[];return Ext.each(a,function(a){b.push({text:languageGetText(a.name),readOnly:!0,dataIndex:a.fieldid,width:a.width,sortable:"-"!==a.sort?!0:!1})}),b},bbar:{xtype:"pagingtoolbar",displayInfo:!0},listeners:{itemcontextmenu:"showContexMenu"}});